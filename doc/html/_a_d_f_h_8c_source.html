<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>CGNS: ADFH.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>ADFH.c</h1><a href="_a_d_f_h_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*-------------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">This software is provided 'as-is', without any express or implied warranty.</span>
<a name="l00003"></a>00003 <span class="comment">In no event will the authors be held liable for any damages arising from</span>
<a name="l00004"></a>00004 <span class="comment">the use of this software.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">Permission is granted to anyone to use this software for any purpose,</span>
<a name="l00007"></a>00007 <span class="comment">including commercial applications, and to alter it and redistribute it</span>
<a name="l00008"></a>00008 <span class="comment">freely, subject to the following restrictions:</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">1. The origin of this software must not be misrepresented; you must not</span>
<a name="l00011"></a>00011 <span class="comment">   claim that you wrote the original software. If you use this software</span>
<a name="l00012"></a>00012 <span class="comment">   in a product, an acknowledgment in the product documentation would be</span>
<a name="l00013"></a>00013 <span class="comment">   appreciated but is not required.</span>
<a name="l00014"></a>00014 <span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment">2. Altered source versions must be plainly marked as such, and must not</span>
<a name="l00016"></a>00016 <span class="comment">   be misrepresented as being the original software.</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment">3. This notice may not be removed or altered from any source distribution.</span>
<a name="l00019"></a>00019 <span class="comment">-------------------------------------------------------------------------*/</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment">/*-------------------------------------------------------------------</span>
<a name="l00022"></a>00022 <span class="comment"> * HDF5 interface to ADF</span>
<a name="l00023"></a>00023 <span class="comment"> *-------------------------------------------------------------------*/</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#if defined(_WIN32) &amp;&amp; !defined(__NUTC__)</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#include &lt;io.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#else</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#endif</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036 <span class="preprocessor">#include "<a class="code" href="_a_d_f_h_8h.html">ADFH.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "hdf5.h"</span>
<a name="l00038"></a>00038 <span class="preprocessor">#ifdef USE_CGIO</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="cgns__io_8h.html">cgns_io.h</a>"</span> <span class="comment">/* for cgio_find_file */</span>
<a name="l00040"></a>00040 <span class="preprocessor">#endif</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="preprocessor">#if H5_VERS_MAJOR &lt; 2 &amp;&amp; H5_VERS_MINOR &lt; 8</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor"># error you need at least HDF5 version 1.8</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="preprocessor">#undef  ADFH_DEBUG_ON</span>
<a name="l00047"></a><a class="code" href="_a_d_f_h_8c.html#7f898ddb0d862e39f2c97a66a173ff15">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_NO_ORDER</span>
<a name="l00048"></a><a class="code" href="_a_d_f_h_8c.html#155275c2a90b3f872991baad125d00a6">00048</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_USE_STRINGS</span>
<a name="l00049"></a><a class="code" href="_a_d_f_h_8c.html#e253ef03bcd369b93cc9a6491af677eb">00049</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_FORTRAN_INDEXING</span>
<a name="l00050"></a><a class="code" href="_a_d_f_h_8c.html#d5b5f97ed286b842e390187a2b627d4b">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_COMPRESS_DATA</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00052"></a>00052 <span class="preprocessor">#ifdef ADFH_COMPRESS_DATA</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f_h_8c.html#8130874cb175b93f3c080aa7eab00a94">cgns_compress</a>;
<a name="l00054"></a>00054 <span class="preprocessor">#endif</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span>
<a name="l00056"></a><a class="code" href="_a_d_f_h_8c.html#50e957a64182f3bb8c15c3fc36eac0dc">00056</a> <span class="preprocessor">#define TO_UPPER( c ) ((islower(c))?(toupper(c)):(c))</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>
<a name="l00058"></a>00058 <span class="comment">/*</span>
<a name="l00059"></a>00059 <span class="comment"> * ADF names are not allowed to start with a space.</span>
<a name="l00060"></a>00060 <span class="comment"> * Since HDF5 allows this, use the space to hide data</span>
<a name="l00061"></a>00061 <span class="comment"> */</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">/* dataset and group names */</span>
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="_a_d_f_h_8c.html#ac9fcaf994677f69931da9e5d51b6468">00065</a> <span class="preprocessor">#define D_PREFIX  ' '</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l00067"></a><a class="code" href="_a_d_f_h_8c.html#7145efec1802c97ae54f3fb15f3e390f">00067</a> <span class="preprocessor"></span><span class="preprocessor">#define D_VERSION " hdf5version"</span>
<a name="l00068"></a><a class="code" href="_a_d_f_h_8c.html#57dfd3d0f62d275caca74daa635cfda9">00068</a> <span class="preprocessor"></span><span class="preprocessor">#define D_OLDVERS " version"</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#define D_VERSION " version"</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00072"></a><a class="code" href="_a_d_f_h_8c.html#86bb56a7be5beae5fc02ce5dd5c6f4d4">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define D_FORMAT  " format"</span>
<a name="l00073"></a><a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define D_DATA    " data"</span>
<a name="l00074"></a><a class="code" href="_a_d_f_h_8c.html#1a964dfeefcc39a644d47ee877ef62c4">00074</a> <span class="preprocessor"></span><span class="preprocessor">#define D_FILE    " file"</span>
<a name="l00075"></a><a class="code" href="_a_d_f_h_8c.html#e61cf009a2da32cd6a5d3c9f59ab5c0f">00075</a> <span class="preprocessor"></span><span class="preprocessor">#define D_PATH    " path"</span>
<a name="l00076"></a><a class="code" href="_a_d_f_h_8c.html#bbed85e98b4e4faf4e28bd714e2be01c">00076</a> <span class="preprocessor"></span><span class="preprocessor">#define D_LINK    " link"</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span>
<a name="l00078"></a>00078 <span class="comment">/* attribute names */</span>
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">00080</a> <span class="preprocessor">#define A_NAME    "name"</span>
<a name="l00081"></a><a class="code" href="_a_d_f_h_8c.html#e74c4630d003eebd54e1a7b660b0ca3a">00081</a> <span class="preprocessor"></span><span class="preprocessor">#define A_LABEL   "label"</span>
<a name="l00082"></a><a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">00082</a> <span class="preprocessor"></span><span class="preprocessor">#define A_TYPE    "type"</span>
<a name="l00083"></a><a class="code" href="_a_d_f_h_8c.html#0d93ceee9ef585ec9618bd787affe17c">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define A_ORDER   "order"</span>
<a name="l00084"></a><a class="code" href="_a_d_f_h_8c.html#3630432f24083286ad8eedc37dc122f6">00084</a> <span class="preprocessor"></span><span class="preprocessor">#define A_MOUNT   "mount"</span>
<a name="l00085"></a><a class="code" href="_a_d_f_h_8c.html#1d1cc5417708ca4faf8cf7e3285c6988">00085</a> <span class="preprocessor"></span><span class="preprocessor">#define A_FILE    "file"</span>
<a name="l00086"></a><a class="code" href="_a_d_f_h_8c.html#8a515249ea28ec6418b50566e2fba3ab">00086</a> <span class="preprocessor"></span><span class="preprocessor">#define A_REFCNT  "refcnt"</span>
<a name="l00087"></a><a class="code" href="_a_d_f_h_8c.html#1e2bc7c35de6ff1ed599cb45b8bb4ea5">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define A_FLAGS   "flags"</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a>00089 <span class="comment">/* debugging */</span>
<a name="l00090"></a><a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">00090</a> <span class="preprocessor">#define ADFH_CHECK_HID( hid ) \</span>
<a name="l00091"></a>00091 <span class="preprocessor">if (hid &lt;0) {printf("#### BAD ID [%5d] ",__LINE__);fflush(stdout); }</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a><a class="code" href="_a_d_f_h_8c.html#0bf541adebd748952ba64cb33bd017a2">00093</a> <span class="preprocessor">#define ADFH_PREFIX       "#### DBG         "</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">#ifdef ADFH_DEBUG_ON</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">#define ADFH_DEBUG(aaa) \</span>
<a name="l00096"></a>00096 <span class="preprocessor">printf("#### DBG [%5d] ",__LINE__);fflush(stdout); \</span>
<a name="l00097"></a>00097 <span class="preprocessor">printf aaa ; printf("\n"); fflush(stdout);</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span><span class="preprocessor">#define DROP( msg ) printf("XX " msg "\n");fflush(stdout);</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00100"></a><a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_DEBUG(a) ;</span>
<a name="l00101"></a><a class="code" href="_a_d_f_h_8c.html#e3088bfe299a11b1c2371b5e0a102587">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define DROP( msg ) ;</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>
<a name="l00104"></a>00104 <span class="comment">/* ADF data types */</span>
<a name="l00105"></a>00105 
<a name="l00106"></a><a class="code" href="_a_d_f_h_8c.html#1ca1db6f0d9c5d502d96298ca8a93639">00106</a> <span class="preprocessor">#define ADFH_MT "MT"</span>
<a name="l00107"></a><a class="code" href="_a_d_f_h_8c.html#45a51dad81a251c623f7cbab0f978ec0">00107</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_LK "LK"</span>
<a name="l00108"></a><a class="code" href="_a_d_f_h_8c.html#c946e4162ee5a6831171a2cee2bb1f89">00108</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_B1 "B1"</span>
<a name="l00109"></a><a class="code" href="_a_d_f_h_8c.html#93b472cbdcfaf6d83f65027ae8c80530">00109</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_C1 "C1"</span>
<a name="l00110"></a><a class="code" href="_a_d_f_h_8c.html#9b77f412203f5f68037e80a5ffa594d7">00110</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_I4 "I4"</span>
<a name="l00111"></a><a class="code" href="_a_d_f_h_8c.html#df5dba80efbefb5b7b4cf7664beea82c">00111</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_I8 "I8"</span>
<a name="l00112"></a><a class="code" href="_a_d_f_h_8c.html#d53e6f99bd8c7fe121b9aa444ac7bcca">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_U4 "U4"</span>
<a name="l00113"></a><a class="code" href="_a_d_f_h_8c.html#2e78c189d646852c2af69182bb1bc3eb">00113</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_U8 "U8"</span>
<a name="l00114"></a><a class="code" href="_a_d_f_h_8c.html#752d961d292c49a059957170b26ff0a7">00114</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_R4 "R4"</span>
<a name="l00115"></a><a class="code" href="_a_d_f_h_8c.html#a80fb83f02b3d7077ae0f03163122caf">00115</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_R8 "R8"</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span><span class="comment">/* these are not supported */</span>
<a name="l00117"></a><a class="code" href="_a_d_f_h_8c.html#f8f40ccf7b82381137d0cbeba4492c42">00117</a> <span class="preprocessor">#define ADFH_X4 "X4"</span>
<a name="l00118"></a><a class="code" href="_a_d_f_h_8c.html#0ff4f4a9350fd704e5856962da36dd52">00118</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_X8 "X8"</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>
<a name="l00120"></a>00120 <span class="comment">/* file open modes */</span>
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="_a_d_f_h_8c.html#7ac8991eb3562ed4653b66f3da09acc0">00122</a> <span class="preprocessor">#define ADFH_MODE_NEW 1</span>
<a name="l00123"></a><a class="code" href="_a_d_f_h_8c.html#d4425bede55fc465a48588bf18aa39df">00123</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_MODE_OLD 2</span>
<a name="l00124"></a><a class="code" href="_a_d_f_h_8c.html#2f3ecaeae191bb75c6f5476805775304">00124</a> <span class="preprocessor"></span><span class="preprocessor">#define ADFH_MODE_RDO 3</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span>
<a name="l00126"></a>00126 <span class="comment">/* the following keeps track of open and mounted files */</span>
<a name="l00127"></a>00127 
<a name="l00128"></a><a class="code" href="_a_d_f_h_8c.html#b7d4546845c6fbe98aa8f37633fba992">00128</a> <span class="preprocessor">#define ADFH_MAXIMUM_FILES 128</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>
<a name="l00130"></a>00130 <span class="comment">/* Start to prepare re-entrance into lib, gather statics in one global struct  */</span>
<a name="l00131"></a>00131 <span class="comment">/* Then, you'll just have to handle struct with something else but a static... */</span>
<a name="l00132"></a>00132 <span class="comment">/* MTA stands for... Multi-Threads-Aware */</span>
<a name="l00133"></a><a class="code" href="struct___a_d_f_h___m_t_a.html">00133</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct___a_d_f_h___m_t_a.html">_ADFH_MTA</a> {
<a name="l00134"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#1abd210f4ff9a3bbb8b8dd19567a4424">00134</a>   <span class="keywordtype">int</span> <a class="code" href="struct___a_d_f_h___m_t_a.html#1abd210f4ff9a3bbb8b8dd19567a4424">g_init</a>;               <span class="comment">/* set when initialization done */</span>
<a name="l00135"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#aef892c12b8d134d4574c34a74aa267a">00135</a>   <span class="keywordtype">int</span> <a class="code" href="struct___a_d_f_h___m_t_a.html#aef892c12b8d134d4574c34a74aa267a">g_error_state</a>;        <span class="comment">/* zero means do not stop on error (one stops) */</span>
<a name="l00136"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#ea9b53c36b298e8064344b37eabe93ec">00136</a>   <span class="keywordtype">int</span> <a class="code" href="struct___a_d_f_h___m_t_a.html#ea9b53c36b298e8064344b37eabe93ec">i_start</a>;
<a name="l00137"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#ea0ae36bd9cc38e0ee1f5b2444deb586">00137</a>   <span class="keywordtype">int</span> <a class="code" href="struct___a_d_f_h___m_t_a.html#ea0ae36bd9cc38e0ee1f5b2444deb586">i_len</a>;
<a name="l00138"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#26fd89da54c4e465e73db70f035f1f85">00138</a>   <span class="keywordtype">int</span> <a class="code" href="struct___a_d_f_h___m_t_a.html#26fd89da54c4e465e73db70f035f1f85">n_length</a>;
<a name="l00139"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#799467c347fcdf71beda8521204b52be">00139</a>   <span class="keywordtype">int</span> <a class="code" href="struct___a_d_f_h___m_t_a.html#799467c347fcdf71beda8521204b52be">n_names</a>;
<a name="l00140"></a>00140 <span class="preprocessor">#ifdef ADFH_NO_ORDER</span>
<a name="l00141"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#42c35485c275e5d9847820d8da2d71c9">00141</a> <span class="preprocessor"></span>  <span class="keywordtype">int</span> <a class="code" href="struct___a_d_f_h___m_t_a.html#42c35485c275e5d9847820d8da2d71c9">i_count</a>;
<a name="l00142"></a>00142 <span class="preprocessor">#endif</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>  <span class="comment">/* HDF5 property lists */</span>
<a name="l00144"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">00144</a>   hid_t <a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">g_propfile</a>;        
<a name="l00145"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#4048402797b72e65947c9f02d7623d50">00145</a>   hid_t <a class="code" href="struct___a_d_f_h___m_t_a.html#4048402797b72e65947c9f02d7623d50">g_proplink</a>;     
<a name="l00146"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#786f8ccc1f3acb574c971aab6091ecef">00146</a>   hid_t <a class="code" href="struct___a_d_f_h___m_t_a.html#786f8ccc1f3acb574c971aab6091ecef">g_propdataset</a>;  
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   <span class="comment">/* FORTRAN FLAG - mp 12/08 */</span>
<a name="l00149"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#a6fd34ad950178f0aadf5780dbfa31b7">00149</a>   <span class="keywordtype">int</span>   <a class="code" href="struct___a_d_f_h___m_t_a.html#a6fd34ad950178f0aadf5780dbfa31b7">g_flags</a>;     
<a name="l00150"></a><a class="code" href="struct___a_d_f_h___m_t_a.html#97c82d2ac1d1dce14bc8807e7bae7caf">00150</a>   hid_t <a class="code" href="struct___a_d_f_h___m_t_a.html#97c82d2ac1d1dce14bc8807e7bae7caf">g_files</a>[<a class="code" href="_a_d_f_h_8c.html#b7d4546845c6fbe98aa8f37633fba992">ADFH_MAXIMUM_FILES</a>];
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 } <a class="code" href="struct___a_d_f_h___m_t_a.html">ADFH_MTA</a>;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="keyword">static</span> <a class="code" href="struct___a_d_f_h___m_t_a.html">ADFH_MTA</a>  *mta_root=NULL;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">/* error codes and messages - do not care about multi-threading here */</span>
<a name="l00157"></a>00157 <span class="keyword">static</span> <span class="keyword">struct </span>_ErrorList {
<a name="l00158"></a>00158   <span class="keywordtype">int</span> errcode;
<a name="l00159"></a>00159   <span class="keywordtype">char</span> *<a class="code" href="write__test_8c.html#2141b8541565b9145c450f46c23fdd31">errmsg</a>;
<a name="l00160"></a>00160 } ErrorList[] = {
<a name="l00161"></a>00161   {<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>,                <span class="stringliteral">"No Error"</span>},
<a name="l00162"></a>00162   {<a class="code" href="_a_d_f_8h.html#ed336807c97f2e167849e7fdc777dcba">STRING_LENGTH_ZERO</a>,      <span class="stringliteral">"String length of zero or blank string detected"</span>},
<a name="l00163"></a>00163   {<a class="code" href="_a_d_f_8h.html#3113602eb7ea513e38178e3c6fb4b10a">STRING_LENGTH_TOO_BIG</a>,   <span class="stringliteral">"String length longer than maximum allowable length"</span>},
<a name="l00164"></a>00164   {<a class="code" href="_a_d_f_8h.html#56cd83988473c32f1881d7ab75813ada">TOO_MANY_ADF_FILES_OPENED</a>,<span class="stringliteral">"Too many files opened"</span>},
<a name="l00165"></a>00165   {<a class="code" href="_a_d_f_8h.html#e4e416256493377627a19ce9f967ed16">ADF_FILE_STATUS_NOT_RECOGNIZED</a>,<span class="stringliteral">"File status was not recognized"</span>},
<a name="l00166"></a>00166   {<a class="code" href="_a_d_f_8h.html#bde48ee05fd7b864a4f44ed92afd066e">FILE_OPEN_ERROR</a>,         <span class="stringliteral">"File-open error"</span>},
<a name="l00167"></a>00167   {<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>,     <span class="stringliteral">"A string pointer is NULL"</span>},
<a name="l00168"></a>00168   {<a class="code" href="_a_d_f_8h.html#fca941a9a1bc0e895f7901e5592e5369">REQUESTED_NEW_FILE_EXISTS</a>,<span class="stringliteral">"File Open Error: NEW - File already exists"</span>},
<a name="l00169"></a>00169   {<a class="code" href="_a_d_f_8h.html#1fa57a283569340d06327e5d293c385e">ADF_FILE_FORMAT_NOT_RECOGNIZED</a>,<span class="stringliteral">"File format was not recognized"</span>},
<a name="l00170"></a>00170   {<a class="code" href="_a_d_f_8h.html#5f6e71fd2b6ec20a19a78a87795d48ea">REQUESTED_OLD_FILE_NOT_FOUND</a>,<span class="stringliteral">"File Open Error: OLD - File does not exist"</span>},
<a name="l00171"></a>00171   {<a class="code" href="_a_d_f_8h.html#996254e4d79ab38ec4eb8d81b44804b8">MEMORY_ALLOCATION_FAILED</a>,<span class="stringliteral">"Memory allocation failed"</span>},
<a name="l00172"></a>00172   {<a class="code" href="_a_d_f_8h.html#4c1c4177cacebe90cb67ae50488ead58">DUPLICATE_CHILD_NAME</a>,    <span class="stringliteral">"Duplicate child name under a parent node"</span>},
<a name="l00173"></a>00173   {<a class="code" href="_a_d_f_8h.html#b74b015c467e1be81bf3c4749156fb7e">ZERO_DIMENSIONS</a>,         <span class="stringliteral">"Node has no dimensions"</span>},
<a name="l00174"></a>00174   {<a class="code" href="_a_d_f_8h.html#443f811c30081b9688b9dea516bb1ae6">BAD_NUMBER_OF_DIMENSIONS</a>,<span class="stringliteral">"Node's number-of-dimensions is not in legal range"</span>},
<a name="l00175"></a>00175   {<a class="code" href="_a_d_f_8h.html#a5fb621fd2346158d038017f457b1aae">CHILD_NOT_OF_GIVEN_PARENT</a>,<span class="stringliteral">"Specified child is NOT a child of the specified parent"</span>},
<a name="l00176"></a>00176   {<a class="code" href="_a_d_f_8h.html#f6444726292c84aff1853b7d08c9885f">INVALID_DATA_TYPE</a>,       <span class="stringliteral">"Invalid Data-Type"</span>},
<a name="l00177"></a>00177   {<a class="code" href="_a_d_f_8h.html#b35fccb34c6d5687da3115b8de46cc8c">NULL_POINTER</a>,            <span class="stringliteral">"A pointer is NULL"</span>},
<a name="l00178"></a>00178   {<a class="code" href="_a_d_f_8h.html#68de9030c39965958f08402f7d452ad9">NO_DATA</a>,                 <span class="stringliteral">"Node has no data associated with it"</span>},
<a name="l00179"></a>00179   {<a class="code" href="_a_d_f_8h.html#6b35a23a07baf407380c2180959891cf">END_OUT_OF_DEFINED_RANGE</a>,<span class="stringliteral">"Bad end value"</span>},
<a name="l00180"></a>00180   {<a class="code" href="_a_d_f_8h.html#0cffd9ee2b45ae3b288f7cf67ce5152a">BAD_STRIDE_VALUE</a>,        <span class="stringliteral">"Bad stride value"</span>},
<a name="l00181"></a>00181   {<a class="code" href="_a_d_f_8h.html#94a0cdb0fd0e777a6be3487d0ad4ca88">MINIMUM_GT_MAXIMUM</a>,      <span class="stringliteral">"Minimum value is greater than the maximum value"</span>},
<a name="l00182"></a>00182   {<a class="code" href="_a_d_f_8h.html#c2716c594ccc4b1e5b7211bea73f64eb">DATA_TYPE_NOT_SUPPORTED</a>, <span class="stringliteral">"The data format is not support on a particular machine"</span>},
<a name="l00183"></a>00183   {<a class="code" href="_a_d_f_8h.html#90a58f3ebb49feb9c649685a2bda29d9">FILE_CLOSE_ERROR</a>,        <span class="stringliteral">"File Close error"</span>},
<a name="l00184"></a>00184   {<a class="code" href="_a_d_f_8h.html#252d99de90a432d334fb5595317c600c">START_OUT_OF_DEFINED_RANGE</a>,<span class="stringliteral">"Bad start value"</span>},
<a name="l00185"></a>00185   {<a class="code" href="_a_d_f_8h.html#988c495417fd5dd167f486b660e3b9f1">ZERO_LENGTH_VALUE</a>,       <span class="stringliteral">"A value of zero is not allowable"</span>},
<a name="l00186"></a>00186   {<a class="code" href="_a_d_f_8h.html#27886fcf786592753add8f9b858fbc83">BAD_DIMENSION_VALUE</a>,     <span class="stringliteral">"Bad dimension value"</span>},
<a name="l00187"></a>00187   {<a class="code" href="_a_d_f_8h.html#a91c2ab448c8d7f214dd0c5da3938bc0">BAD_ERROR_STATE</a>,         <span class="stringliteral">"Error state must be either a 0 (zero) or a 1 (one)"</span>},
<a name="l00188"></a>00188   {<a class="code" href="_a_d_f_8h.html#e97b258b9c94100d89b8885ec63715d0">UNEQUAL_MEMORY_AND_DISK_DIMS</a>,<span class="stringliteral">"Unequal dimensional specifications for disk and memory"</span>},
<a name="l00189"></a>00189   {<a class="code" href="_a_d_f_8h.html#4fd71edd5d748313b7ea302b02f75751">NODE_IS_NOT_A_LINK</a>,      <span class="stringliteral">"The node is not a link.  It was expected to be a link"</span>},
<a name="l00190"></a>00190   {<a class="code" href="_a_d_f_8h.html#7ea4dc6d240b23a928f5033267bb8577">LINK_TARGET_NOT_THERE</a>,   <span class="stringliteral">"The linked-to node does not exist"</span>},
<a name="l00191"></a>00191   {<a class="code" href="_a_d_f_8h.html#253d84244d6f0963a8f102f2e9933ae3">LINKED_TO_FILE_NOT_THERE</a>,<span class="stringliteral">"The file of a linked-node is not accessable"</span>},
<a name="l00192"></a>00192   {<a class="code" href="_a_d_f_8h.html#8b688d04e1a4096f3fb1dc7a349e4724">INVALID_NODE_NAME</a>,       <span class="stringliteral">"Node name contains invalid characters"</span>},
<a name="l00193"></a>00193   {<a class="code" href="_a_d_f_8h.html#54445a38603f6cd016965674a8445d8f">FFLUSH_ERROR</a>,            <span class="stringliteral">"H5Fflush:flush error"</span>},
<a name="l00194"></a>00194   {<a class="code" href="_a_d_f_8h.html#df2b102a488b3458cf09fd19c761e546">NULL_NODEID_POINTER</a>,     <span class="stringliteral">"The node ID pointer is NULL"</span>},
<a name="l00195"></a>00195   {<a class="code" href="_a_d_f_8h.html#2b50898d048f390273d03f3f11ab3c13">MAX_FILE_SIZE_EXCEEDED</a>,  <span class="stringliteral">"The maximum size for a file exceeded"</span>},
<a name="l00196"></a>00196 
<a name="l00197"></a>00197   {<a class="code" href="_a_d_f_h_8h.html#86aa0bd6d6b753b66379001bed91c4f7">ADFH_ERR_GLINK</a>,          <span class="stringliteral">"H5Glink:soft link creation failed"</span>},
<a name="l00198"></a>00198   {<a class="code" href="_a_d_f_h_8h.html#f5ec726985784f32dc380457f8377ea8">ADFH_ERR_NO_ATT</a>,         <span class="stringliteral">"Node attribute doesn't exist"</span>},
<a name="l00199"></a>00199   {<a class="code" href="_a_d_f_h_8h.html#e2afa7d62d0239811af462694726eefc">ADFH_ERR_AOPEN</a>,          <span class="stringliteral">"H5Aopen:open of node attribute failed"</span>},
<a name="l00200"></a>00200   {<a class="code" href="_a_d_f_h_8h.html#8d3936d9cd3bd0388833f2112eaac660">ADFH_ERR_IGET_NAME</a>,      <span class="stringliteral">"H5Iget_name:failed to get node path from ID"</span>},
<a name="l00201"></a>00201   {<a class="code" href="_a_d_f_h_8h.html#a93b2aa8383610d85490d9e92ae6db82">ADFH_ERR_GMOVE</a>,          <span class="stringliteral">"H5Gmove:moving a node group failed"</span>},
<a name="l00202"></a>00202   {<a class="code" href="_a_d_f_h_8h.html#5d99e484b564733f75609670e7111550">ADFH_ERR_GUNLINK</a>,        <span class="stringliteral">"H5Gunlink:node group deletion failed"</span>},
<a name="l00203"></a>00203   {<a class="code" href="_a_d_f_h_8h.html#d3f9f448401f1521079197a63268ad12">ADFH_ERR_GOPEN</a>,          <span class="stringliteral">"H5Gopen:open of a node group failed"</span>},
<a name="l00204"></a>00204   {<a class="code" href="_a_d_f_h_8h.html#dc14226dccce3a22d6bd6d1b259ff095">ADFH_ERR_DGET_SPACE</a>,     <span class="stringliteral">"H5Dget_space:couldn't get node dataspace"</span>},
<a name="l00205"></a>00205   {<a class="code" href="_a_d_f_h_8h.html#d5353af9a9320cb5b2e6847575d57242">ADFH_ERR_DOPEN</a>,          <span class="stringliteral">"H5Dopen:open of the node data failed"</span>},
<a name="l00206"></a>00206   {<a class="code" href="_a_d_f_h_8h.html#ffaa8c537e8cfd190388ec1127e988c7">ADFH_ERR_DEXTEND</a>,        <span class="stringliteral">"H5Dextend:couldn't extend the node dataspace"</span>},
<a name="l00207"></a>00207   {<a class="code" href="_a_d_f_h_8h.html#3461ee8f8e0e314347cfe9af2126aff8">ADFH_ERR_DCREATE</a>,        <span class="stringliteral">"H5Dcreate:node data creation failed"</span>},
<a name="l00208"></a>00208   {<a class="code" href="_a_d_f_h_8h.html#27b6c0c0f7e5b1b919d6a1dfe2e74d28">ADFH_ERR_SCREATE_SIMPLE</a>, <span class="stringliteral">"H5Screate_simple:dataspace creation failed"</span>},
<a name="l00209"></a>00209   {<a class="code" href="_a_d_f_h_8h.html#b49e0f4870ed40d55a99be5eedbf9695">ADFH_ERR_ACREATE</a>,        <span class="stringliteral">"H5Acreate:node attribute creation failed"</span>},
<a name="l00210"></a>00210   {<a class="code" href="_a_d_f_h_8h.html#d2f3154b82cce91b870ea0c7d0cfceb5">ADFH_ERR_GCREATE</a>,        <span class="stringliteral">"H5Gcreate:node group creation failed"</span>},
<a name="l00211"></a>00211   {<a class="code" href="_a_d_f_h_8h.html#5e8ecab15f74022e5350cf299562648b">ADFH_ERR_DWRITE</a>,         <span class="stringliteral">"H5Dwrite:write to node data failed"</span>},
<a name="l00212"></a>00212   {<a class="code" href="_a_d_f_h_8h.html#2fecb63aadd6d46ba3395d86f04f9745">ADFH_ERR_DREAD</a>,          <span class="stringliteral">"H5Dread:read of node data failed"</span>},
<a name="l00213"></a>00213   {<a class="code" href="_a_d_f_h_8h.html#843fe15d47a6527bc118c9db5b7def11">ADFH_ERR_AWRITE</a>,         <span class="stringliteral">"H5Awrite:write to node attribute failed"</span>},
<a name="l00214"></a>00214   {<a class="code" href="_a_d_f_h_8h.html#ebdc5b21cd63a953f31ff6af5f0bbfb2">ADFH_ERR_AREAD</a>,          <span class="stringliteral">"H5Aread:read of node attribute failed"</span>},
<a name="l00215"></a>00215   {<a class="code" href="_a_d_f_h_8h.html#a8f1acad0e855a7cf27664eca0404d57">ADFH_ERR_FMOUNT</a>,         <span class="stringliteral">"H5Fmount:file mount failed"</span>},
<a name="l00216"></a>00216   {<a class="code" href="_a_d_f_h_8h.html#a81b878412d4b5969a7782ec2ea8e1ee">ADFH_ERR_LINK_MOVE</a>,      <span class="stringliteral">"Can't move a linked-to node"</span>},
<a name="l00217"></a>00217   {<a class="code" href="_a_d_f_h_8h.html#0e83ca5faed8218096517883dfbe6f78">ADFH_ERR_LINK_DATA</a>,      <span class="stringliteral">"Can't change the data for a linked-to node"</span>},
<a name="l00218"></a>00218   {<a class="code" href="_a_d_f_h_8h.html#98cb7734be0f4be78135e2cffc6f44cc">ADFH_ERR_LINK_NODE</a>,      <span class="stringliteral">"Parent of node is a link"</span>},
<a name="l00219"></a>00219   {<a class="code" href="_a_d_f_h_8h.html#eb557f508be07956e8ecb7a88954574d">ADFH_ERR_LINK_DELETE</a>,    <span class="stringliteral">"Can't delete a linked-to node"</span>},
<a name="l00220"></a>00220   {<a class="code" href="_a_d_f_h_8h.html#9f4e5c3e35e0eda8d160badc9d9181a8">ADFH_ERR_NOT_HDF5_FILE</a>,  <span class="stringliteral">"File does not exist or is not a HDF5 file"</span>},
<a name="l00221"></a>00221   {<a class="code" href="_a_d_f_h_8h.html#5a3ffddfc72040bf656aa06d442e04d7">ADFH_ERR_FILE_DELETE</a>,    <span class="stringliteral">"unlink (delete) of file failed"</span>},
<a name="l00222"></a>00222   {<a class="code" href="_a_d_f_h_8h.html#d8e46d3c75ace36ca97661e438183676">ADFH_ERR_FILE_INDEX</a>,     <span class="stringliteral">"couldn't get file index from node ID"</span>},
<a name="l00223"></a>00223   {<a class="code" href="_a_d_f_h_8h.html#a86236f7cd1b483f7f31721bd13c6065">ADFH_ERR_TCOPY</a>,          <span class="stringliteral">"H5Tcopy:copy of existing datatype failed"</span>},
<a name="l00224"></a>00224   {<a class="code" href="_a_d_f_h_8h.html#81bbf065bd06664758338f03b261864a">ADFH_ERR_AGET_TYPE</a>,      <span class="stringliteral">"H5Aget_type:couldn't get attribute datatype"</span>},
<a name="l00225"></a>00225   {<a class="code" href="_a_d_f_h_8h.html#7f218020a1708df78882faf79e847a9d">ADFH_ERR_TSET_SIZE</a>,      <span class="stringliteral">"H5Tset_size:couldn't set datatype size"</span>},
<a name="l00226"></a>00226   {<a class="code" href="_a_d_f_h_8h.html#0157dcee1ccd586ff7641e635db4db1c">ADFH_ERR_NOT_IMPLEMENTED</a>,<span class="stringliteral">"routine not implemented"</span>},
<a name="l00227"></a>00227   {<a class="code" href="_a_d_f_h_8h.html#ef1054d36dd4c8a70d0f59c7e6c8effc">ADFH_ERR_NOTXLINK</a>,       <span class="stringliteral">"H5L: Link target is not an HDF5 external link"</span>},
<a name="l00228"></a>00228   {<a class="code" href="_a_d_f_h_8h.html#e4c8e2d37d921b2aab27c4818d9f72f2">ADFH_ERR_LIBREG</a>,         <span class="stringliteral">"HDF5: No external link feature available"</span>},
<a name="l00229"></a>00229   {<a class="code" href="_a_d_f_h_8h.html#abbbc98607dbb9c029889fc61a413459">ADFH_ERR_OBJINFO_FAILED</a>, <span class="stringliteral">"HDF5: Internal problem with objinfo"</span>},
<a name="l00230"></a>00230   {<a class="code" href="_a_d_f_h_8h.html#1bf1cfac13b62e173e1910904d38a46f">ADFH_ERR_XLINK_NOVAL</a>,    <span class="stringliteral">"HDF5: No value for external link"</span>},
<a name="l00231"></a>00231   {<a class="code" href="_a_d_f_h_8h.html#39655d8ef07694ce40763929053e3849">ADFH_ERR_XLINK_UNPACK</a>,   <span class="stringliteral">"HDF5: Cannot unpack external link"</span>},
<a name="l00232"></a>00232   {<a class="code" href="_a_d_f_h_8h.html#6f947c806896b40d6524f937d510c1b2">ADFH_ERR_ROOTNULL</a>,       <span class="stringliteral">"HDF5: Root descriptor is NULL"</span>},
<a name="l00233"></a>00233   {<a class="code" href="_a_d_f_h_8h.html#8a4c1a288f543991661f4d4b19fda550">ADFH_ERR_NEED_TRANSPOSE</a>, <span class="stringliteral">"dimensions need transposed - open in modify mode"</span>},
<a name="l00234"></a>00234 
<a name="l00235"></a>00235   {<a class="code" href="_a_d_f_h_8h.html#d60a12102c0b4555d097f06c7c85b8f9">ADFH_ERR_SENTINEL</a>,       <span class="stringliteral">"&lt;None&gt;"</span>}
<a name="l00236"></a>00236 };
<a name="l00237"></a>00237 
<a name="l00238"></a><a class="code" href="_a_d_f_h_8c.html#8d76228545c2552584055a1e1d1787f3">00238</a> <span class="preprocessor">#define NUM_ERRORS (sizeof(ErrorList)/sizeof(struct _ErrorList))</span>
<a name="l00239"></a><a class="code" href="_a_d_f_h_8c.html#8c14d72149efef586123816eb46243b0">00239</a> <span class="preprocessor"></span><span class="preprocessor">#define ROOT_OR_DIE(err) \</span>
<a name="l00240"></a>00240 <span class="preprocessor">if (mta_root == NULL){set_error(ADFH_ERR_ROOTNULL, err);return;} </span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>
<a name="l00242"></a>00242 <span class="comment">/* usefull macros */</span>
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="_a_d_f_h_8c.html#6c0692391e581b68dbc1ce69d11be5c9">00244</a> <span class="preprocessor">#define CMP_OSTAT(r,n) ((r)-&gt;objno[0]==(n)-&gt;objno[0] &amp;&amp; \</span>
<a name="l00245"></a>00245 <span class="preprocessor">                        (r)-&gt;objno[1]==(n)-&gt;objno[1] &amp;&amp; \</span>
<a name="l00246"></a>00246 <span class="preprocessor">                        (r)-&gt;fileno[0]==(n)-&gt;fileno[0] &amp;&amp; \</span>
<a name="l00247"></a>00247 <span class="preprocessor">                        (r)-&gt;fileno[1]==(n)-&gt;fileno[1])</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span>
<a name="l00249"></a>00249 <span class="keyword">static</span> herr_t gfind_by_name(hid_t, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">void</span> *);
<a name="l00250"></a>00250 <span class="keyword">static</span> herr_t gprint_name(hid_t, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">void</span> *);
<a name="l00251"></a>00251 <span class="keyword">static</span> herr_t find_by_name(hid_t, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> H5A_info_t*, <span class="keywordtype">void</span> *);
<a name="l00252"></a>00252 <span class="keyword">static</span> herr_t print_name(hid_t, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> H5A_info_t*, <span class="keywordtype">void</span> *);
<a name="l00253"></a>00253 
<a name="l00254"></a><a class="code" href="_a_d_f_h_8c.html#69333d10b425a9ca3871a4ca6d453025">00254</a> <span class="preprocessor">#define has_child(ID,NAME) H5Giterate(ID,".",NULL,gfind_by_name,(void *)NAME)</span>
<a name="l00255"></a><a class="code" href="_a_d_f_h_8c.html#d05c7d5eb688634c398c562af1fb8680">00255</a> <span class="preprocessor"></span><span class="preprocessor">#define has_data(ID)       H5Giterate(ID,".",NULL,gfind_by_name,(void *)D_DATA)</span>
<a name="l00256"></a><a class="code" href="_a_d_f_h_8c.html#aaf7485208f07f30e98eb000799ee0d0">00256</a> <span class="preprocessor"></span><span class="preprocessor">#define show_grp(ID)       H5Giterate(ID,".",NULL,gprint_name,(void *)"GRP")</span>
<a name="l00257"></a>00257 <span class="preprocessor"></span>
<a name="l00258"></a><a class="code" href="_a_d_f_h_8c.html#c4c10ed727eb7290389ba66a76877483">00258</a> <span class="preprocessor">#define has_att(ID,NAME)   H5Aiterate2(ID,H5_INDEX_NAME,H5_ITER_NATIVE,NULL,find_by_name,(void *)NAME)</span>
<a name="l00259"></a><a class="code" href="_a_d_f_h_8c.html#a18874e17099718cac8db38ffaf98c90">00259</a> <span class="preprocessor"></span><span class="preprocessor">#define show_att(ID,NAME)  H5Aiterate2(ID,H5_INDEX_NAME,H5_ITER_NATIVE,NULL,print_name,(void *)NAME)</span>
<a name="l00260"></a>00260 <span class="preprocessor"></span>
<a name="l00261"></a>00261 <span class="comment">/* ----------------------------------------------------------------</span>
<a name="l00262"></a>00262 <span class="comment"> * set error and terminate if error state set</span>
<a name="l00263"></a>00263 <span class="comment"> * ---------------------------------------------------------------- */</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<span class="keywordtype">int</span> errcode, <span class="keywordtype">int</span> *err)
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267   <span class="keywordflow">if</span> ((mta_root != NULL)&amp;&amp;(errcode != <a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>)&amp;&amp;(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#aef892c12b8d134d4574c34a74aa267a">g_error_state</a>))
<a name="l00268"></a>00268   {
<a name="l00269"></a>00269     <span class="keywordtype">char</span> <a class="code" href="write__test_8c.html#2141b8541565b9145c450f46c23fdd31">errmsg</a>[<a class="code" href="_a_d_f_8h.html#a6895fcdf90f6c7f8c4243b6f4a132cb">ADF_MAX_ERROR_STR_LENGTH</a>+1];
<a name="l00270"></a>00270     <a class="code" href="_a_d_f_h_8c.html#00a2e1b7e6d3a97787b4c0b9a1a24348">ADFH_Error_Message</a>(errcode, errmsg);
<a name="l00271"></a>00271     fprintf(stderr, <span class="stringliteral">"ERROR:%s\n"</span>, errmsg);
<a name="l00272"></a>00272     exit(1);
<a name="l00273"></a>00273   }
<a name="l00274"></a>00274   *err = errcode;
<a name="l00275"></a>00275 }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 <span class="comment">/* ----- handle HDF5 errors --------------------------------------- */</span>
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="keyword">static</span> herr_t print_H5_error(<span class="keywordtype">int</span> n, H5E_error2_t *desc, <span class="keywordtype">void</span> *<a class="code" href="_a_d_f__internals_8h.html#1c4032c79398d15869ce0828a58de11f">data</a>)
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281   <span class="keyword">const</span> <span class="keywordtype">char</span> *p;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   <span class="keywordflow">if</span> ((p = strrchr(desc-&gt;file_name, <span class="charliteral">'/'</span>)) == NULL &amp;&amp;
<a name="l00284"></a>00284       (p = strrchr(desc-&gt;file_name, <span class="charliteral">'\\'</span>)) == NULL)
<a name="l00285"></a>00285     p = desc-&gt;file_name;
<a name="l00286"></a>00286   <span class="keywordflow">else</span>
<a name="l00287"></a>00287     p++;
<a name="l00288"></a>00288   fprintf(stderr, <span class="stringliteral">"%s line %u in %s(): %s\n"</span>, p,
<a name="l00289"></a>00289     desc-&gt;line, desc-&gt;func_name, desc-&gt;desc);
<a name="l00290"></a>00290   <span class="keywordflow">return</span> 0;
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="keyword">static</span> herr_t walk_H5_error(hid_t estack, <span class="keywordtype">void</span> *data)
<a name="l00296"></a>00296 {
<a name="l00297"></a>00297   <span class="keywordflow">if</span> ((mta_root != NULL) &amp;&amp; (mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#aef892c12b8d134d4574c34a74aa267a">g_error_state</a>)) {
<a name="l00298"></a>00298     fflush(stdout);
<a name="l00299"></a>00299     fprintf(stderr, <span class="stringliteral">"\nHDF5 Error Trace Back\n"</span>);
<a name="l00300"></a>00300     <span class="keywordflow">return</span> H5Ewalk2(H5E_DEFAULT, H5E_WALK_DOWNWARD, 
<a name="l00301"></a>00301                     (H5E_walk2_t)print_H5_error, data);
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303   <span class="keywordflow">return</span> 0;
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">/*-----------------------------------------------------------------</span>
<a name="l00307"></a>00307 <span class="comment"> * get the native format - returns pointer to static storage</span>
<a name="l00308"></a>00308 <span class="comment"> *----------------------------------------------------------------- */</span>
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 <span class="keyword">static</span> <span class="keywordtype">char</span> *native_format(<span class="keywordtype">void</span>)
<a name="l00311"></a>00311 {
<a name="l00312"></a>00312   <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="_a_d_f__internals_8h.html#f39d9ddd17f3c7f030824f9b612e54c6">format</a>[<a class="code" href="_a_d_f_8h.html#4bc0556aa5a3ad7bdd5592b49ffadb0c">ADF_FORMAT_LENGTH</a>+1];
<a name="l00313"></a>00313   hid_t type = H5Tcopy(H5T_NATIVE_FLOAT);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(type);
<a name="l00316"></a>00316   <span class="keywordflow">if</span> (H5Tequal(type, H5T_IEEE_F32BE))
<a name="l00317"></a>00317     strcpy(format, <span class="stringliteral">"IEEE_BIG_32"</span>);
<a name="l00318"></a>00318   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (H5Tequal(type, H5T_IEEE_F32LE))
<a name="l00319"></a>00319     strcpy(format, <span class="stringliteral">"IEEE_LITTLE_32"</span>);
<a name="l00320"></a>00320   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (H5Tequal(type, H5T_IEEE_F64BE))
<a name="l00321"></a>00321     strcpy(format, <span class="stringliteral">"IEEE_BIG_64"</span>);
<a name="l00322"></a>00322   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (H5Tequal(type, H5T_IEEE_F64LE))
<a name="l00323"></a>00323     strcpy(format, <span class="stringliteral">"IEEE_LITTLE_64"</span>);
<a name="l00324"></a>00324   <span class="keywordflow">else</span>
<a name="l00325"></a>00325     sprintf(format, <span class="stringliteral">"NATIVE_%d"</span>, H5Tget_precision(type));
<a name="l00326"></a>00326   H5Tclose(type);
<a name="l00327"></a>00327   <span class="keywordflow">return</span> format;
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="comment">/* ----------------------------------------------------------------</span>
<a name="l00331"></a>00331 <span class="comment"> * convert between HDF5 and ADF ids</span>
<a name="l00332"></a>00332 <span class="comment"> * ---------------------------------------------------------------- */</span>
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="preprocessor">#if 1</span>
<a name="l00335"></a>00335 <span class="preprocessor"></span>
<a name="l00336"></a><a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">00336</a> <span class="preprocessor"># define to_HDF_ID(ID) (hid_t) (ID)</span>
<a name="l00337"></a><a class="code" href="_a_d_f_h_8c.html#c075abfe5b07d68a3eeb5fb874982dc4">00337</a> <span class="preprocessor"></span><span class="preprocessor"># define to_ADF_ID(ID) (double)(ID)</span>
<a name="l00338"></a>00338 <span class="preprocessor"></span>
<a name="l00339"></a>00339 <span class="preprocessor">#else</span>
<a name="l00340"></a>00340 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">union </span>{
<a name="l00341"></a>00341   hid_t hdf_id;
<a name="l00342"></a>00342   <span class="keywordtype">double</span> adf_id;
<a name="l00343"></a>00343 } ID_CONVERT;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="keyword">static</span> hid_t <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a> (<span class="keywordtype">double</span> adf_id) {
<a name="l00346"></a>00346   ID_CONVERT.hdf_id = 0;
<a name="l00347"></a>00347   ID_CONVERT.adf_id = adf_id;
<a name="l00348"></a>00348   <span class="keywordflow">return</span> ID_CONVERT.hdf_id;
<a name="l00349"></a>00349 }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="_a_d_f_h_8c.html#c075abfe5b07d68a3eeb5fb874982dc4">to_ADF_ID</a> (hid_t hdf_id) {
<a name="l00352"></a>00352   ID_CONVERT.adf_id = 0;
<a name="l00353"></a>00353   ID_CONVERT.hdf_id = hdf_id;
<a name="l00354"></a>00354   <span class="keywordflow">return</span> ID_CONVERT.adf_id;
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 <span class="preprocessor">#endif</span>
<a name="l00357"></a>00357 <span class="preprocessor"></span>
<a name="l00358"></a>00358 <span class="comment">/* -----------------------------------------------------------------</span>
<a name="l00359"></a>00359 <span class="comment"> * set/get attribute values</span>
<a name="l00360"></a>00360 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 <span class="keyword">static</span> hid_t get_att_id(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> *err)
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364   hid_t aid = H5Aopen_name(<span class="keywordtype">id</span>, name);
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   <span class="comment">/* H5Aclose() performed elsewhere */</span>
<a name="l00367"></a>00367   <span class="keywordflow">if</span> (aid &lt; 0) {
<a name="l00368"></a>00368     <span class="keywordflow">if</span> (!<a class="code" href="_a_d_f_h_8c.html#c4c10ed727eb7290389ba66a76877483">has_att</a>(<span class="keywordtype">id</span>, name))
<a name="l00369"></a>00369       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#f5ec726985784f32dc380457f8377ea8">ADFH_ERR_NO_ATT</a>, err);
<a name="l00370"></a>00370     <span class="keywordflow">else</span>
<a name="l00371"></a>00371       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#e2afa7d62d0239811af462694726eefc">ADFH_ERR_AOPEN</a>, err);
<a name="l00372"></a>00372   }
<a name="l00373"></a>00373   <span class="keywordflow">else</span>
<a name="l00374"></a>00374     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l00375"></a>00375   <span class="keywordflow">return</span> aid;
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00379"></a>00379 <span class="keyword">static</span> <span class="keywordtype">int</span> new_str_att(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value,
<a name="l00380"></a>00380                        <span class="keywordtype">int</span> max_size, <span class="keywordtype">int</span> *err)
<a name="l00381"></a>00381 {
<a name="l00382"></a>00382 <span class="preprocessor">#ifdef ADFH_USE_STRINGS</span>
<a name="l00383"></a>00383 <span class="preprocessor"></span>  hid_t sid, tid, aid;
<a name="l00384"></a>00384   herr_t status;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386   <span class="comment">/* [1] the attribute is set on the GROUP (id is a group id) */</span>
<a name="l00387"></a>00387   <span class="comment">/* [2] all datatypes should be H5T_STRING and not H5T_NATIVE_CHAR</span>
<a name="l00388"></a>00388 <span class="comment">         which requires an array (see case below with a H5Screate_simple</span>
<a name="l00389"></a>00389 <span class="comment">         and providse an array of chars)</span>
<a name="l00390"></a>00390 <span class="comment">  */</span>
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   sid = H5Screate(H5S_SCALAR);
<a name="l00393"></a>00393   <span class="keywordflow">if</span> (sid &lt; 0) {
<a name="l00394"></a>00394     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#27b6c0c0f7e5b1b919d6a1dfe2e74d28">ADFH_ERR_SCREATE_SIMPLE</a>, err);
<a name="l00395"></a>00395     <span class="keywordflow">return</span> 1;
<a name="l00396"></a>00396   }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398   tid = H5Tcopy(H5T_C_S1);
<a name="l00399"></a>00399   <span class="keywordflow">if</span> (tid &lt; 0) {
<a name="l00400"></a>00400     H5Sclose(sid);
<a name="l00401"></a>00401     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#a86236f7cd1b483f7f31721bd13c6065">ADFH_ERR_TCOPY</a>, err);
<a name="l00402"></a>00402     <span class="keywordflow">return</span> 1;
<a name="l00403"></a>00403   }
<a name="l00404"></a>00404   <span class="keywordflow">if</span> (H5Tset_size(tid, max_size + 1) &lt; 0) {
<a name="l00405"></a>00405     H5Tclose(tid);
<a name="l00406"></a>00406     H5Sclose(sid);
<a name="l00407"></a>00407     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#7f218020a1708df78882faf79e847a9d">ADFH_ERR_TSET_SIZE</a>, err);
<a name="l00408"></a>00408     <span class="keywordflow">return</span> 1;
<a name="l00409"></a>00409   }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411   aid = H5Acreate(<span class="keywordtype">id</span>, name, tid, sid, H5P_DEFAULT, H5P_DEFAULT);
<a name="l00412"></a>00412   <span class="keywordflow">if</span> (aid &lt; 0) {
<a name="l00413"></a>00413     H5Tclose(tid);
<a name="l00414"></a>00414     H5Sclose(sid);
<a name="l00415"></a>00415     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#b49e0f4870ed40d55a99be5eedbf9695">ADFH_ERR_ACREATE</a>, err);
<a name="l00416"></a>00416     <span class="keywordflow">return</span> 1;
<a name="l00417"></a>00417   }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419   status = H5Awrite(aid, tid, value);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   H5Aclose(aid);
<a name="l00422"></a>00422   H5Tclose(tid);
<a name="l00423"></a>00423   H5Sclose(sid);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l00426"></a>00426     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#843fe15d47a6527bc118c9db5b7def11">ADFH_ERR_AWRITE</a>, err);
<a name="l00427"></a>00427     <span class="keywordflow">return</span> 1;
<a name="l00428"></a>00428   }
<a name="l00429"></a>00429   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l00430"></a>00430   <span class="keywordflow">return</span> 0;
<a name="l00431"></a>00431 <span class="preprocessor">#else</span>
<a name="l00432"></a>00432 <span class="preprocessor"></span>  <span class="comment">/* CAUTION: unly use this for strings &lt;= ADF_FILENAME_LENGTH */</span>
<a name="l00433"></a>00433   hid_t sid, aid;
<a name="l00434"></a>00434   hsize_t dim;
<a name="l00435"></a>00435   herr_t status;
<a name="l00436"></a>00436   <span class="keywordtype">char</span> buff[<a class="code" href="_a_d_f_8h.html#a732a37d0186fbe66134811d3c99372a">ADF_FILENAME_LENGTH</a>+1];
<a name="l00437"></a>00437 
<a name="l00438"></a>00438   dim = max_size + 1;
<a name="l00439"></a>00439   sid = H5Screate_simple(1, &amp;dim, NULL);
<a name="l00440"></a>00440   <span class="keywordflow">if</span> (sid &lt; 0) {
<a name="l00441"></a>00441     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#27b6c0c0f7e5b1b919d6a1dfe2e74d28">ADFH_ERR_SCREATE_SIMPLE</a>, err);
<a name="l00442"></a>00442     <span class="keywordflow">return</span> 1;
<a name="l00443"></a>00443   }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445   aid = H5Acreate(<span class="keywordtype">id</span>, name, H5T_NATIVE_CHAR, sid, H5P_DEFAULT, H5P_DEFAULT);
<a name="l00446"></a>00446   <span class="keywordflow">if</span> (aid &lt; 0) {
<a name="l00447"></a>00447     H5Sclose(sid);
<a name="l00448"></a>00448     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#b49e0f4870ed40d55a99be5eedbf9695">ADFH_ERR_ACREATE</a>, err);
<a name="l00449"></a>00449     <span class="keywordflow">return</span> 1;
<a name="l00450"></a>00450   }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452   memset(buff, 0, <a class="code" href="_a_d_f_8h.html#a732a37d0186fbe66134811d3c99372a">ADF_FILENAME_LENGTH</a>+1);
<a name="l00453"></a>00453   strcpy(buff, value);
<a name="l00454"></a>00454   status = H5Awrite(aid, H5T_NATIVE_CHAR, buff);
<a name="l00455"></a>00455 
<a name="l00456"></a>00456   H5Aclose(aid);
<a name="l00457"></a>00457   H5Sclose(sid);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l00460"></a>00460     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#843fe15d47a6527bc118c9db5b7def11">ADFH_ERR_AWRITE</a>, err);
<a name="l00461"></a>00461     <span class="keywordflow">return</span> 1;
<a name="l00462"></a>00462   }
<a name="l00463"></a>00463   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l00464"></a>00464   <span class="keywordflow">return</span> 0;
<a name="l00465"></a>00465 <span class="preprocessor">#endif</span>
<a name="l00466"></a>00466 <span class="preprocessor"></span>}
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00469"></a>00469 <span class="keyword">static</span> <span class="keywordtype">int</span> get_str_att(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">char</span> *value, <span class="keywordtype">int</span> *err)
<a name="l00470"></a>00470 {
<a name="l00471"></a>00471 <span class="preprocessor">#ifdef ADFH_USE_STRINGS</span>
<a name="l00472"></a>00472 <span class="preprocessor"></span>  hid_t tid, att_id;
<a name="l00473"></a>00473   herr_t status;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH get_str_att [%s]"</span>,name)); 
<a name="l00476"></a>00476   <span class="keywordflow">if</span> ((att_id = get_att_id(<span class="keywordtype">id</span>, name, err)) &lt; 0) <span class="keywordflow">return</span> 1;
<a name="l00477"></a>00477 <span class="preprocessor">#if 0</span>
<a name="l00478"></a>00478 <span class="preprocessor"></span>  status = H5Aread(att_id, H5T_NATIVE_CHAR, value);
<a name="l00479"></a>00479 <span class="preprocessor">#else</span>
<a name="l00480"></a>00480 <span class="preprocessor"></span>  tid = H5Aget_type(att_id);
<a name="l00481"></a>00481   <span class="keywordflow">if</span> (tid &lt; 0) {
<a name="l00482"></a>00482     H5Aclose(att_id);
<a name="l00483"></a>00483     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#81bbf065bd06664758338f03b261864a">ADFH_ERR_AGET_TYPE</a>, err);
<a name="l00484"></a>00484     <span class="keywordflow">return</span> 1;
<a name="l00485"></a>00485   }
<a name="l00486"></a>00486   status = H5Aread(att_id, tid, value);
<a name="l00487"></a>00487   H5Tclose(tid);
<a name="l00488"></a>00488 <span class="preprocessor">#endif</span>
<a name="l00489"></a>00489 <span class="preprocessor"></span>  H5Aclose(att_id);
<a name="l00490"></a>00490   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&lt;ADFH get_str_att [%s][%s]"</span>,name,value));
<a name="l00491"></a>00491   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l00492"></a>00492     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#ebdc5b21cd63a953f31ff6af5f0bbfb2">ADFH_ERR_AREAD</a>, err);
<a name="l00493"></a>00493     <span class="keywordflow">return</span> 1;
<a name="l00494"></a>00494   }
<a name="l00495"></a>00495   <span class="keywordflow">return</span> 0;
<a name="l00496"></a>00496 <span class="preprocessor">#else</span>
<a name="l00497"></a>00497 <span class="preprocessor"></span>  <span class="comment">/* CAUTION: unly use this for strings &lt;= ADF_FILENAME_LENGTH */</span>
<a name="l00498"></a>00498   hid_t att_id;
<a name="l00499"></a>00499   herr_t status;
<a name="l00500"></a>00500   <span class="keywordtype">char</span> buff[<a class="code" href="_a_d_f_8h.html#a732a37d0186fbe66134811d3c99372a">ADF_FILENAME_LENGTH</a>+1];
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <span class="keywordflow">if</span> ((att_id = get_att_id(<span class="keywordtype">id</span>, name, err)) &lt; 0) <span class="keywordflow">return</span> 1;
<a name="l00503"></a>00503   status = H5Aread(att_id, H5T_NATIVE_CHAR, buff);
<a name="l00504"></a>00504   H5Aclose(att_id);
<a name="l00505"></a>00505   strcpy(value, buff);
<a name="l00506"></a>00506   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l00507"></a>00507     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#ebdc5b21cd63a953f31ff6af5f0bbfb2">ADFH_ERR_AREAD</a>, err);
<a name="l00508"></a>00508     <span class="keywordflow">return</span> 1;
<a name="l00509"></a>00509   }
<a name="l00510"></a>00510   <span class="keywordflow">return</span> 0;
<a name="l00511"></a>00511 <span class="preprocessor">#endif</span>
<a name="l00512"></a>00512 <span class="preprocessor"></span>}
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 <span class="keyword">static</span> <span class="keywordtype">int</span> set_str_att(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value, <span class="keywordtype">int</span> *err)
<a name="l00517"></a>00517 {
<a name="l00518"></a>00518 <span class="preprocessor">#ifdef ADFH_USE_STRINGS</span>
<a name="l00519"></a>00519 <span class="preprocessor"></span>  hid_t tid, att_id;
<a name="l00520"></a>00520   herr_t status;
<a name="l00521"></a>00521 
<a name="l00522"></a>00522   <span class="keywordflow">if</span> ((att_id = get_att_id(<span class="keywordtype">id</span>, name, err)) &lt; 0) <span class="keywordflow">return</span> 1;
<a name="l00523"></a>00523   tid = H5Aget_type(att_id);
<a name="l00524"></a>00524   <span class="keywordflow">if</span> (tid &lt; 0) {
<a name="l00525"></a>00525     H5Aclose(att_id);
<a name="l00526"></a>00526     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#81bbf065bd06664758338f03b261864a">ADFH_ERR_AGET_TYPE</a>, err);
<a name="l00527"></a>00527     <span class="keywordflow">return</span> 1;
<a name="l00528"></a>00528   }
<a name="l00529"></a>00529   status = H5Awrite(att_id, tid, value);
<a name="l00530"></a>00530   H5Tclose(tid);
<a name="l00531"></a>00531   H5Aclose(att_id);
<a name="l00532"></a>00532   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l00533"></a>00533     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#843fe15d47a6527bc118c9db5b7def11">ADFH_ERR_AWRITE</a>, err);
<a name="l00534"></a>00534     <span class="keywordflow">return</span> 1;
<a name="l00535"></a>00535   }
<a name="l00536"></a>00536   <span class="keywordflow">return</span> 0;
<a name="l00537"></a>00537 <span class="preprocessor">#else</span>
<a name="l00538"></a>00538 <span class="preprocessor"></span>  <span class="comment">/* CAUTION: unly use this for strings &lt;= ADF_FILENAME_LENGTH */</span>
<a name="l00539"></a>00539   hid_t att_id;
<a name="l00540"></a>00540   herr_t status;
<a name="l00541"></a>00541   <span class="keywordtype">char</span> buff[<a class="code" href="_a_d_f_8h.html#a732a37d0186fbe66134811d3c99372a">ADF_FILENAME_LENGTH</a>+1];
<a name="l00542"></a>00542 
<a name="l00543"></a>00543   <span class="keywordflow">if</span> ((att_id = get_att_id(<span class="keywordtype">id</span>, name, err)) &lt; 0) <span class="keywordflow">return</span> 1;
<a name="l00544"></a>00544   memset(buff, 0, <a class="code" href="_a_d_f_8h.html#a732a37d0186fbe66134811d3c99372a">ADF_FILENAME_LENGTH</a>+1);
<a name="l00545"></a>00545   strcpy(buff, value);
<a name="l00546"></a>00546   status = H5Awrite(att_id, H5T_NATIVE_CHAR, buff);
<a name="l00547"></a>00547   H5Aclose(att_id);
<a name="l00548"></a>00548   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l00549"></a>00549     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#843fe15d47a6527bc118c9db5b7def11">ADFH_ERR_AWRITE</a>, err);
<a name="l00550"></a>00550     <span class="keywordflow">return</span> 1;
<a name="l00551"></a>00551   }
<a name="l00552"></a>00552   <span class="keywordflow">return</span> 0;
<a name="l00553"></a>00553 <span class="preprocessor">#endif</span>
<a name="l00554"></a>00554 <span class="preprocessor"></span>}
<a name="l00555"></a>00555 
<a name="l00556"></a>00556 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="keyword">static</span> <span class="keywordtype">int</span> new_int_att(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> value, <span class="keywordtype">int</span> *err)
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560   hid_t sid, aid;
<a name="l00561"></a>00561   hsize_t dim;
<a name="l00562"></a>00562   herr_t status;
<a name="l00563"></a>00563   <span class="keywordtype">int</span> buff = value;
<a name="l00564"></a>00564 
<a name="l00565"></a>00565   dim = 1;
<a name="l00566"></a>00566   sid = H5Screate_simple(1, &amp;dim, NULL);
<a name="l00567"></a>00567   <span class="keywordflow">if</span> (sid &lt; 0) {
<a name="l00568"></a>00568     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#27b6c0c0f7e5b1b919d6a1dfe2e74d28">ADFH_ERR_SCREATE_SIMPLE</a>, err);
<a name="l00569"></a>00569     <span class="keywordflow">return</span> 1;
<a name="l00570"></a>00570   }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572   aid = H5Acreate(<span class="keywordtype">id</span>, name, H5T_NATIVE_INT, sid, H5P_DEFAULT, H5P_DEFAULT);
<a name="l00573"></a>00573   <span class="keywordflow">if</span> (aid &lt; 0) {
<a name="l00574"></a>00574     H5Sclose(sid);
<a name="l00575"></a>00575     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#b49e0f4870ed40d55a99be5eedbf9695">ADFH_ERR_ACREATE</a>, err);
<a name="l00576"></a>00576     <span class="keywordflow">return</span> 1;
<a name="l00577"></a>00577   }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   status = H5Awrite(aid, H5T_NATIVE_INT, &amp;buff);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581   H5Aclose(aid);
<a name="l00582"></a>00582   H5Sclose(sid);
<a name="l00583"></a>00583 
<a name="l00584"></a>00584   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l00585"></a>00585     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#843fe15d47a6527bc118c9db5b7def11">ADFH_ERR_AWRITE</a>, err);
<a name="l00586"></a>00586     <span class="keywordflow">return</span> 1;
<a name="l00587"></a>00587   }
<a name="l00588"></a>00588   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l00589"></a>00589   <span class="keywordflow">return</span> 0;
<a name="l00590"></a>00590 }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 <span class="keyword">static</span> <span class="keywordtype">int</span> get_int_att(hid_t <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> *value, <span class="keywordtype">int</span> *err)
<a name="l00595"></a>00595 {
<a name="l00596"></a>00596   hid_t att_id;
<a name="l00597"></a>00597   herr_t status;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   <span class="keywordflow">if</span> ((att_id = get_att_id(<span class="keywordtype">id</span>, name, err)) &lt; 0) <span class="keywordflow">return</span> 1;
<a name="l00600"></a>00600   status = H5Aread(att_id, H5T_NATIVE_INT, value);
<a name="l00601"></a>00601   H5Aclose(att_id);
<a name="l00602"></a>00602   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l00603"></a>00603     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#ebdc5b21cd63a953f31ff6af5f0bbfb2">ADFH_ERR_AREAD</a>, err);
<a name="l00604"></a>00604     <span class="keywordflow">return</span> 1;
<a name="l00605"></a>00605   }
<a name="l00606"></a>00606   <span class="keywordflow">return</span> 0;
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 <span class="keyword">static</span> <span class="keywordtype">int</span> set_int_att(hid_t <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> value, <span class="keywordtype">int</span> *err)
<a name="l00612"></a>00612 {
<a name="l00613"></a>00613   hid_t att_id;
<a name="l00614"></a>00614   herr_t status;
<a name="l00615"></a>00615   <span class="keywordtype">int</span> buff = value;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617   <span class="keywordflow">if</span> ((att_id = get_att_id(<span class="keywordtype">id</span>, name, err)) &lt; 0) <span class="keywordflow">return</span> 1;
<a name="l00618"></a>00618   status = H5Awrite(att_id, H5T_NATIVE_INT, &amp;buff);
<a name="l00619"></a>00619   H5Aclose(att_id);
<a name="l00620"></a>00620   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l00621"></a>00621     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#843fe15d47a6527bc118c9db5b7def11">ADFH_ERR_AWRITE</a>, err);
<a name="l00622"></a>00622     <span class="keywordflow">return</span> 1;
<a name="l00623"></a>00623   }
<a name="l00624"></a>00624   <span class="keywordflow">return</span> 0;
<a name="l00625"></a>00625 }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 <span class="keyword">static</span> <span class="keywordtype">int</span> new_str_data(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value,
<a name="l00630"></a>00630                        <span class="keywordtype">int</span> <a class="code" href="write__bcdata_8c.html#a2950136f8c9d193ee20f9e64e5d3f43">size</a>, <span class="keywordtype">int</span> *err)
<a name="l00631"></a>00631 {
<a name="l00632"></a>00632   hid_t sid, did;
<a name="l00633"></a>00633   hsize_t dim;
<a name="l00634"></a>00634   herr_t status;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636   dim = size+1;
<a name="l00637"></a>00637   sid = H5Screate_simple(1, &amp;dim, NULL);
<a name="l00638"></a>00638   <span class="keywordflow">if</span> (sid &lt; 0) {
<a name="l00639"></a>00639     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#27b6c0c0f7e5b1b919d6a1dfe2e74d28">ADFH_ERR_SCREATE_SIMPLE</a>, err);
<a name="l00640"></a>00640     <span class="keywordflow">return</span> 1;
<a name="l00641"></a>00641   }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643   did = H5Dcreate2(<span class="keywordtype">id</span>, name, H5T_NATIVE_CHAR, sid, H5P_DEFAULT, H5P_DEFAULT, H5P_DEFAULT);
<a name="l00644"></a>00644   <span class="keywordflow">if</span> (did &lt; 0) {
<a name="l00645"></a>00645     H5Sclose(sid);
<a name="l00646"></a>00646     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#3461ee8f8e0e314347cfe9af2126aff8">ADFH_ERR_DCREATE</a>, err);
<a name="l00647"></a>00647     <span class="keywordflow">return</span> 1;
<a name="l00648"></a>00648   }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650   status = H5Dwrite(did, H5T_NATIVE_CHAR, H5S_ALL, H5S_ALL, H5P_DEFAULT, value);
<a name="l00651"></a>00651   H5Dclose(did);
<a name="l00652"></a>00652   H5Sclose(sid);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l00655"></a>00655     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#5e8ecab15f74022e5350cf299562648b">ADFH_ERR_DWRITE</a>, err);
<a name="l00656"></a>00656     <span class="keywordflow">return</span> 1;
<a name="l00657"></a>00657   }
<a name="l00658"></a>00658   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l00659"></a>00659   <span class="keywordflow">return</span> 0;
<a name="l00660"></a>00660 }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00663"></a>00663 <span class="comment">/*  translate an ADF data type into an HDF one */</span>
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 <span class="keyword">static</span> hid_t to_HDF_data_type(<span class="keyword">const</span> <span class="keywordtype">char</span> *tp)
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667   <span class="comment">/* H5Tclose performed elsewhere */</span>
<a name="l00668"></a>00668   <span class="keywordflow">if</span> (0 == strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#c946e4162ee5a6831171a2cee2bb1f89">ADFH_B1</a>))
<a name="l00669"></a>00669     <span class="keywordflow">return</span> H5Tcopy(H5T_NATIVE_UCHAR);
<a name="l00670"></a>00670   <span class="keywordflow">if</span> (0 == strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#93b472cbdcfaf6d83f65027ae8c80530">ADFH_C1</a>))
<a name="l00671"></a>00671     <span class="keywordflow">return</span> H5Tcopy(H5T_NATIVE_CHAR);
<a name="l00672"></a>00672   <span class="keywordflow">if</span> (0 == strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#9b77f412203f5f68037e80a5ffa594d7">ADFH_I4</a>))
<a name="l00673"></a>00673     <span class="keywordflow">return</span> H5Tcopy(H5T_NATIVE_INT32);
<a name="l00674"></a>00674   <span class="keywordflow">if</span> (0 == strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#df5dba80efbefb5b7b4cf7664beea82c">ADFH_I8</a>))
<a name="l00675"></a>00675     <span class="keywordflow">return</span> H5Tcopy(H5T_NATIVE_INT64);
<a name="l00676"></a>00676   <span class="keywordflow">if</span> (0 == strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#d53e6f99bd8c7fe121b9aa444ac7bcca">ADFH_U4</a>))
<a name="l00677"></a>00677     <span class="keywordflow">return</span> H5Tcopy(H5T_NATIVE_UINT32);
<a name="l00678"></a>00678   <span class="keywordflow">if</span> (0 == strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#2e78c189d646852c2af69182bb1bc3eb">ADFH_U8</a>))
<a name="l00679"></a>00679     <span class="keywordflow">return</span> H5Tcopy(H5T_NATIVE_UINT64);
<a name="l00680"></a>00680   <span class="keywordflow">if</span> (0 == strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#752d961d292c49a059957170b26ff0a7">ADFH_R4</a>)) {
<a name="l00681"></a>00681     hid_t tid = H5Tcopy(H5T_NATIVE_FLOAT);
<a name="l00682"></a>00682     H5Tset_precision(tid, 32); 
<a name="l00683"></a>00683     <span class="keywordflow">return</span> tid;
<a name="l00684"></a>00684   }
<a name="l00685"></a>00685   <span class="keywordflow">if</span> (0 == strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#a80fb83f02b3d7077ae0f03163122caf">ADFH_R8</a>)) {
<a name="l00686"></a>00686     hid_t tid = H5Tcopy(H5T_NATIVE_DOUBLE);
<a name="l00687"></a>00687     H5Tset_precision(tid, 64);
<a name="l00688"></a>00688     <span class="keywordflow">return</span> tid;
<a name="l00689"></a>00689   }
<a name="l00690"></a>00690   <span class="keywordflow">return</span> 0;
<a name="l00691"></a>00691 }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 <span class="keyword">static</span> <span class="keywordtype">int</span> check_data_type(<span class="keyword">const</span> <span class="keywordtype">char</span> *tp, <span class="keywordtype">int</span> *err)
<a name="l00696"></a>00696 {
<a name="l00697"></a>00697   <span class="keywordflow">if</span> (strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#c946e4162ee5a6831171a2cee2bb1f89">ADFH_B1</a>) &amp;&amp;
<a name="l00698"></a>00698       strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#93b472cbdcfaf6d83f65027ae8c80530">ADFH_C1</a>) &amp;&amp;
<a name="l00699"></a>00699       strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#9b77f412203f5f68037e80a5ffa594d7">ADFH_I4</a>) &amp;&amp;
<a name="l00700"></a>00700       strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#df5dba80efbefb5b7b4cf7664beea82c">ADFH_I8</a>) &amp;&amp;
<a name="l00701"></a>00701       strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#d53e6f99bd8c7fe121b9aa444ac7bcca">ADFH_U4</a>) &amp;&amp;
<a name="l00702"></a>00702       strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#2e78c189d646852c2af69182bb1bc3eb">ADFH_U8</a>) &amp;&amp;
<a name="l00703"></a>00703       strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#752d961d292c49a059957170b26ff0a7">ADFH_R4</a>) &amp;&amp;
<a name="l00704"></a>00704       strcmp(tp, <a class="code" href="_a_d_f_h_8c.html#a80fb83f02b3d7077ae0f03163122caf">ADFH_R8</a>)) {
<a name="l00705"></a>00705     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#f6444726292c84aff1853b7d08c9885f">INVALID_DATA_TYPE</a>, err);
<a name="l00706"></a>00706     <span class="keywordflow">return</span> 1;
<a name="l00707"></a>00707   }
<a name="l00708"></a>00708   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l00709"></a>00709   <span class="keywordflow">return</span> 0;
<a name="l00710"></a>00710 }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712 <span class="comment">/* =================================================================</span>
<a name="l00713"></a>00713 <span class="comment"> * callback routines for H5Giterate and H5Aiterate</span>
<a name="l00714"></a>00714 <span class="comment"> * ================================================================= */</span>
<a name="l00715"></a>00715 
<a name="l00716"></a>00716 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 <span class="keyword">static</span> herr_t gfind_by_name(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *dsname)
<a name="l00719"></a>00719 {
<a name="l00720"></a>00720     <span class="keywordflow">if</span> (0 == strcmp (name, (<span class="keywordtype">char</span> *)dsname)) <span class="keywordflow">return</span> 1;
<a name="l00721"></a>00721     <span class="keywordflow">return</span> 0;
<a name="l00722"></a>00722 }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 <span class="keyword">static</span> herr_t gprint_name(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *dsname)
<a name="l00727"></a>00727 {
<a name="l00728"></a>00728   <span class="keywordflow">return</span> 0;
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00732"></a>00732 
<a name="l00733"></a>00733 <span class="keyword">static</span> herr_t find_by_name(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> H5A_info_t* ainfo, <span class="keywordtype">void</span> *dsname)
<a name="l00734"></a>00734 {
<a name="l00735"></a>00735     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(<span class="keywordtype">id</span>);
<a name="l00736"></a>00736     <span class="keywordflow">if</span> (0 == strcmp (name, (<span class="keywordtype">char</span> *)dsname)) <span class="keywordflow">return</span> 1;
<a name="l00737"></a>00737     <span class="keywordflow">return</span> 0;
<a name="l00738"></a>00738 }
<a name="l00739"></a>00739 
<a name="l00740"></a>00740 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00741"></a>00741 
<a name="l00742"></a>00742 <span class="keyword">static</span> herr_t print_name(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> H5A_info_t* ainfo, <span class="keywordtype">void</span> *dsname)
<a name="l00743"></a>00743 {
<a name="l00744"></a>00744   printf(<span class="stringliteral">"[%s]:[%s]\n"</span>,dsname,name);
<a name="l00745"></a>00745   <span class="keywordflow">return</span> 0;
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 <span class="keyword">static</span> herr_t count_children(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *number)
<a name="l00751"></a>00751 {
<a name="l00752"></a>00752   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(<span class="keywordtype">id</span>);
<a name="l00753"></a>00753   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"count_children [%s][%d]"</span>,name,(*((<span class="keywordtype">int</span> *)number))));
<a name="l00754"></a>00754   
<a name="l00755"></a>00755   <span class="keywordflow">if</span> (*name != <a class="code" href="_a_d_f_h_8c.html#ac9fcaf994677f69931da9e5d51b6468">D_PREFIX</a>)
<a name="l00756"></a>00756     (*((<span class="keywordtype">int</span> *)number))++;
<a name="l00757"></a>00757   <span class="keywordflow">return</span> 0;
<a name="l00758"></a>00758 }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00761"></a>00761 
<a name="l00762"></a>00762 <span class="keyword">static</span> herr_t children_names(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *namelist)
<a name="l00763"></a>00763 {
<a name="l00764"></a>00764   hid_t gid;
<a name="l00765"></a>00765   <span class="keywordtype">int</span> order, err;
<a name="l00766"></a>00766   <span class="keywordtype">char</span> *p;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768   <a class="code" href="_a_d_f_h_8c.html#8c14d72149efef586123816eb46243b0">ROOT_OR_DIE</a>(&amp;err);
<a name="l00769"></a>00769   <span class="keywordflow">if</span> (*name == <a class="code" href="_a_d_f_h_8c.html#ac9fcaf994677f69931da9e5d51b6468">D_PREFIX</a>) <span class="keywordflow">return</span> 0;
<a name="l00770"></a>00770 <span class="preprocessor">#ifdef ADFH_NO_ORDER</span>
<a name="l00771"></a>00771 <span class="preprocessor"></span>  order = ++mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#42c35485c275e5d9847820d8da2d71c9">i_count</a> - mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#ea9b53c36b298e8064344b37eabe93ec">i_start</a>;
<a name="l00772"></a>00772   <span class="keywordflow">if</span> (order &gt;= 0 &amp;&amp; order &lt; mta_root-&gt;i_len) {
<a name="l00773"></a>00773     p = (<span class="keywordtype">char</span> *)namelist + order * mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#26fd89da54c4e465e73db70f035f1f85">n_length</a>;
<a name="l00774"></a>00774     strncpy(p, name, mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#26fd89da54c4e465e73db70f035f1f85">n_length</a>-1);
<a name="l00775"></a>00775     p[mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#26fd89da54c4e465e73db70f035f1f85">n_length</a>-1] = 0;
<a name="l00776"></a>00776     mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#799467c347fcdf71beda8521204b52be">n_names</a>++;
<a name="l00777"></a>00777   }
<a name="l00778"></a>00778 <span class="preprocessor">#else</span>
<a name="l00779"></a>00779 <span class="preprocessor"></span>  <span class="keywordflow">if</span> ((gid = H5Gopen2(<span class="keywordtype">id</span>, name, H5P_DEFAULT)) &lt; 0) <span class="keywordflow">return</span> 1;
<a name="l00780"></a>00780   <span class="keywordflow">if</span> (get_int_att(gid, <a class="code" href="_a_d_f_h_8c.html#0d93ceee9ef585ec9618bd787affe17c">A_ORDER</a>, &amp;order, &amp;err)) {
<a name="l00781"></a>00781     H5Gclose(gid);
<a name="l00782"></a>00782     <span class="keywordflow">return</span> 1;
<a name="l00783"></a>00783   }
<a name="l00784"></a>00784   order -= mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#ea9b53c36b298e8064344b37eabe93ec">i_start</a>;
<a name="l00785"></a>00785   <span class="keywordflow">if</span> (order &gt;= 0 &amp;&amp; order &lt; mta_root-&gt;i_len) {
<a name="l00786"></a>00786     p = (<span class="keywordtype">char</span> *)namelist + order * mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#26fd89da54c4e465e73db70f035f1f85">n_length</a>;
<a name="l00787"></a>00787     strncpy(p, name, mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#26fd89da54c4e465e73db70f035f1f85">n_length</a>-1);
<a name="l00788"></a>00788     p[mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#26fd89da54c4e465e73db70f035f1f85">n_length</a>-1] = 0;
<a name="l00789"></a>00789     mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#799467c347fcdf71beda8521204b52be">n_names</a>++;
<a name="l00790"></a>00790   }
<a name="l00791"></a>00791   H5Gclose(gid);
<a name="l00792"></a>00792 <span class="preprocessor">#endif</span>
<a name="l00793"></a>00793 <span class="preprocessor"></span>  <span class="keywordflow">return</span> 0;
<a name="l00794"></a>00794 }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 <span class="keyword">static</span> herr_t children_ids(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *idlist)
<a name="l00799"></a>00799 {
<a name="l00800"></a>00800   hid_t gid;
<a name="l00801"></a>00801   <span class="keywordtype">int</span> order, err;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH children_ids [%s]"</span>,name));
<a name="l00804"></a>00804   <a class="code" href="_a_d_f_h_8c.html#8c14d72149efef586123816eb46243b0">ROOT_OR_DIE</a>(&amp;err);
<a name="l00805"></a>00805   <span class="keywordflow">if</span> (*name == <a class="code" href="_a_d_f_h_8c.html#ac9fcaf994677f69931da9e5d51b6468">D_PREFIX</a>) <span class="keywordflow">return</span> 0;
<a name="l00806"></a>00806   <span class="keywordflow">if</span> ((gid = H5Gopen2(<span class="keywordtype">id</span>, name, H5P_DEFAULT)) &lt; 0) <span class="keywordflow">return</span> 1;
<a name="l00807"></a>00807 <span class="preprocessor">#ifdef ADFH_NO_ORDER</span>
<a name="l00808"></a>00808 <span class="preprocessor"></span>  order = ++mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#42c35485c275e5d9847820d8da2d71c9">i_count</a> - mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#ea9b53c36b298e8064344b37eabe93ec">i_start</a>;
<a name="l00809"></a>00809   <span class="keywordflow">if</span> (order &gt;= 0 &amp;&amp; order &lt; mta_root-&gt;i_len) {
<a name="l00810"></a>00810       ((<span class="keywordtype">double</span> *)idlist)[order] = <a class="code" href="_a_d_f_h_8c.html#c075abfe5b07d68a3eeb5fb874982dc4">to_ADF_ID</a>(gid);
<a name="l00811"></a>00811       mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#799467c347fcdf71beda8521204b52be">n_names</a>++;
<a name="l00812"></a>00812   }
<a name="l00813"></a>00813   <span class="keywordflow">else</span>
<a name="l00814"></a>00814       H5Gclose(gid);
<a name="l00815"></a>00815 <span class="preprocessor">#else</span>
<a name="l00816"></a>00816 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (get_int_att(gid, <a class="code" href="_a_d_f_h_8c.html#0d93ceee9ef585ec9618bd787affe17c">A_ORDER</a>, &amp;order, &amp;err)) {
<a name="l00817"></a>00817     H5Gclose(gid);
<a name="l00818"></a>00818     <span class="keywordflow">return</span> 1;
<a name="l00819"></a>00819   }
<a name="l00820"></a>00820   order -= mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#ea9b53c36b298e8064344b37eabe93ec">i_start</a>;
<a name="l00821"></a>00821   <span class="keywordflow">if</span> (order &gt;= 0 &amp;&amp; order &lt; mta_root-&gt;i_len) {
<a name="l00822"></a>00822       ((<span class="keywordtype">double</span> *)idlist)[order] = <a class="code" href="_a_d_f_h_8c.html#c075abfe5b07d68a3eeb5fb874982dc4">to_ADF_ID</a>(gid);
<a name="l00823"></a>00823       mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#799467c347fcdf71beda8521204b52be">n_names</a>++;
<a name="l00824"></a>00824   }
<a name="l00825"></a>00825   <span class="keywordflow">else</span>
<a name="l00826"></a>00826       H5Gclose(gid);
<a name="l00827"></a>00827 <span class="preprocessor">#endif</span>
<a name="l00828"></a>00828 <span class="preprocessor"></span>  <span class="keywordflow">return</span> 0;
<a name="l00829"></a>00829 }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831 <span class="comment">/* -----------------------------------------------------------------</span>
<a name="l00832"></a>00832 <span class="comment">  called via H5Giterate in Move_Child &amp; Delete functions.</span>
<a name="l00833"></a>00833 <span class="comment">  removes gaps in _order index attributes */</span>
<a name="l00834"></a>00834 
<a name="l00835"></a>00835 <span class="keyword">static</span> herr_t fix_order(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *data)
<a name="l00836"></a>00836 {
<a name="l00837"></a>00837   <span class="keywordtype">int</span> <a class="code" href="write__bcdata_8c.html#96c2ad5611cd5302c6e5cf2a9a4bf73b">start</a>, order, err, ret = 0;
<a name="l00838"></a>00838   hid_t gid, aid;
<a name="l00839"></a>00839 
<a name="l00840"></a>00840   <span class="keywordflow">if</span> (mta_root == NULL) <span class="keywordflow">return</span> <a class="code" href="_a_d_f_h_8h.html#6f947c806896b40d6524f937d510c1b2">ADFH_ERR_ROOTNULL</a>;
<a name="l00841"></a>00841   <span class="keywordflow">if</span> (*name == <a class="code" href="_a_d_f_h_8c.html#ac9fcaf994677f69931da9e5d51b6468">D_PREFIX</a>) <span class="keywordflow">return</span> 0;
<a name="l00842"></a>00842   <span class="keywordflow">if</span> ((gid = H5Gopen2(<span class="keywordtype">id</span>, name, H5P_DEFAULT)) &lt; 0)
<a name="l00843"></a>00843     <span class="keywordflow">return</span> <a class="code" href="_a_d_f_h_8h.html#d3f9f448401f1521079197a63268ad12">ADFH_ERR_GOPEN</a>;
<a name="l00844"></a>00844   <span class="keywordflow">if</span> ((aid = get_att_id(gid, <a class="code" href="_a_d_f_h_8c.html#0d93ceee9ef585ec9618bd787affe17c">A_ORDER</a>, &amp;err)) &lt; 0) {
<a name="l00845"></a>00845     H5Gclose(gid);
<a name="l00846"></a>00846     <span class="keywordflow">return</span> err;
<a name="l00847"></a>00847   }
<a name="l00848"></a>00848   <span class="keywordflow">if</span> (H5Aread(aid, H5T_NATIVE_INT, &amp;order) &lt; 0)
<a name="l00849"></a>00849     ret = <a class="code" href="_a_d_f_h_8h.html#ebdc5b21cd63a953f31ff6af5f0bbfb2">ADFH_ERR_AREAD</a>;
<a name="l00850"></a>00850   <span class="keywordflow">else</span> {
<a name="l00851"></a>00851     start = *((<span class="keywordtype">int</span> *)data);
<a name="l00852"></a>00852     <span class="keywordflow">if</span> (order &gt; start) {
<a name="l00853"></a>00853       order--;
<a name="l00854"></a>00854       <span class="keywordflow">if</span> (H5Awrite(aid, H5T_NATIVE_INT, &amp;order) &lt; 0)
<a name="l00855"></a>00855         ret = <a class="code" href="_a_d_f_h_8h.html#843fe15d47a6527bc118c9db5b7def11">ADFH_ERR_AWRITE</a>;
<a name="l00856"></a>00856     }
<a name="l00857"></a>00857   }
<a name="l00858"></a>00858   H5Aclose(aid);
<a name="l00859"></a>00859   H5Gclose(gid);
<a name="l00860"></a>00860   <span class="keywordflow">return</span> ret;
<a name="l00861"></a>00861 }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 <span class="keyword">static</span> herr_t compare_children(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *data)
<a name="l00866"></a>00866 {
<a name="l00867"></a>00867   H5G_stat_t stat, *pstat;
<a name="l00868"></a>00868 
<a name="l00869"></a>00869   <span class="keywordflow">if</span> (*name != <a class="code" href="_a_d_f_h_8c.html#ac9fcaf994677f69931da9e5d51b6468">D_PREFIX</a>) {
<a name="l00870"></a>00870     pstat = (H5G_stat_t *)data;
<a name="l00871"></a>00871     <span class="keywordflow">if</span> (H5Gget_objinfo(<span class="keywordtype">id</span>, name, 0, &amp;stat) &gt;= 0)
<a name="l00872"></a>00872       <span class="keywordflow">return</span> <a class="code" href="_a_d_f_h_8c.html#6c0692391e581b68dbc1ce69d11be5c9">CMP_OSTAT</a>(&amp;stat, pstat);
<a name="l00873"></a>00873   }
<a name="l00874"></a>00874   <span class="keywordflow">return</span> 0;
<a name="l00875"></a>00875 }
<a name="l00876"></a>00876 
<a name="l00877"></a>00877 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00878"></a>00878 
<a name="l00879"></a>00879 <span class="keyword">static</span> herr_t print_children(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *data)
<a name="l00880"></a>00880 {
<a name="l00881"></a>00881   <span class="keywordflow">if</span> (*name != <a class="code" href="_a_d_f_h_8c.html#ac9fcaf994677f69931da9e5d51b6468">D_PREFIX</a>)
<a name="l00882"></a>00882     printf(<span class="stringliteral">" %s"</span>, name);
<a name="l00883"></a>00883   <span class="keywordflow">return</span> 0;
<a name="l00884"></a>00884 }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886 <span class="comment">/* -----------------------------------------------------------------</span>
<a name="l00887"></a>00887 <span class="comment"> * get file ID from node ID</span>
<a name="l00888"></a>00888 <span class="comment"> * ----------------------------------------------------------------- */</span>
<a name="l00889"></a>00889 
<a name="l00890"></a>00890 <span class="keyword">static</span> hid_t get_file_id (hid_t <span class="keywordtype">id</span>)
<a name="l00891"></a>00891 {
<a name="l00892"></a>00892   <span class="keywordtype">int</span> n, nobj;
<a name="l00893"></a>00893   hid_t *objs, fid = -1;
<a name="l00894"></a>00894   H5G_stat_t gstat, rstat;
<a name="l00895"></a>00895 
<a name="l00896"></a>00896   <span class="comment">/* find the file ID from the root ID */</span>
<a name="l00897"></a>00897 
<a name="l00898"></a>00898   <span class="keywordflow">if</span> (H5Gget_objinfo(<span class="keywordtype">id</span>, <span class="stringliteral">"/"</span>, 0, &amp;gstat) &gt;= 0) {
<a name="l00899"></a>00899     nobj = H5Fget_obj_count(H5F_OBJ_ALL, H5F_OBJ_FILE);
<a name="l00900"></a>00900     <span class="keywordflow">if</span> (nobj &gt; 0) {
<a name="l00901"></a>00901       objs = (hid_t *) <a class="code" href="cg__malloc_8h.html#535b58ab5aa48e2e86073e334d43fd32">malloc</a> (nobj * <span class="keyword">sizeof</span>(hid_t));
<a name="l00902"></a>00902       <span class="keywordflow">if</span> (objs == NULL) <span class="keywordflow">return</span> fid;
<a name="l00903"></a>00903       H5Fget_obj_ids(H5F_OBJ_ALL, H5F_OBJ_FILE, -1, objs);
<a name="l00904"></a>00904       <span class="keywordflow">for</span> (n = 0; n &lt; nobj; n++) {
<a name="l00905"></a>00905         H5Gget_objinfo(objs[n], <span class="stringliteral">"/"</span>, 0, &amp;rstat);
<a name="l00906"></a>00906         <span class="keywordflow">if</span> (<a class="code" href="_a_d_f_h_8c.html#6c0692391e581b68dbc1ce69d11be5c9">CMP_OSTAT</a>(&amp;gstat, &amp;rstat)) {
<a name="l00907"></a>00907           fid = objs[n];
<a name="l00908"></a>00908           <span class="keywordflow">break</span>;
<a name="l00909"></a>00909         }
<a name="l00910"></a>00910       }
<a name="l00911"></a>00911       <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a> (objs);
<a name="l00912"></a>00912     }
<a name="l00913"></a>00913   }
<a name="l00914"></a>00914   <span class="keywordflow">return</span> fid;
<a name="l00915"></a>00915 }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 <span class="keyword">static</span> <span class="keywordtype">int</span> get_file_number (hid_t <span class="keywordtype">id</span>, <span class="keywordtype">int</span> *err)
<a name="l00920"></a>00920 {
<a name="l00921"></a>00921   <span class="keywordtype">int</span> n;
<a name="l00922"></a>00922   hid_t fid = get_file_id(<span class="keywordtype">id</span>);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924   <span class="keywordflow">if</span> (mta_root == NULL) <span class="keywordflow">return</span> -1;
<a name="l00925"></a>00925   <span class="keywordflow">for</span> (n = 0; n &lt; <a class="code" href="_a_d_f_h_8c.html#b7d4546845c6fbe98aa8f37633fba992">ADFH_MAXIMUM_FILES</a>; n++) {
<a name="l00926"></a>00926     <span class="keywordflow">if</span> (fid == mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#97c82d2ac1d1dce14bc8807e7bae7caf">g_files</a>[n]) {
<a name="l00927"></a>00927       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l00928"></a>00928       <span class="keywordflow">return</span> n;
<a name="l00929"></a>00929     }
<a name="l00930"></a>00930   }
<a name="l00931"></a>00931   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d8e46d3c75ace36ca97661e438183676">ADFH_ERR_FILE_INDEX</a>, err);
<a name="l00932"></a>00932   <span class="keywordflow">return</span> -1;
<a name="l00933"></a>00933 }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935 <span class="comment">/* ================================================================</span>
<a name="l00936"></a>00936 <span class="comment"> * routines for dealing with links</span>
<a name="l00937"></a>00937 <span class="comment"> * ================================================================ */</span>
<a name="l00938"></a>00938 <span class="keyword">static</span> hid_t open_link(hid_t <span class="keywordtype">id</span>, <span class="keywordtype">int</span> *err)
<a name="l00939"></a>00939 {
<a name="l00940"></a>00940   hid_t lid;
<a name="l00941"></a>00941   herr_t herr;
<a name="l00942"></a>00942 
<a name="l00943"></a>00943   <span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="_a_d_f__internals_8h.html#73f77f937a19b2785eb0cdbbd5fab7c3">file</a>;
<a name="l00944"></a>00944   <span class="keyword">const</span> <span class="keywordtype">char</span>  *path;
<a name="l00945"></a>00945   H5G_stat_t    sb; <span class="comment">/* Object information */</span>
<a name="l00946"></a>00946 
<a name="l00947"></a>00947   <span class="keywordtype">char</span>  *objectbuff,querybuff[512];
<a name="l00948"></a>00948 
<a name="l00949"></a>00949 <span class="preprocessor">#ifdef ADFH_DEBUG_ON</span>
<a name="l00950"></a>00950 <span class="preprocessor"></span>  <span class="keywordtype">char</span> buffname[<a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>+1];
<a name="l00951"></a>00951   get_str_att(<span class="keywordtype">id</span>, <a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">A_NAME</a>, buffname, err);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH open_link [%s]"</span>,buffname));
<a name="l00954"></a>00954 <span class="preprocessor">#endif</span>
<a name="l00955"></a>00955 <span class="preprocessor"></span>
<a name="l00956"></a>00956   <span class="keywordflow">if</span> (H5Lis_registered(H5L_TYPE_EXTERNAL) != 1)
<a name="l00957"></a>00957   {
<a name="l00958"></a>00958     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#e4c8e2d37d921b2aab27c4818d9f72f2">ADFH_ERR_LIBREG</a>, err);
<a name="l00959"></a>00959     <span class="keywordflow">return</span>;
<a name="l00960"></a>00960   }
<a name="l00961"></a>00961   herr=H5Gget_objinfo(<span class="keywordtype">id</span>, <a class="code" href="_a_d_f_h_8c.html#bbed85e98b4e4faf4e28bd714e2be01c">D_LINK</a>, (hbool_t)0, &amp;sb);
<a name="l00962"></a>00962 
<a name="l00963"></a>00963   <span class="keywordflow">if</span> (herr&lt;0)
<a name="l00964"></a>00964   {
<a name="l00965"></a>00965     <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH open_link type [%d][%d]"</span>,herr,sb.type));
<a name="l00966"></a>00966     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#abbbc98607dbb9c029889fc61a413459">ADFH_ERR_OBJINFO_FAILED</a>, err);
<a name="l00967"></a>00967     <span class="keywordflow">return</span>;
<a name="l00968"></a>00968   } 
<a name="l00969"></a>00969 
<a name="l00970"></a>00970   <span class="comment">/* Soft link                -&gt; link to our current file */</span>
<a name="l00971"></a>00971   <span class="comment">/* Hard link (User defined) -&gt; link to an external file */</span>
<a name="l00972"></a>00972 
<a name="l00973"></a>00973   <span class="keywordflow">if</span> (H5G_LINK != sb.type) 
<a name="l00974"></a>00974   {
<a name="l00975"></a>00975     <span class="keywordflow">if</span> (H5G_UDLINK != sb.type) 
<a name="l00976"></a>00976     {
<a name="l00977"></a>00977       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#ef1054d36dd4c8a70d0f59c7e6c8effc">ADFH_ERR_NOTXLINK</a>, err);
<a name="l00978"></a>00978       <span class="keywordflow">return</span>;
<a name="l00979"></a>00979     }
<a name="l00980"></a>00980 
<a name="l00981"></a>00981     <span class="keywordflow">if</span> (H5Lget_val(<span class="keywordtype">id</span>,<a class="code" href="_a_d_f_h_8c.html#bbed85e98b4e4faf4e28bd714e2be01c">D_LINK</a>,querybuff,<span class="keyword">sizeof</span>(querybuff),H5P_DEFAULT)&lt;0)
<a name="l00982"></a>00982     {
<a name="l00983"></a>00983       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#1bf1cfac13b62e173e1910904d38a46f">ADFH_ERR_XLINK_NOVAL</a>, err);
<a name="l00984"></a>00984       <span class="keywordflow">return</span>;
<a name="l00985"></a>00985     } 
<a name="l00986"></a>00986 
<a name="l00987"></a>00987     <span class="keywordflow">if</span> (H5Lunpack_elink_val(querybuff,sb.linklen,NULL,&amp;file,&amp;path)&lt;0)
<a name="l00988"></a>00988     {
<a name="l00989"></a>00989       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#39655d8ef07694ce40763929053e3849">ADFH_ERR_XLINK_UNPACK</a>, err);
<a name="l00990"></a>00990       <span class="keywordflow">return</span>;
<a name="l00991"></a>00991     } 
<a name="l00992"></a>00992     <span class="comment">/* open the actual link &gt;&gt; IN THE LINK GROUP &lt;&lt; */</span>
<a name="l00993"></a>00993     <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH open_link (external)"</span>));
<a name="l00994"></a>00994     <span class="keywordflow">if</span> ((lid = H5Gopen2(<span class="keywordtype">id</span>, <a class="code" href="_a_d_f_h_8c.html#bbed85e98b4e4faf4e28bd714e2be01c">D_LINK</a>, H5P_DEFAULT)) &lt; 0)
<a name="l00995"></a>00995       {
<a name="l00996"></a>00996         <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#7ea4dc6d240b23a928f5033267bb8577">LINK_TARGET_NOT_THERE</a>, err);
<a name="l00997"></a>00997         <span class="keywordflow">return</span>;
<a name="l00998"></a>00998       }
<a name="l00999"></a>00999   }
<a name="l01000"></a>01000   <span class="keywordflow">else</span>
<a name="l01001"></a>01001   {
<a name="l01002"></a>01002     <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH open_link (symbolic)"</span>));
<a name="l01003"></a>01003     <span class="keywordflow">if</span> ((lid = H5Gopen2(<span class="keywordtype">id</span>, <a class="code" href="_a_d_f_h_8c.html#bbed85e98b4e4faf4e28bd714e2be01c">D_LINK</a>, H5P_DEFAULT)) &lt; 0)
<a name="l01004"></a>01004       {
<a name="l01005"></a>01005         <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#7ea4dc6d240b23a928f5033267bb8577">LINK_TARGET_NOT_THERE</a>, err);
<a name="l01006"></a>01006         <span class="keywordflow">return</span>;
<a name="l01007"></a>01007       }
<a name="l01008"></a>01008   }
<a name="l01009"></a>01009 
<a name="l01010"></a>01010   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&lt;ADFH open_link "</span>));
<a name="l01011"></a>01011 
<a name="l01012"></a>01012   <span class="keywordflow">return</span> lid;
<a name="l01013"></a>01013 }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01016"></a>01016 
<a name="l01017"></a>01017 <span class="keyword">static</span> <span class="keywordtype">int</span> is_link(hid_t <span class="keywordtype">id</span>)
<a name="l01018"></a>01018 {
<a name="l01019"></a>01019   <span class="keywordtype">char</span> type[3];
<a name="l01020"></a>01020   <span class="keywordtype">int</span> err;
<a name="l01021"></a>01021 
<a name="l01022"></a>01022   <span class="keywordflow">if</span> ((!get_str_att(<span class="keywordtype">id</span>, <a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">A_TYPE</a>, type, &amp;err) &amp;&amp; (0 == strcmp(<a class="code" href="_a_d_f_h_8c.html#45a51dad81a251c623f7cbab0f978ec0">ADFH_LK</a>, type))))
<a name="l01023"></a>01023   {
<a name="l01024"></a>01024     <span class="keywordflow">return</span> 1;
<a name="l01025"></a>01025   }
<a name="l01026"></a>01026   <span class="keywordflow">return</span> 0;
<a name="l01027"></a>01027 }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01030"></a>01030 
<a name="l01031"></a>01031 <span class="keyword">static</span> hid_t open_node(<span class="keywordtype">double</span> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> *err) 
<a name="l01032"></a>01032 {
<a name="l01033"></a>01033   hid_t hid, gid, lid;
<a name="l01034"></a>01034   H5G_stat_t sb;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH open_node"</span>));
<a name="l01037"></a>01037   hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l01038"></a>01038   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l01039"></a>01039   <span class="keywordflow">if</span> (is_link(hid)) 
<a name="l01040"></a>01040   {
<a name="l01041"></a>01041     lid=open_link(hid, err); <span class="comment">/* bad id trapped in the function */</span>
<a name="l01042"></a>01042     <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&lt;ADFH open_node link"</span>));
<a name="l01043"></a>01043     <span class="keywordflow">return</span> lid;
<a name="l01044"></a>01044   }
<a name="l01045"></a>01045   <span class="keywordflow">else</span>
<a name="l01046"></a>01046   {
<a name="l01047"></a>01047     <span class="keywordflow">if</span> ((gid = H5Gopen2(hid, <span class="stringliteral">"."</span>, H5P_DEFAULT)) &lt; 0)
<a name="l01048"></a>01048     {
<a name="l01049"></a>01049       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d3f9f448401f1521079197a63268ad12">ADFH_ERR_GOPEN</a>, err);
<a name="l01050"></a>01050     }
<a name="l01051"></a>01051     <span class="keywordflow">else</span>
<a name="l01052"></a>01052     {
<a name="l01053"></a>01053       <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&lt;ADFH open_node group"</span>));
<a name="l01054"></a>01054       <span class="comment">/* H5Gget_objinfo(gid,".",0,&amp;sb); */</span>
<a name="l01055"></a>01055       <span class="keywordflow">return</span> gid;
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057   }
<a name="l01058"></a>01058 }
<a name="l01059"></a>01059 
<a name="l01060"></a>01060 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01061"></a>01061 
<a name="l01062"></a>01062 <span class="keyword">static</span> hid_t parse_path(hid_t pid, <span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> *err)
<a name="l01063"></a>01063 {
<a name="l01064"></a>01064   hid_t id, nid;
<a name="l01065"></a>01065   <span class="keywordtype">char</span> *p;
<a name="l01066"></a>01066 
<a name="l01067"></a>01067   <span class="keywordflow">if</span> ((p = strchr(path, <span class="charliteral">'/'</span>)) != NULL) *p++ = 0;
<a name="l01068"></a>01068   <span class="keywordflow">if</span> ((<span class="keywordtype">id</span> = H5Gopen2(pid, path, H5P_DEFAULT)) &lt; 0) {
<a name="l01069"></a>01069     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d3f9f448401f1521079197a63268ad12">ADFH_ERR_GOPEN</a>, err);
<a name="l01070"></a>01070     <span class="keywordflow">return</span> id;
<a name="l01071"></a>01071   }
<a name="l01072"></a>01072   <span class="keywordflow">if</span> (p == NULL || !*p) <span class="keywordflow">return</span> id;
<a name="l01073"></a>01073   <span class="keywordflow">if</span> (is_link(<span class="keywordtype">id</span>)) {
<a name="l01074"></a>01074     nid = open_link(<span class="keywordtype">id</span>, err);
<a name="l01075"></a>01075     <span class="keywordflow">if</span> (H5Gclose(<span class="keywordtype">id</span>)&lt;0) <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH H5Gclose failed"</span>));
<a name="l01076"></a>01076     <span class="keywordflow">if</span> (nid &lt; 0) <span class="keywordflow">return</span> nid;
<a name="l01077"></a>01077     <span class="keywordtype">id</span> = nid;
<a name="l01078"></a>01078   }
<a name="l01079"></a>01079   nid = parse_path(<span class="keywordtype">id</span>, p, err);
<a name="l01080"></a>01080   <span class="keywordflow">if</span> (H5Gclose(<span class="keywordtype">id</span>)&lt;0) <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH H5Gclose failed"</span>));
<a name="l01081"></a>01081   <span class="keywordflow">return</span> nid;
<a name="l01082"></a>01082 }
<a name="l01083"></a>01083 
<a name="l01084"></a>01084 <span class="comment">/* -----------------------------------------------------------------</span>
<a name="l01085"></a>01085 <span class="comment"> * deletion routines</span>
<a name="l01086"></a>01086 <span class="comment"> * ----------------------------------------------------------------- */</span>
<a name="l01087"></a>01087 
<a name="l01088"></a>01088 <span class="keyword">static</span> <span class="keywordtype">void</span> delete_node(hid_t pid, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l01089"></a>01089 {
<a name="l01090"></a>01090   H5Gunlink(pid, name); <span class="comment">/* do we care about link ? no ? */</span>
<a name="l01091"></a>01091 }
<a name="l01092"></a>01092 
<a name="l01093"></a>01093 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01094"></a>01094 
<a name="l01095"></a>01095 <span class="keyword">static</span> herr_t delete_children(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *data)
<a name="l01096"></a>01096 {
<a name="l01097"></a>01097   <span class="keywordflow">if</span> (*name == <a class="code" href="_a_d_f_h_8c.html#ac9fcaf994677f69931da9e5d51b6468">D_PREFIX</a>)
<a name="l01098"></a>01098   {
<a name="l01099"></a>01099     <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"delete_children single"</span>));
<a name="l01100"></a>01100     <span class="keywordflow">if</span> (! is_link(<span class="keywordtype">id</span>))
<a name="l01101"></a>01101     {
<a name="l01102"></a>01102       <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"delete_children is not link [%s]\n"</span>,name));
<a name="l01103"></a>01103       H5Gunlink(<span class="keywordtype">id</span>, name);
<a name="l01104"></a>01104     }
<a name="l01105"></a>01105     <span class="keywordflow">else</span>
<a name="l01106"></a>01106     {
<a name="l01107"></a>01107       <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"delete_children is link"</span>));
<a name="l01108"></a>01108     }
<a name="l01109"></a>01109     <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"delete_children single done"</span>));
<a name="l01110"></a>01110   }
<a name="l01111"></a>01111   <span class="keywordflow">else</span> {
<a name="l01112"></a>01112     <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"delete_children loop"</span>));
<a name="l01113"></a>01113     <span class="keywordflow">if</span> (! is_link(<span class="keywordtype">id</span>)) H5Giterate(<span class="keywordtype">id</span>, name, NULL, delete_children, data);
<a name="l01114"></a>01114     delete_node(<span class="keywordtype">id</span>, name);
<a name="l01115"></a>01115   }
<a name="l01116"></a>01116   <span class="keywordflow">return</span> 0;
<a name="l01117"></a>01117 }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 <span class="comment">/* -----------------------------------------------------------------</span>
<a name="l01120"></a>01120 <span class="comment"> * check for valid node name</span>
<a name="l01121"></a>01121 <span class="comment"> * The return points to static storage - make a copy if needed</span>
<a name="l01122"></a>01122 <span class="comment"> * ----------------------------------------------------------------- */</span>
<a name="l01123"></a>01123 
<a name="l01124"></a>01124 <span class="keyword">static</span> <span class="keywordtype">char</span> *check_name(<span class="keyword">const</span> <span class="keywordtype">char</span> *new_name, <span class="keywordtype">int</span> *err)
<a name="l01125"></a>01125 {
<a name="l01126"></a>01126   <span class="keywordtype">char</span> *p;
<a name="l01127"></a>01127   <span class="keyword">static</span> <span class="keywordtype">char</span> name[<a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>+1];
<a name="l01128"></a>01128 
<a name="l01129"></a>01129   <span class="keywordflow">if</span> (new_name == NULL) {
<a name="l01130"></a>01130     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>, err);
<a name="l01131"></a>01131     <span class="keywordflow">return</span> NULL;
<a name="l01132"></a>01132   }
<a name="l01133"></a>01133 
<a name="l01134"></a>01134   <span class="comment">/* skip leading space */</span>
<a name="l01135"></a>01135 
<a name="l01136"></a>01136   <span class="keywordflow">for</span> (p = (<span class="keywordtype">char</span> *)new_name; *p &amp;&amp; isspace(*p); p++)
<a name="l01137"></a>01137     ;
<a name="l01138"></a>01138   <span class="keywordflow">if</span> (!*p) {
<a name="l01139"></a>01139     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#ed336807c97f2e167849e7fdc777dcba">STRING_LENGTH_ZERO</a>, err);
<a name="l01140"></a>01140     <span class="keywordflow">return</span> NULL;
<a name="l01141"></a>01141   }
<a name="l01142"></a>01142 
<a name="l01143"></a>01143   <span class="keywordflow">if</span> (strlen(p) &gt; <a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>) {
<a name="l01144"></a>01144     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#3113602eb7ea513e38178e3c6fb4b10a">STRING_LENGTH_TOO_BIG</a>, err);
<a name="l01145"></a>01145     <span class="keywordflow">return</span> NULL;
<a name="l01146"></a>01146   }
<a name="l01147"></a>01147   strcpy(name, p);
<a name="l01148"></a>01148 
<a name="l01149"></a>01149   <span class="comment">/* remove trailing space */</span>
<a name="l01150"></a>01150 
<a name="l01151"></a>01151   <span class="keywordflow">for</span> (p = name+strlen(name)-1; p &gt;= name &amp;&amp; isspace(*p); p--)
<a name="l01152"></a>01152     ;
<a name="l01153"></a>01153   *++p = 0;
<a name="l01154"></a>01154   <span class="keywordflow">if</span> (!*name) {
<a name="l01155"></a>01155     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#ed336807c97f2e167849e7fdc777dcba">STRING_LENGTH_ZERO</a>, err);
<a name="l01156"></a>01156     <span class="keywordflow">return</span> NULL;
<a name="l01157"></a>01157   }
<a name="l01158"></a>01158 
<a name="l01159"></a>01159   <span class="comment">/* these may cause problems with HDF5 */</span>
<a name="l01160"></a>01160 
<a name="l01161"></a>01161   <span class="keywordflow">if</span> (NULL != strchr(name, <span class="charliteral">'/'</span>) || 0 == strcmp (name, <span class="stringliteral">"."</span>)) {
<a name="l01162"></a>01162     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#8b688d04e1a4096f3fb1dc7a349e4724">INVALID_NODE_NAME</a>, err);
<a name="l01163"></a>01163     <span class="keywordflow">return</span> NULL;
<a name="l01164"></a>01164   }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l01167"></a>01167   <span class="keywordflow">return</span> name;
<a name="l01168"></a>01168 }
<a name="l01169"></a>01169 
<a name="l01170"></a>01170 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l01171"></a>01171 <span class="preprocessor"></span>
<a name="l01172"></a>01172 <span class="comment">/*------------------------------------------------------------------</span>
<a name="l01173"></a>01173 <span class="comment"> * transpose multi-dimensional indices recursively</span>
<a name="l01174"></a>01174 <span class="comment"> *------------------------------------------------------------------*/</span>
<a name="l01175"></a>01175 
<a name="l01176"></a>01176 <span class="keyword">static</span> <span class="keywordtype">int</span> swap_dimensions (hid_t gid)
<a name="l01177"></a>01177 {
<a name="l01178"></a>01178   hid_t did;
<a name="l01179"></a>01179   <span class="keywordtype">char</span> verstr[<a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>+1];
<a name="l01180"></a>01180 
<a name="l01181"></a>01181   sprintf(verstr, <span class="stringliteral">"/%s"</span>, <a class="code" href="_a_d_f_h_8c.html#57dfd3d0f62d275caca74daa635cfda9">D_OLDVERS</a>);
<a name="l01182"></a>01182   <span class="keywordflow">if</span> ((did = H5Dopen2(gid, verstr, H5P_DEFAULT)) &lt; 0) <span class="keywordflow">return</span> 1;
<a name="l01183"></a>01183   H5Dclose(did);
<a name="l01184"></a>01184   <span class="keywordflow">return</span> 0;
<a name="l01185"></a>01185 }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 <span class="keyword">static</span> <span class="keywordtype">void</span> transpose_dimensions (hid_t hid, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l01188"></a>01188 {
<a name="l01189"></a>01189 <span class="preprocessor">#if 0</span>
<a name="l01190"></a>01190 <span class="preprocessor"></span>  hid_t did, sid, tid, mid;
<a name="l01191"></a>01191   <span class="keywordtype">int</span> <a class="code" href="namespacefmain.html#c6f559daa4a4864f2449315176500469">i</a>, <a class="code" href="namespacefmain.html#3025f2b2bc0423c9a3a45cb7261e32eb">j</a>, temp, ndims, diffs;
<a name="l01192"></a>01192   hsize_t bytes, <a class="code" href="_a_d_f__internals_8h.html#c51040a8258f439eeb44220688762801">dims</a>[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l01193"></a>01193   <span class="keywordtype">void</span> *data = NULL;
<a name="l01194"></a>01194 <span class="preprocessor">#else</span>
<a name="l01195"></a>01195 <span class="preprocessor"></span>  hid_t did, sid;
<a name="l01196"></a>01196   <span class="keywordtype">int</span> i, j, temp, ndims, diffs;
<a name="l01197"></a>01197   hsize_t dims[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l01198"></a>01198 <span class="preprocessor">#endif</span>
<a name="l01199"></a>01199 <span class="preprocessor"></span>
<a name="l01200"></a>01200   <span class="keywordflow">if</span> ((did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, H5P_DEFAULT)) &lt; 0) <span class="keywordflow">return</span>;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202   <span class="comment">/* get dimensions and size */</span>
<a name="l01203"></a>01203   sid = H5Dget_space(did);
<a name="l01204"></a>01204   ndims = H5Sget_simple_extent_dims(sid, dims, NULL);
<a name="l01205"></a>01205   H5Sclose(sid);
<a name="l01206"></a>01206   <span class="keywordflow">if</span> (ndims &lt; 2) {
<a name="l01207"></a>01207     H5Dclose(did);
<a name="l01208"></a>01208     <span class="keywordflow">return</span>;
<a name="l01209"></a>01209   }
<a name="l01210"></a>01210 <span class="preprocessor">#if 0</span>
<a name="l01211"></a>01211 <span class="preprocessor"></span>  printf(<span class="stringliteral">"%s:%d [%d"</span>, name, bytes, dims[0]);
<a name="l01212"></a>01212   <span class="keywordflow">for</span> (i = 1; i &lt; ndims; i++) printf(<span class="stringliteral">",%d"</span>, dims[i]);
<a name="l01213"></a>01213   printf(<span class="stringliteral">"]\n"</span>);
<a name="l01214"></a>01214   fflush(stdout);
<a name="l01215"></a>01215 <span class="preprocessor">#endif</span>
<a name="l01216"></a>01216 <span class="preprocessor"></span>
<a name="l01217"></a>01217   <span class="comment">/* transpose dimensions */</span>
<a name="l01218"></a>01218   diffs = 0;
<a name="l01219"></a>01219   <span class="keywordflow">for</span> (i = 0, j = ndims-1; i &lt; j; i++, j--) {
<a name="l01220"></a>01220     <span class="keywordflow">if</span> (dims[i] != dims[j]) {
<a name="l01221"></a>01221       temp = dims[i];
<a name="l01222"></a>01222       dims[i] = dims[j];
<a name="l01223"></a>01223       dims[j] = temp;
<a name="l01224"></a>01224       diffs++;
<a name="l01225"></a>01225     }
<a name="l01226"></a>01226   }
<a name="l01227"></a>01227   <span class="keywordflow">if</span> (0 == diffs) {
<a name="l01228"></a>01228     H5Dclose(did);
<a name="l01229"></a>01229     <span class="keywordflow">return</span>;
<a name="l01230"></a>01230   }
<a name="l01231"></a>01231 <span class="preprocessor">#if 0</span>
<a name="l01232"></a>01232 <span class="preprocessor"></span>  <span class="comment">/* read the data, then delete data set */</span>
<a name="l01233"></a>01233   bytes = H5Dget_storage_size(did);
<a name="l01234"></a>01234   tid = H5Dget_type(did);
<a name="l01235"></a>01235   mid = H5Tget_native_type(tid, H5T_DIR_ASCEND);
<a name="l01236"></a>01236   <span class="keywordflow">if</span> (bytes &gt; 0) {
<a name="l01237"></a>01237     data = <a class="code" href="cg__malloc_8h.html#535b58ab5aa48e2e86073e334d43fd32">malloc</a> ((<span class="keywordtype">unsigned</span>)bytes);
<a name="l01238"></a>01238     H5Dread(did, mid, H5S_ALL, H5S_ALL, H5P_DEFAULT, data);
<a name="l01239"></a>01239   }
<a name="l01240"></a>01240   H5Dclose(did);
<a name="l01241"></a>01241   H5Gunlink(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>);
<a name="l01242"></a>01242 
<a name="l01243"></a>01243   <span class="comment">/* rewrite data with new dimensions */</span>
<a name="l01244"></a>01244   sid = H5Screate_simple(ndims, dims, NULL);
<a name="l01245"></a>01245   did = H5Dcreate2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, tid, sid, H5P_DEFAULT, mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#786f8ccc1f3acb574c971aab6091ecef">g_propdataset</a>, H5P_DEFAULT);
<a name="l01246"></a>01246   <span class="keywordflow">if</span> (data != NULL) {
<a name="l01247"></a>01247     H5Dwrite(did, mid, H5S_ALL, sid, H5P_DEFAULT, data);
<a name="l01248"></a>01248     <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a>(data);
<a name="l01249"></a>01249   }
<a name="l01250"></a>01250   H5Tclose(mid);
<a name="l01251"></a>01251   H5Tclose(tid);
<a name="l01252"></a>01252   H5Sclose(sid);
<a name="l01253"></a>01253 <span class="preprocessor">#else</span>
<a name="l01254"></a>01254 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (H5Dset_extent(did, dims) &lt; 0) {
<a name="l01255"></a>01255       fprintf(stderr, <span class="stringliteral">"H5Dset_extent failed\n"</span>);
<a name="l01256"></a>01256   }
<a name="l01257"></a>01257 <span class="preprocessor">#endif</span>
<a name="l01258"></a>01258 <span class="preprocessor"></span>  H5Dclose(did);
<a name="l01259"></a>01259 }
<a name="l01260"></a>01260 
<a name="l01261"></a>01261 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01262"></a>01262 
<a name="l01263"></a>01263 <span class="keyword">static</span> herr_t fix_dimensions(hid_t <span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">void</span> *data)
<a name="l01264"></a>01264 {
<a name="l01265"></a>01265   hid_t gid;
<a name="l01266"></a>01266   <span class="keywordtype">int</span> err;
<a name="l01267"></a>01267   <span class="keywordtype">char</span> type[<a class="code" href="_a_d_f_8h.html#ba31f48339d645d140a127e20f47d15c">ADF_DATA_TYPE_LENGTH</a>+1];
<a name="l01268"></a>01268 
<a name="l01269"></a>01269   <span class="keywordflow">if</span> (*name != <a class="code" href="_a_d_f_h_8c.html#ac9fcaf994677f69931da9e5d51b6468">D_PREFIX</a> &amp;&amp; (gid = H5Gopen2(<span class="keywordtype">id</span>, name, H5P_DEFAULT)) &gt;= 0 &amp;&amp;
<a name="l01270"></a>01270      !get_str_att(gid, <a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">A_TYPE</a>, type, &amp;err) &amp;&amp; strcmp(type, <a class="code" href="_a_d_f_h_8c.html#45a51dad81a251c623f7cbab0f978ec0">ADFH_LK</a>)) {
<a name="l01271"></a>01271     H5Giterate(gid, <span class="stringliteral">"."</span>, NULL, fix_dimensions, NULL);
<a name="l01272"></a>01272     transpose_dimensions(gid,name);
<a name="l01273"></a>01273     H5Gclose(gid);
<a name="l01274"></a>01274   }
<a name="l01275"></a>01275   <span class="keywordflow">return</span> 0;
<a name="l01276"></a>01276 }
<a name="l01277"></a>01277 
<a name="l01278"></a>01278 <span class="preprocessor">#endif</span>
<a name="l01279"></a>01279 <span class="preprocessor"></span>
<a name="l01280"></a>01280 <span class="comment">/* ================================================================= */</span>
<a name="l01281"></a>01281 <span class="comment">/* 1 to 1 mapping of ADF functions to HDF mimic functions            */</span>
<a name="l01282"></a>01282 <span class="comment">/* ================================================================= */</span>
<a name="l01283"></a>01283 
<a name="l01284"></a>01284 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01285"></a>01285 <span class="comment">/* move a node                                                       */</span>
<a name="l01286"></a>01286 
<a name="l01287"></a><a class="code" href="_a_d_f_h_8h.html#4d2c41d792fbf8fb2dc3e036f0652422">01287</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#a3478852adfa70b7beae42cd1ac4e6a9">ADFH_Move_Child</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  pid,
<a name="l01288"></a>01288                       <span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l01289"></a>01289                       <span class="keyword">const</span> <span class="keywordtype">double</span>  npid,
<a name="l01290"></a>01290                       <span class="keywordtype">int</span>          *err)
<a name="l01291"></a>01291 {
<a name="l01292"></a>01292   hid_t hpid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(pid);
<a name="l01293"></a>01293   hid_t hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l01294"></a>01294   hid_t hnpid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(npid);
<a name="l01295"></a>01295   <span class="keywordtype">int</span> len, namelen;
<a name="l01296"></a>01296   <span class="keywordtype">int</span> old_order, new_order;
<a name="l01297"></a>01297   <span class="keywordtype">char</span> buff[2];
<a name="l01298"></a>01298   <span class="keywordtype">char</span> nodename[<a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>+1];
<a name="l01299"></a>01299   <span class="keywordtype">char</span> *newpath;
<a name="l01300"></a>01300   herr_t status;
<a name="l01301"></a>01301   H5G_stat_t stat;
<a name="l01302"></a>01302 
<a name="l01303"></a>01303   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Move_Child"</span>));
<a name="l01304"></a>01304 
<a name="l01305"></a>01305   <span class="keywordflow">if</span> (is_link(hpid) || is_link(hnpid)) {
<a name="l01306"></a>01306     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#a81b878412d4b5969a7782ec2ea8e1ee">ADFH_ERR_LINK_MOVE</a>, err);
<a name="l01307"></a>01307     <span class="keywordflow">return</span>;
<a name="l01308"></a>01308   }
<a name="l01309"></a>01309 
<a name="l01310"></a>01310   <span class="comment">/* check that node is actually child of the parent */</span>
<a name="l01311"></a>01311 
<a name="l01312"></a>01312   <span class="keywordflow">if</span> (H5Gget_objinfo(hid, <span class="stringliteral">"."</span>, 0, &amp;stat) &lt; 0 ||
<a name="l01313"></a>01313     !H5Giterate(hpid, <span class="stringliteral">"."</span>, NULL, compare_children, (<span class="keywordtype">void</span> *)&amp;stat)) {
<a name="l01314"></a>01314     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#a5fb621fd2346158d038017f457b1aae">CHILD_NOT_OF_GIVEN_PARENT</a>, err);
<a name="l01315"></a>01315     <span class="keywordflow">return</span>;
<a name="l01316"></a>01316   }
<a name="l01317"></a>01317 
<a name="l01318"></a>01318   <span class="comment">/* get node name */</span>
<a name="l01319"></a>01319 
<a name="l01320"></a>01320   <span class="keywordflow">if</span> (get_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">A_NAME</a>, nodename, err)) <span class="keywordflow">return</span>;
<a name="l01321"></a>01321   namelen = strlen(nodename);
<a name="l01322"></a>01322 
<a name="l01323"></a>01323   <span class="comment">/* get new node path */</span>
<a name="l01324"></a>01324 
<a name="l01325"></a>01325   len = H5Iget_name(hnpid, buff, 2);
<a name="l01326"></a>01326   <span class="keywordflow">if</span> (len &lt;= 0) {
<a name="l01327"></a>01327     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#8d3936d9cd3bd0388833f2112eaac660">ADFH_ERR_IGET_NAME</a>, err);
<a name="l01328"></a>01328     <span class="keywordflow">return</span>;
<a name="l01329"></a>01329   }
<a name="l01330"></a>01330   newpath = (<span class="keywordtype">char</span> *) <a class="code" href="cg__malloc_8h.html#535b58ab5aa48e2e86073e334d43fd32">malloc</a> (len+namelen+2);
<a name="l01331"></a>01331   <span class="keywordflow">if</span> (newpath == NULL) {
<a name="l01332"></a>01332     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#996254e4d79ab38ec4eb8d81b44804b8">MEMORY_ALLOCATION_FAILED</a>, err);
<a name="l01333"></a>01333     <span class="keywordflow">return</span>;
<a name="l01334"></a>01334   }
<a name="l01335"></a>01335   H5Iget_name(hnpid, newpath, len+1);
<a name="l01336"></a>01336   newpath[len++] = <span class="charliteral">'/'</span>;
<a name="l01337"></a>01337   strcpy(&amp;newpath[len], nodename);
<a name="l01338"></a>01338 
<a name="l01339"></a>01339 <span class="preprocessor">#ifdef ADFH_DEBUG_ON</span>
<a name="l01340"></a>01340 <span class="preprocessor"></span>  printf(<span class="stringliteral">"%s move [%s]\n"</span>,<a class="code" href="_a_d_f_h_8c.html#0bf541adebd748952ba64cb33bd017a2">ADFH_PREFIX</a>,nodename);
<a name="l01341"></a>01341   printf(<span class="stringliteral">"%s to   [%s]\n"</span>,<a class="code" href="_a_d_f_h_8c.html#0bf541adebd748952ba64cb33bd017a2">ADFH_PREFIX</a>,newpath);
<a name="l01342"></a>01342 <span class="preprocessor">#endif</span>
<a name="l01343"></a>01343 <span class="preprocessor"></span>
<a name="l01344"></a>01344   status = H5Gmove(hpid, nodename, newpath);
<a name="l01345"></a>01345   <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a>(newpath);
<a name="l01346"></a>01346   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l01347"></a>01347     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#a93b2aa8383610d85490d9e92ae6db82">ADFH_ERR_GMOVE</a>, err);
<a name="l01348"></a>01348     <span class="keywordflow">return</span>;
<a name="l01349"></a>01349   }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351 <span class="preprocessor">#ifdef ADFH_NO_ORDER</span>
<a name="l01352"></a>01352 <span class="preprocessor"></span>  <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l01353"></a>01353 <span class="preprocessor">#else</span>
<a name="l01354"></a>01354 <span class="preprocessor"></span>  <span class="comment">/*update _order attribute for node we just moved*/</span>
<a name="l01355"></a>01355   <a class="code" href="_a_d_f_h_8c.html#2c5ef01afb9c57791a21856d7990f8da">ADFH_Number_of_Children</a>(npid, &amp;new_order, err);
<a name="l01356"></a>01356   <span class="keywordflow">if</span> (*err != <a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>) <span class="keywordflow">return</span>;
<a name="l01357"></a>01357 
<a name="l01358"></a>01358   <span class="comment">/*read/write _order attr*/</span>
<a name="l01359"></a>01359   <span class="keywordflow">if</span> (get_int_att(hid, <a class="code" href="_a_d_f_h_8c.html#0d93ceee9ef585ec9618bd787affe17c">A_ORDER</a>, &amp;old_order, err) ||
<a name="l01360"></a>01360       set_int_att(hid, <a class="code" href="_a_d_f_h_8c.html#0d93ceee9ef585ec9618bd787affe17c">A_ORDER</a>, new_order, err)) <span class="keywordflow">return</span>;
<a name="l01361"></a>01361 
<a name="l01362"></a>01362   <span class="comment">/*see if we need to decrement any node _orders under the old parent*/</span>
<a name="l01363"></a>01363   *err = H5Giterate(hpid, <span class="stringliteral">"."</span>, NULL, fix_order, (<span class="keywordtype">void</span> *)&amp;old_order);
<a name="l01364"></a>01364   <span class="keywordflow">if</span> (!*err)
<a name="l01365"></a>01365     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l01366"></a>01366 <span class="preprocessor">#endif</span>
<a name="l01367"></a>01367 <span class="preprocessor"></span>}
<a name="l01368"></a>01368 
<a name="l01369"></a>01369 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01370"></a>01370 <span class="comment">/* Change the label attribute value                                  */</span>
<a name="l01371"></a>01371 
<a name="l01372"></a><a class="code" href="_a_d_f_h_8h.html#5bac4634af95847c223b58200ad750e0">01372</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#7822906a2250b6eaa2decedf8b5fbb96">ADFH_Set_Label</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l01373"></a>01373                     <span class="keyword">const</span> <span class="keywordtype">char</span>   *<a class="code" href="_a_d_f__internals_8h.html#363d93fb13f0f235ae88ade1b5d17180">label</a>,
<a name="l01374"></a>01374                     <span class="keywordtype">int</span>          *err)
<a name="l01375"></a>01375 {
<a name="l01376"></a>01376   hid_t hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l01377"></a>01377 
<a name="l01378"></a>01378   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Set_Label [%s]"</span>,label));
<a name="l01379"></a>01379 
<a name="l01380"></a>01380   <span class="keywordflow">if</span> (label == NULL) {
<a name="l01381"></a>01381     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>, err);
<a name="l01382"></a>01382     <span class="keywordflow">return</span>;
<a name="l01383"></a>01383   }
<a name="l01384"></a>01384   <span class="keywordflow">if</span> (strlen(label) &gt; <a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>) {
<a name="l01385"></a>01385     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#3113602eb7ea513e38178e3c6fb4b10a">STRING_LENGTH_TOO_BIG</a>, err);
<a name="l01386"></a>01386     <span class="keywordflow">return</span>;
<a name="l01387"></a>01387   }
<a name="l01388"></a>01388   <span class="keywordflow">if</span> (is_link(hid)) {
<a name="l01389"></a>01389     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#0e83ca5faed8218096517883dfbe6f78">ADFH_ERR_LINK_DATA</a>, err);
<a name="l01390"></a>01390     <span class="keywordflow">return</span>;
<a name="l01391"></a>01391   }
<a name="l01392"></a>01392   set_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#e74c4630d003eebd54e1a7b660b0ca3a">A_LABEL</a>, label, err);
<a name="l01393"></a>01393 }
<a name="l01394"></a>01394 
<a name="l01395"></a>01395 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01396"></a>01396 <span class="comment">/* Change attribute name and move the group name to new name         */</span>
<a name="l01397"></a>01397 
<a name="l01398"></a><a class="code" href="_a_d_f_h_8h.html#06481cfb687535e3c5a14dd8d5e987ce">01398</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#b6e5f25833826eb5399873a976f696e3">ADFH_Put_Name</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  pid,
<a name="l01399"></a>01399                    <span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l01400"></a>01400                    <span class="keyword">const</span> <span class="keywordtype">char</span>   *name,
<a name="l01401"></a>01401                    <span class="keywordtype">int</span>          *err)
<a name="l01402"></a>01402 {
<a name="l01403"></a>01403   hid_t hpid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(pid);
<a name="l01404"></a>01404   hid_t hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l01405"></a>01405   <span class="keywordtype">char</span> *nname, oname[<a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>+1];
<a name="l01406"></a>01406 
<a name="l01407"></a>01407   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Put_Name [%s]"</span>,name));
<a name="l01408"></a>01408 
<a name="l01409"></a>01409   <span class="keywordflow">if</span> ((nname = check_name(name, err)) == NULL) <span class="keywordflow">return</span>;
<a name="l01410"></a>01410   <span class="keywordflow">if</span> (is_link(hpid)) {
<a name="l01411"></a>01411     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#0e83ca5faed8218096517883dfbe6f78">ADFH_ERR_LINK_DATA</a>, err);
<a name="l01412"></a>01412     <span class="keywordflow">return</span>;
<a name="l01413"></a>01413   }
<a name="l01414"></a>01414   <span class="keywordflow">if</span> (<a class="code" href="_a_d_f_h_8c.html#69333d10b425a9ca3871a4ca6d453025">has_child</a>(hpid, nname)) {
<a name="l01415"></a>01415     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#4c1c4177cacebe90cb67ae50488ead58">DUPLICATE_CHILD_NAME</a>, err);
<a name="l01416"></a>01416     <span class="keywordflow">return</span>;
<a name="l01417"></a>01417   }
<a name="l01418"></a>01418   <span class="keywordflow">if</span> (!get_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">A_NAME</a>, oname, err)) {
<a name="l01419"></a>01419 <span class="preprocessor">#ifdef ADFH_DEBUG_ON</span>
<a name="l01420"></a>01420 <span class="preprocessor"></span>    printf(<span class="stringliteral">"%s change [%s] to [%s]\n"</span>,<a class="code" href="_a_d_f_h_8c.html#0bf541adebd748952ba64cb33bd017a2">ADFH_PREFIX</a>,oname,nname);
<a name="l01421"></a>01421 <span class="preprocessor">#endif</span>
<a name="l01422"></a>01422 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (H5Gmove(hpid, oname, nname) &lt; 0)
<a name="l01423"></a>01423       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#a93b2aa8383610d85490d9e92ae6db82">ADFH_ERR_GMOVE</a>, err);
<a name="l01424"></a>01424     <span class="keywordflow">else</span>
<a name="l01425"></a>01425       set_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">A_NAME</a>, nname, err);
<a name="l01426"></a>01426   }
<a name="l01427"></a>01427 }
<a name="l01428"></a>01428 
<a name="l01429"></a>01429 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01430"></a>01430 <span class="comment">/* Retrieve the name attribute value (same as group name)            */</span>
<a name="l01431"></a>01431 
<a name="l01432"></a><a class="code" href="_a_d_f_h_8h.html#26f27702a6f91256b6bbfd798f40ccd6">01432</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#bdff0033affb4b4c426ee0e64d308e7c">ADFH_Get_Name</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l01433"></a>01433                    <span class="keywordtype">char</span>         *name,
<a name="l01434"></a>01434                    <span class="keywordtype">int</span>          *err)
<a name="l01435"></a>01435 {
<a name="l01436"></a>01436   hid_t hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l01437"></a>01437   <span class="keywordtype">char</span> buffname[<a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>+1];
<a name="l01438"></a>01438 
<a name="l01439"></a>01439   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH_Get_Name"</span>));
<a name="l01440"></a>01440 
<a name="l01441"></a>01441   <span class="keywordflow">if</span> (name == NULL) {
<a name="l01442"></a>01442     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>, err);
<a name="l01443"></a>01443     <span class="keywordflow">return</span>;
<a name="l01444"></a>01444   }
<a name="l01445"></a>01445   get_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">A_NAME</a>, buffname, err);
<a name="l01446"></a>01446   strcpy(name,buffname);
<a name="l01447"></a>01447 
<a name="l01448"></a>01448   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&lt;ADFH_Get_Name [%s]"</span>,name));
<a name="l01449"></a>01449 
<a name="l01450"></a>01450 }
<a name="l01451"></a>01451 
<a name="l01452"></a>01452 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01453"></a>01453 <span class="comment">/* Retrieve the label attribute value                                */</span>
<a name="l01454"></a>01454 
<a name="l01455"></a><a class="code" href="_a_d_f_h_8h.html#925204a7160568f5da556acf83dbebf6">01455</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#d314cf26db5e66a252b11c225e450ed0">ADFH_Get_Label</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l01456"></a>01456                     <span class="keywordtype">char</span>         *<a class="code" href="_a_d_f__internals_8h.html#363d93fb13f0f235ae88ade1b5d17180">label</a>,
<a name="l01457"></a>01457                     <span class="keywordtype">int</span>          *err)
<a name="l01458"></a>01458 {
<a name="l01459"></a>01459   hid_t hid;
<a name="l01460"></a>01460   H5G_stat_t sb;  <span class="comment">/* Object information */</span>
<a name="l01461"></a>01461   <span class="keywordtype">char</span> bufflabel[<a class="code" href="_a_d_f_8h.html#04e37890f14d0ca901fb008eae485422">ADF_LABEL_LENGTH</a>+1];
<a name="l01462"></a>01462 
<a name="l01463"></a>01463   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH_Get_Label"</span>));
<a name="l01464"></a>01464 
<a name="l01465"></a>01465   <span class="keywordflow">if</span> (label == NULL) {
<a name="l01466"></a>01466     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>, err);
<a name="l01467"></a>01467     <span class="keywordflow">return</span>;
<a name="l01468"></a>01468   }
<a name="l01469"></a>01469 
<a name="l01470"></a>01470   <span class="keywordflow">if</span> ((hid = open_node(<span class="keywordtype">id</span>, err)) &gt;= 0) 
<a name="l01471"></a>01471   {
<a name="l01472"></a>01472     get_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#e74c4630d003eebd54e1a7b660b0ca3a">A_LABEL</a>, bufflabel, err);
<a name="l01473"></a>01473     <span class="keywordflow">if</span> (H5Gclose(hid)&lt;0)
<a name="l01474"></a>01474     {
<a name="l01475"></a>01475       <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH H5Gclose failed (G)"</span>));
<a name="l01476"></a>01476     }
<a name="l01477"></a>01477   }
<a name="l01478"></a>01478   strcpy(label,bufflabel);
<a name="l01479"></a>01479   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&lt;ADFH_Get_Label"</span>));
<a name="l01480"></a>01480 }
<a name="l01481"></a>01481 
<a name="l01482"></a>01482 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01483"></a>01483 <span class="comment">/* Create a new group, set its name in the name attribute</span>
<a name="l01484"></a>01484 <span class="comment">   - I may not need the name attribute, it's redundant and then</span>
<a name="l01485"></a>01485 <span class="comment">     dangerous. Anyway, now it's there, so let us use it</span>
<a name="l01486"></a>01486 <span class="comment">   - Update ref table                                                */</span>
<a name="l01487"></a>01487 
<a name="l01488"></a><a class="code" href="_a_d_f_h_8h.html#a49e06cdf5864203bf05e974e4fe5633">01488</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#c4d9eb97b885f0f098e3c0b5e801910e">ADFH_Create</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  pid,
<a name="l01489"></a>01489                  <span class="keyword">const</span> <span class="keywordtype">char</span>   *name,
<a name="l01490"></a>01490                  <span class="keywordtype">double</span>       *<span class="keywordtype">id</span>,
<a name="l01491"></a>01491                  <span class="keywordtype">int</span>          *err)
<a name="l01492"></a>01492 {
<a name="l01493"></a>01493   hid_t hpid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(pid);
<a name="l01494"></a>01494   hid_t gid,fid;
<a name="l01495"></a>01495   <span class="keywordtype">int</span> order;
<a name="l01496"></a>01496   <span class="keywordtype">char</span> *pname;
<a name="l01497"></a>01497 
<a name="l01498"></a>01498   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH_Create [%s]"</span>,name));
<a name="l01499"></a>01499 
<a name="l01500"></a>01500   <span class="keywordflow">if</span> ((pname = check_name(name, err)) == NULL) <span class="keywordflow">return</span>;
<a name="l01501"></a>01501   <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == NULL) {
<a name="l01502"></a>01502     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#df2b102a488b3458cf09fd19c761e546">NULL_NODEID_POINTER</a>, err);
<a name="l01503"></a>01503     <span class="keywordflow">return</span>;
<a name="l01504"></a>01504   }
<a name="l01505"></a>01505   <span class="comment">/*</span>
<a name="l01506"></a>01506 <span class="comment">  if (is_link(hpid)) {</span>
<a name="l01507"></a>01507 <span class="comment">    set_error(ADFH_ERR_LINK_NODE, err);</span>
<a name="l01508"></a>01508 <span class="comment">    return;</span>
<a name="l01509"></a>01509 <span class="comment">  }</span>
<a name="l01510"></a>01510 <span class="comment">  */</span>
<a name="l01511"></a>01511   <span class="keywordflow">if</span> (<a class="code" href="_a_d_f_h_8c.html#69333d10b425a9ca3871a4ca6d453025">has_child</a>(hpid, pname)) {
<a name="l01512"></a>01512     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#4c1c4177cacebe90cb67ae50488ead58">DUPLICATE_CHILD_NAME</a>, err);
<a name="l01513"></a>01513     <span class="keywordflow">return</span>;
<a name="l01514"></a>01514   }
<a name="l01515"></a>01515 
<a name="l01516"></a>01516   *<span class="keywordtype">id</span> = 0; 
<a name="l01517"></a>01517   gid = H5Gcreate2(hpid, pname, H5P_DEFAULT, H5P_DEFAULT, H5P_DEFAULT);
<a name="l01518"></a>01518 
<a name="l01519"></a>01519   <span class="keywordflow">if</span> (gid &lt; 0)
<a name="l01520"></a>01520     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d2f3154b82cce91b870ea0c7d0cfceb5">ADFH_ERR_GCREATE</a>, err);
<a name="l01521"></a>01521   <span class="keywordflow">else</span> {
<a name="l01522"></a>01522 <span class="preprocessor">#ifdef ADFH_NO_ORDER</span>
<a name="l01523"></a>01523 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (new_str_att(gid, <a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">A_NAME</a>, pname, <a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>, err) ||
<a name="l01524"></a>01524         new_str_att(gid, <a class="code" href="_a_d_f_h_8c.html#e74c4630d003eebd54e1a7b660b0ca3a">A_LABEL</a>, <span class="stringliteral">""</span>, <a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>, err) ||
<a name="l01525"></a>01525         new_str_att(gid, <a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">A_TYPE</a>, <a class="code" href="_a_d_f_h_8c.html#1ca1db6f0d9c5d502d96298ca8a93639">ADFH_MT</a>, 2, err) ||
<a name="l01526"></a>01526         <span class="comment">/* FORTRAN FLAG - mp 12/08 */</span>
<a name="l01527"></a>01527         new_int_att(gid, <a class="code" href="_a_d_f_h_8c.html#1e2bc7c35de6ff1ed599cb45b8bb4ea5">A_FLAGS</a>, mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#a6fd34ad950178f0aadf5780dbfa31b7">g_flags</a>, err)) <span class="keywordflow">return</span>;
<a name="l01528"></a>01528 <span class="preprocessor">#else</span>
<a name="l01529"></a>01529 <span class="preprocessor"></span>    order = 0;
<a name="l01530"></a>01530     H5Giterate(hpid, <span class="stringliteral">"."</span>, NULL, count_children, (<span class="keywordtype">void</span> *)&amp;order);
<a name="l01531"></a>01531     <span class="keywordflow">if</span> (new_str_att(gid, <a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">A_NAME</a>, pname, <a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>, err) ||
<a name="l01532"></a>01532         new_str_att(gid, <a class="code" href="_a_d_f_h_8c.html#e74c4630d003eebd54e1a7b660b0ca3a">A_LABEL</a>, <span class="stringliteral">""</span>, <a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>, err) ||
<a name="l01533"></a>01533         new_str_att(gid, <a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">A_TYPE</a>, <a class="code" href="_a_d_f_h_8c.html#1ca1db6f0d9c5d502d96298ca8a93639">ADFH_MT</a>, 2, err) ||
<a name="l01534"></a>01534         new_int_att(gid, <a class="code" href="_a_d_f_h_8c.html#0d93ceee9ef585ec9618bd787affe17c">A_ORDER</a>, order, err) ||
<a name="l01535"></a>01535         <span class="comment">/* FORTRAN FLAG - mp 12/08 */</span>
<a name="l01536"></a>01536         new_int_att(gid, <a class="code" href="_a_d_f_h_8c.html#1e2bc7c35de6ff1ed599cb45b8bb4ea5">A_FLAGS</a>, mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#a6fd34ad950178f0aadf5780dbfa31b7">g_flags</a>, err)) <span class="keywordflow">return</span>;
<a name="l01537"></a>01537 <span class="preprocessor">#endif</span>
<a name="l01538"></a>01538 <span class="preprocessor"></span>    *<span class="keywordtype">id</span> = <a class="code" href="_a_d_f_h_8c.html#c075abfe5b07d68a3eeb5fb874982dc4">to_ADF_ID</a>(gid);
<a name="l01539"></a>01539     <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&lt;ADFH_Create [%s]"</span>,name));
<a name="l01540"></a>01540   }
<a name="l01541"></a>01541 }
<a name="l01542"></a>01542 
<a name="l01543"></a>01543 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01544"></a>01544 <span class="comment">/* delete a node and all children recursively                        */</span>
<a name="l01545"></a>01545 
<a name="l01546"></a><a class="code" href="_a_d_f_h_8h.html#1f7d59c1503348048573c544ef77d185">01546</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#a6e74219efa8efc2d5974ff09e0fcb4c">ADFH_Delete</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  pid,
<a name="l01547"></a>01547                  <span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l01548"></a>01548                  <span class="keywordtype">int</span>    *err)
<a name="l01549"></a>01549 {
<a name="l01550"></a>01550   hid_t hpid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(pid);
<a name="l01551"></a>01551   hid_t hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l01552"></a>01552   <span class="keywordtype">char</span> old_name[<a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>+1];
<a name="l01553"></a>01553   <span class="keywordtype">int</span> old_order;
<a name="l01554"></a>01554   H5G_stat_t stat;
<a name="l01555"></a>01555 
<a name="l01556"></a>01556   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Delete"</span>));
<a name="l01557"></a>01557 
<a name="l01558"></a>01558   <span class="keywordflow">if</span> (is_link(hpid)) {
<a name="l01559"></a>01559     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#eb557f508be07956e8ecb7a88954574d">ADFH_ERR_LINK_DELETE</a>, err);
<a name="l01560"></a>01560     <span class="keywordflow">return</span>;
<a name="l01561"></a>01561   }
<a name="l01562"></a>01562 
<a name="l01563"></a>01563   <span class="comment">/* check that node is actually child of the parent */</span>
<a name="l01564"></a>01564 
<a name="l01565"></a>01565   <span class="keywordflow">if</span> (H5Gget_objinfo(hid, <span class="stringliteral">"."</span>, 0, &amp;stat) &lt; 0 ||
<a name="l01566"></a>01566     !H5Giterate(hpid, <span class="stringliteral">"."</span>, NULL, compare_children, (<span class="keywordtype">void</span> *)&amp;stat)) {
<a name="l01567"></a>01567     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#a5fb621fd2346158d038017f457b1aae">CHILD_NOT_OF_GIVEN_PARENT</a>, err);
<a name="l01568"></a>01568     <span class="keywordflow">return</span>;
<a name="l01569"></a>01569   }
<a name="l01570"></a>01570 
<a name="l01571"></a>01571   <span class="comment">/* get name and order */</span>
<a name="l01572"></a>01572 
<a name="l01573"></a>01573 <span class="preprocessor">#ifdef ADFH_NO_ORDER</span>
<a name="l01574"></a>01574 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (get_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">A_NAME</a>, old_name, err)) <span class="keywordflow">return</span>;
<a name="l01575"></a>01575 <span class="preprocessor">#else</span>
<a name="l01576"></a>01576 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (get_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">A_NAME</a>, old_name, err) ||
<a name="l01577"></a>01577       get_int_att(hid, <a class="code" href="_a_d_f_h_8c.html#0d93ceee9ef585ec9618bd787affe17c">A_ORDER</a>, &amp;old_order, err)) <span class="keywordflow">return</span>;
<a name="l01578"></a>01578 <span class="preprocessor">#endif</span>
<a name="l01579"></a>01579 <span class="preprocessor"></span>
<a name="l01580"></a>01580   <span class="comment">/* delete children nodes recursively */</span>
<a name="l01581"></a>01581 
<a name="l01582"></a>01582   <span class="keywordflow">if</span> (! is_link(hid))
<a name="l01583"></a>01583   {
<a name="l01584"></a>01584     H5Giterate(hid, <span class="stringliteral">"."</span>, NULL, delete_children, NULL);
<a name="l01585"></a>01585   }
<a name="l01586"></a>01586 
<a name="l01587"></a>01587   <span class="comment">/* delete current node */</span>
<a name="l01588"></a>01588 
<a name="l01589"></a>01589   H5Gclose(hid);
<a name="l01590"></a>01590   delete_node(hpid, old_name);
<a name="l01591"></a>01591 
<a name="l01592"></a>01592   <span class="comment">/* decrement node orders */</span>
<a name="l01593"></a>01593 
<a name="l01594"></a>01594 <span class="preprocessor">#ifndef ADFH_NO_ORDER</span>
<a name="l01595"></a>01595 <span class="preprocessor"></span>  *err = H5Giterate(hpid, <span class="stringliteral">"."</span>, NULL, fix_order, (<span class="keywordtype">void</span> *)&amp;old_order);
<a name="l01596"></a>01596   <span class="keywordflow">if</span> (!*err)
<a name="l01597"></a>01597 <span class="preprocessor">#endif</span>
<a name="l01598"></a>01598 <span class="preprocessor"></span>    <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l01599"></a>01599 }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01602"></a>01602 
<a name="l01603"></a><a class="code" href="_a_d_f_h_8h.html#2bb429d3d68939116fa4142f753ffc5a">01603</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#2c5ef01afb9c57791a21856d7990f8da">ADFH_Number_of_Children</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l01604"></a>01604                              <span class="keywordtype">int</span>    *number,
<a name="l01605"></a>01605                              <span class="keywordtype">int</span>    *err)
<a name="l01606"></a>01606 {
<a name="l01607"></a>01607   hid_t hid;
<a name="l01608"></a>01608   <span class="keywordtype">int</span> nn,gskip=0;
<a name="l01609"></a>01609 
<a name="l01610"></a>01610   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH_Number_of_Children"</span>));
<a name="l01611"></a>01611 
<a name="l01612"></a>01612   <span class="keywordflow">if</span> (number == NULL) {
<a name="l01613"></a>01613     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#b35fccb34c6d5687da3115b8de46cc8c">NULL_POINTER</a>, err);
<a name="l01614"></a>01614     <span class="keywordflow">return</span>;
<a name="l01615"></a>01615   }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617   *number = 0;
<a name="l01618"></a>01618   <span class="keywordflow">if</span> ((hid = open_node(<span class="keywordtype">id</span>, err)) &gt;= 0) {
<a name="l01619"></a>01619     H5Giterate(hid, <span class="stringliteral">"."</span>, &amp;gskip, count_children, (<span class="keywordtype">void</span>*)number);
<a name="l01620"></a>01620     H5Gclose(hid); 
<a name="l01621"></a>01621   }
<a name="l01622"></a>01622   nn=*number;
<a name="l01623"></a>01623   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&lt;ADFH_Number_of_Children [%d]"</span>,nn));
<a name="l01624"></a>01624 }
<a name="l01625"></a>01625 
<a name="l01626"></a>01626 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01627"></a>01627 
<a name="l01628"></a><a class="code" href="_a_d_f_h_8h.html#fcb23f973ccf9144806b4f6292b347eb">01628</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#a5948ee7026147b2e6964f70e0cc9173">ADFH_Get_Node_ID</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  pid,
<a name="l01629"></a>01629                       <span class="keyword">const</span> <span class="keywordtype">char</span>   *name,
<a name="l01630"></a>01630                       <span class="keywordtype">double</span>       *<span class="keywordtype">id</span>,
<a name="l01631"></a>01631                       <span class="keywordtype">int</span>          *err)
<a name="l01632"></a>01632 {
<a name="l01633"></a>01633   hid_t sid, hpid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(pid);
<a name="l01634"></a>01634   herr_t herr;
<a name="l01635"></a>01635 
<a name="l01636"></a>01636   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&gt;ADFH_Get_Node_ID [%s]"</span>,name));
<a name="l01637"></a>01637 
<a name="l01638"></a>01638   <span class="keywordflow">if</span> (name == NULL) {
<a name="l01639"></a>01639     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>, err);
<a name="l01640"></a>01640     <span class="keywordflow">return</span>;
<a name="l01641"></a>01641   }
<a name="l01642"></a>01642   <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == NULL) {
<a name="l01643"></a>01643     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#df2b102a488b3458cf09fd19c761e546">NULL_NODEID_POINTER</a>, err);
<a name="l01644"></a>01644     <span class="keywordflow">return</span>;
<a name="l01645"></a>01645   }
<a name="l01646"></a>01646 
<a name="l01647"></a>01647   *<span class="keywordtype">id</span> = 0;
<a name="l01648"></a>01648   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l01649"></a>01649   <span class="keywordflow">if</span> (*name == <span class="charliteral">'/'</span>) {
<a name="l01650"></a>01650     hid_t rid;
<a name="l01651"></a>01651     <span class="keywordtype">char</span> *path = (<span class="keywordtype">char</span> *) <a class="code" href="cg__malloc_8h.html#535b58ab5aa48e2e86073e334d43fd32">malloc</a> (strlen(name));
<a name="l01652"></a>01652     <span class="keywordflow">if</span> (path == NULL) {
<a name="l01653"></a>01653       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#996254e4d79ab38ec4eb8d81b44804b8">MEMORY_ALLOCATION_FAILED</a>, err);
<a name="l01654"></a>01654       <span class="keywordflow">return</span>;
<a name="l01655"></a>01655     }
<a name="l01656"></a>01656     strcpy(path, &amp;name[1]);
<a name="l01657"></a>01657     rid = H5Gopen2(hpid, <span class="stringliteral">"/"</span>, H5P_DEFAULT);
<a name="l01658"></a>01658     sid = parse_path(rid, path, err);
<a name="l01659"></a>01659     H5Gclose(rid);
<a name="l01660"></a>01660     <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a>(path);
<a name="l01661"></a>01661   }
<a name="l01662"></a>01662   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_link(hpid)) {
<a name="l01663"></a>01663     hid_t lid = open_link(hpid, err);
<a name="l01664"></a>01664     <span class="keywordflow">if</span> (lid &lt; 0) <span class="keywordflow">return</span>;
<a name="l01665"></a>01665     sid = H5Gopen2(lid, name, H5P_DEFAULT);
<a name="l01666"></a>01666     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(sid);
<a name="l01667"></a>01667     H5Gclose(lid);
<a name="l01668"></a>01668     <span class="keywordflow">if</span>(sid &lt; 0)
<a name="l01669"></a>01669     {
<a name="l01670"></a>01670       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d3f9f448401f1521079197a63268ad12">ADFH_ERR_GOPEN</a>, err);
<a name="l01671"></a>01671     }
<a name="l01672"></a>01672   }
<a name="l01673"></a>01673   <span class="keywordflow">else</span> {
<a name="l01674"></a>01674     sid = H5Gopen2(hpid, name, H5P_DEFAULT);
<a name="l01675"></a>01675     <span class="keywordflow">if</span>(sid &lt; 0)
<a name="l01676"></a>01676     {
<a name="l01677"></a>01677       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d3f9f448401f1521079197a63268ad12">ADFH_ERR_GOPEN</a>, err);
<a name="l01678"></a>01678     }
<a name="l01679"></a>01679   }
<a name="l01680"></a>01680   *<span class="keywordtype">id</span> = <a class="code" href="_a_d_f_h_8c.html#c075abfe5b07d68a3eeb5fb874982dc4">to_ADF_ID</a>(sid);
<a name="l01681"></a>01681   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"&lt;ADFH_Get_Node_ID [%s]"</span>,name));
<a name="l01682"></a>01682 }
<a name="l01683"></a>01683 
<a name="l01684"></a>01684 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01685"></a>01685 
<a name="l01686"></a><a class="code" href="_a_d_f_h_8h.html#31756adb6d50e58c5c399851485b85ab">01686</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#463c28eb0cd9896d077ec7a91cae0f3f">ADFH_Children_Names</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> pid,
<a name="l01687"></a>01687                          <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="_a_d_f__internals_8h.html#8c7e8da247515aa825ca574def34f15a">istart</a>,
<a name="l01688"></a>01688                          <span class="keyword">const</span> <span class="keywordtype">int</span>    ilen,
<a name="l01689"></a>01689                          <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="_a_d_f__internals_8h.html#42b7706df4af6b8d82f3d479e6dfb454">name_length</a>,
<a name="l01690"></a>01690                          <span class="keywordtype">int</span>   *ilen_ret,
<a name="l01691"></a>01691                          <span class="keywordtype">char</span>  *<a class="code" href="_a_d_f__internals_8h.html#87e8d4fea30106a45a2d55992d102288">names</a>,
<a name="l01692"></a>01692                          <span class="keywordtype">int</span>   *err)
<a name="l01693"></a>01693 {
<a name="l01694"></a>01694   <span class="keywordtype">int</span> i, ret;
<a name="l01695"></a>01695   hid_t hpid;
<a name="l01696"></a>01696 
<a name="l01697"></a>01697   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Children_Names"</span>));
<a name="l01698"></a>01698 
<a name="l01699"></a>01699   <a class="code" href="_a_d_f_h_8c.html#8c14d72149efef586123816eb46243b0">ROOT_OR_DIE</a>(err);
<a name="l01700"></a>01700   <span class="keywordflow">if</span> (ilen_ret == NULL) {
<a name="l01701"></a>01701     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#b35fccb34c6d5687da3115b8de46cc8c">NULL_POINTER</a>, err);
<a name="l01702"></a>01702     <span class="keywordflow">return</span>;
<a name="l01703"></a>01703   }
<a name="l01704"></a>01704   <span class="keywordflow">if</span> (names == NULL) {
<a name="l01705"></a>01705     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>, err);
<a name="l01706"></a>01706     <span class="keywordflow">return</span>;
<a name="l01707"></a>01707   }
<a name="l01708"></a>01708 
<a name="l01709"></a>01709   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#ea9b53c36b298e8064344b37eabe93ec">i_start</a> = istart;
<a name="l01710"></a>01710   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#ea0ae36bd9cc38e0ee1f5b2444deb586">i_len</a> = ilen;
<a name="l01711"></a>01711   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#26fd89da54c4e465e73db70f035f1f85">n_length</a> = name_length;
<a name="l01712"></a>01712   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#799467c347fcdf71beda8521204b52be">n_names</a> = 0;
<a name="l01713"></a>01713 <span class="preprocessor">#ifdef ADFH_NO_ORDER</span>
<a name="l01714"></a>01714 <span class="preprocessor"></span>  mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#42c35485c275e5d9847820d8da2d71c9">i_count</a> = 0;
<a name="l01715"></a>01715 <span class="preprocessor">#endif</span>
<a name="l01716"></a>01716 <span class="preprocessor"></span>
<a name="l01717"></a>01717   <span class="comment">/*initialize names to null*/</span>
<a name="l01718"></a>01718   memset(names, 0, ilen*name_length);
<a name="l01719"></a>01719 
<a name="l01720"></a>01720   <span class="keywordflow">if</span> ((hpid = open_node(pid, err)) &gt;= 0) {
<a name="l01721"></a>01721     H5Giterate(hpid, <span class="stringliteral">"."</span>, NULL, children_names, (<span class="keywordtype">void</span> *)names);
<a name="l01722"></a>01722     H5Gclose(hpid);
<a name="l01723"></a>01723   }
<a name="l01724"></a>01724   *ilen_ret = mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#799467c347fcdf71beda8521204b52be">n_names</a>;
<a name="l01725"></a>01725 }
<a name="l01726"></a>01726 
<a name="l01727"></a>01727 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01728"></a>01728 
<a name="l01729"></a><a class="code" href="_a_d_f_h_8h.html#4bb4a799ac984dd1f770ffa29e47307f">01729</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#a81a624109faddb5f321505bfa14d11c">ADFH_Children_IDs</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> pid,
<a name="l01730"></a>01730                          <span class="keyword">const</span> <span class="keywordtype">int</span>    <a class="code" href="_a_d_f__internals_8h.html#8c7e8da247515aa825ca574def34f15a">istart</a>,
<a name="l01731"></a>01731                          <span class="keyword">const</span> <span class="keywordtype">int</span>    icount,
<a name="l01732"></a>01732                          <span class="keywordtype">int</span>   *icount_ret,
<a name="l01733"></a>01733                          <span class="keywordtype">double</span>  *IDs,
<a name="l01734"></a>01734                          <span class="keywordtype">int</span>   *err)
<a name="l01735"></a>01735 {
<a name="l01736"></a>01736   <span class="keywordtype">int</span> ret;
<a name="l01737"></a>01737   hid_t hpid;
<a name="l01738"></a>01738 
<a name="l01739"></a>01739   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Children_IDs"</span>));
<a name="l01740"></a>01740 
<a name="l01741"></a>01741   <a class="code" href="_a_d_f_h_8c.html#8c14d72149efef586123816eb46243b0">ROOT_OR_DIE</a>(err);
<a name="l01742"></a>01742   <span class="keywordflow">if</span> (icount_ret == NULL) {
<a name="l01743"></a>01743     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#b35fccb34c6d5687da3115b8de46cc8c">NULL_POINTER</a>, err);
<a name="l01744"></a>01744     <span class="keywordflow">return</span>;
<a name="l01745"></a>01745   }
<a name="l01746"></a>01746   <span class="keywordflow">if</span> (IDs == NULL) {
<a name="l01747"></a>01747     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#df2b102a488b3458cf09fd19c761e546">NULL_NODEID_POINTER</a>, err);
<a name="l01748"></a>01748     <span class="keywordflow">return</span>;
<a name="l01749"></a>01749   }
<a name="l01750"></a>01750 
<a name="l01751"></a>01751   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#ea9b53c36b298e8064344b37eabe93ec">i_start</a> = istart;
<a name="l01752"></a>01752   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#ea0ae36bd9cc38e0ee1f5b2444deb586">i_len</a> = icount;
<a name="l01753"></a>01753   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#799467c347fcdf71beda8521204b52be">n_names</a> = 0;
<a name="l01754"></a>01754 <span class="preprocessor">#ifdef ADFH_NO_ORDER</span>
<a name="l01755"></a>01755 <span class="preprocessor"></span>  mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#42c35485c275e5d9847820d8da2d71c9">i_count</a> = 0;
<a name="l01756"></a>01756 <span class="preprocessor">#endif</span>
<a name="l01757"></a>01757 <span class="preprocessor"></span>
<a name="l01758"></a>01758   <span class="keywordflow">if</span> ((hpid = open_node(pid, err)) &gt;= 0) {
<a name="l01759"></a>01759     H5Giterate(hpid, <span class="stringliteral">"."</span>, NULL, children_ids, (<span class="keywordtype">void</span> *)IDs);
<a name="l01760"></a>01760     H5Gclose(hpid);
<a name="l01761"></a>01761   }
<a name="l01762"></a>01762   *icount_ret = mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#799467c347fcdf71beda8521204b52be">n_names</a>;
<a name="l01763"></a>01763 }
<a name="l01764"></a>01764 
<a name="l01765"></a>01765 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01766"></a>01766 
<a name="l01767"></a><a class="code" href="_a_d_f_h_8h.html#9ad57e5f0e80a9a38fdd19f867774a99">01767</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#3cc510d10799f26e9611f04af141c594">ADFH_Release_ID</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_a_d_f__internals_8h.html#fed82a4a7802f4fe37c24e3092468b96">ID</a>)
<a name="l01768"></a>01768 {
<a name="l01769"></a>01769   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Release_ID"</span>));
<a name="l01770"></a>01770 
<a name="l01771"></a>01771   H5Gclose(<a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(ID));
<a name="l01772"></a>01772 }
<a name="l01773"></a>01773 
<a name="l01774"></a>01774 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01775"></a>01775 
<a name="l01776"></a><a class="code" href="_a_d_f_h_8h.html#7d30907f61f7b4311e78eb8e2af26a5b">01776</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#2efb06b4374f42d9adb7759b39b2f59a">ADFH_Database_Open</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>   *name,
<a name="l01777"></a>01777                         <span class="keyword">const</span> <span class="keywordtype">char</span>   *stat,
<a name="l01778"></a>01778                         <span class="keyword">const</span> <span class="keywordtype">char</span>   *fmt,
<a name="l01779"></a>01779                         <span class="keywordtype">double</span>       *root,
<a name="l01780"></a>01780                         <span class="keywordtype">int</span>          *err)
<a name="l01781"></a>01781 {
<a name="l01782"></a>01782   hid_t fid, gid, fapl;
<a name="l01783"></a>01783   <span class="keywordtype">char</span> *format, buff[<a class="code" href="_a_d_f_8h.html#8f189c9385b81a9ba752840c0debdde1">ADF_VERSION_LENGTH</a>+1];
<a name="l01784"></a>01784   <span class="keywordtype">int</span> i, pos, mode;
<a name="l01785"></a>01785 
<a name="l01786"></a>01786   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Open [%s]"</span>,name));
<a name="l01787"></a>01787 
<a name="l01788"></a>01788   <span class="comment">/* to be thread safe, should have critical section here */</span>
<a name="l01789"></a>01789   <span class="keywordflow">if</span> (mta_root==NULL)
<a name="l01790"></a>01790   {
<a name="l01791"></a>01791     mta_root=(<a class="code" href="struct___a_d_f_h___m_t_a.html">ADFH_MTA</a>*)<a class="code" href="cg__malloc_8h.html#535b58ab5aa48e2e86073e334d43fd32">malloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="struct___a_d_f_h___m_t_a.html">_ADFH_MTA</a>));
<a name="l01792"></a>01792     mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#1abd210f4ff9a3bbb8b8dd19567a4424">g_init</a> = 0;
<a name="l01793"></a>01793   }
<a name="l01794"></a>01794   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#aef892c12b8d134d4574c34a74aa267a">g_error_state</a> = 0;
<a name="l01795"></a>01795   <span class="comment">/* FORTRAN FLAG - mp 12/08 */</span>
<a name="l01796"></a>01796   <span class="comment">/* flags is int seen as bitfield, fortran flag is first 0x0001 </span>
<a name="l01797"></a>01797 <span class="comment">     it is found set to 1 in *all* MLL-based HDF5 files </span>
<a name="l01798"></a>01798 <span class="comment">  */</span>
<a name="l01799"></a>01799   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#a6fd34ad950178f0aadf5780dbfa31b7">g_flags</a> = 1;
<a name="l01800"></a>01800 
<a name="l01801"></a>01801 <span class="preprocessor">#ifndef ADF_DEBUG_ON</span>
<a name="l01802"></a>01802 <span class="preprocessor"></span>  H5Eset_auto2(H5E_DEFAULT, NULL, NULL);
<a name="l01803"></a>01803 <span class="preprocessor">#endif</span>
<a name="l01804"></a>01804 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (!mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#1abd210f4ff9a3bbb8b8dd19567a4424">g_init</a>) {
<a name="l01805"></a>01805 <span class="preprocessor">#ifndef ADF_DEBUG_ON</span>
<a name="l01806"></a>01806 <span class="preprocessor"></span>    H5Eset_auto2(H5E_DEFAULT, walk_H5_error, NULL);
<a name="l01807"></a>01807 <span class="preprocessor">#endif</span>
<a name="l01808"></a>01808 <span class="preprocessor"></span>    <span class="keywordflow">for</span> (i = 0; i &lt; ADFH_MAXIMUM_FILES; i++) mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#97c82d2ac1d1dce14bc8807e7bae7caf">g_files</a>[i] = 0;
<a name="l01809"></a>01809     mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#1abd210f4ff9a3bbb8b8dd19567a4424">g_init</a> = 1;
<a name="l01810"></a>01810   }
<a name="l01811"></a>01811 
<a name="l01812"></a>01812   <span class="keywordflow">if</span> (name == NULL || stat == NULL || fmt == NULL) {
<a name="l01813"></a>01813     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>, err);
<a name="l01814"></a>01814     <span class="keywordflow">return</span>;
<a name="l01815"></a>01815   }
<a name="l01816"></a>01816 
<a name="l01817"></a>01817   <span class="comment">/* get open mode */</span>
<a name="l01818"></a>01818 
<a name="l01819"></a>01819   strncpy(buff, stat, 9);
<a name="l01820"></a>01820   buff[9] = 0;
<a name="l01821"></a>01821   <span class="keywordflow">for</span> (i = 0; buff[i]; i++)
<a name="l01822"></a>01822     buff[i] = <a class="code" href="adf__cond_8c.html#50e957a64182f3bb8c15c3fc36eac0dc">TO_UPPER</a>(buff[i]);
<a name="l01823"></a>01823 
<a name="l01824"></a>01824   <span class="keywordflow">if</span> (0 == strcmp(buff, <span class="stringliteral">"UNKNOWN"</span>)) {
<a name="l01825"></a>01825     <span class="keywordflow">if</span> (access(name, 0))
<a name="l01826"></a>01826       mode = <a class="code" href="_a_d_f_h_8c.html#7ac8991eb3562ed4653b66f3da09acc0">ADFH_MODE_NEW</a>;
<a name="l01827"></a>01827     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (access(name, 2))
<a name="l01828"></a>01828       mode = <a class="code" href="_a_d_f_h_8c.html#2f3ecaeae191bb75c6f5476805775304">ADFH_MODE_RDO</a>;
<a name="l01829"></a>01829     <span class="keywordflow">else</span>
<a name="l01830"></a>01830       mode = <a class="code" href="_a_d_f_h_8c.html#d4425bede55fc465a48588bf18aa39df">ADFH_MODE_OLD</a>;
<a name="l01831"></a>01831   }
<a name="l01832"></a>01832   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(buff, <span class="stringliteral">"NEW"</span>)) {
<a name="l01833"></a>01833     <span class="keywordflow">if</span> (!access(name, 0)) {
<a name="l01834"></a>01834       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#fca941a9a1bc0e895f7901e5592e5369">REQUESTED_NEW_FILE_EXISTS</a>, err);
<a name="l01835"></a>01835       <span class="keywordflow">return</span>;
<a name="l01836"></a>01836     }
<a name="l01837"></a>01837     mode = <a class="code" href="_a_d_f_h_8c.html#7ac8991eb3562ed4653b66f3da09acc0">ADFH_MODE_NEW</a>;
<a name="l01838"></a>01838   }
<a name="l01839"></a>01839   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(buff, <span class="stringliteral">"READ_ONLY"</span>)) {
<a name="l01840"></a>01840     <span class="keywordflow">if</span> (access(name, 0)) {
<a name="l01841"></a>01841       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#5f6e71fd2b6ec20a19a78a87795d48ea">REQUESTED_OLD_FILE_NOT_FOUND</a>, err);
<a name="l01842"></a>01842       <span class="keywordflow">return</span>;
<a name="l01843"></a>01843     }
<a name="l01844"></a>01844     mode = <a class="code" href="_a_d_f_h_8c.html#2f3ecaeae191bb75c6f5476805775304">ADFH_MODE_RDO</a>;
<a name="l01845"></a>01845   }
<a name="l01846"></a>01846   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(buff, <span class="stringliteral">"OLD"</span>)) {
<a name="l01847"></a>01847     <span class="keywordflow">if</span> (access(name, 0)) {
<a name="l01848"></a>01848       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#5f6e71fd2b6ec20a19a78a87795d48ea">REQUESTED_OLD_FILE_NOT_FOUND</a>, err);
<a name="l01849"></a>01849       <span class="keywordflow">return</span>;
<a name="l01850"></a>01850     }
<a name="l01851"></a>01851     mode = <a class="code" href="_a_d_f_h_8c.html#d4425bede55fc465a48588bf18aa39df">ADFH_MODE_OLD</a>;
<a name="l01852"></a>01852   }
<a name="l01853"></a>01853   <span class="keywordflow">else</span> {
<a name="l01854"></a>01854     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#e4e416256493377627a19ce9f967ed16">ADF_FILE_STATUS_NOT_RECOGNIZED</a>, err);
<a name="l01855"></a>01855     <span class="keywordflow">return</span>;
<a name="l01856"></a>01856   }
<a name="l01857"></a>01857 
<a name="l01858"></a>01858   <span class="comment">/* get format */</span>
<a name="l01859"></a>01859 
<a name="l01860"></a>01860 <span class="preprocessor">#if 0</span>
<a name="l01861"></a>01861 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (mode == <a class="code" href="_a_d_f_h_8c.html#7ac8991eb3562ed4653b66f3da09acc0">ADFH_MODE_NEW</a>) {
<a name="l01862"></a>01862     strncpy(buff, fmt, 11);
<a name="l01863"></a>01863     buff[11] = 0;
<a name="l01864"></a>01864     <span class="keywordflow">for</span> (i = 0; buff[i]; i++)
<a name="l01865"></a>01865       buff[i] = <a class="code" href="adf__cond_8c.html#50e957a64182f3bb8c15c3fc36eac0dc">TO_UPPER</a>(buff[i]);
<a name="l01866"></a>01866 
<a name="l01867"></a>01867     <span class="keywordflow">if</span> (strcmp(buff, <span class="stringliteral">"NATIVE"</span>) &amp;&amp;
<a name="l01868"></a>01868         strncmp(buff, <span class="stringliteral">"IEEE_BIG"</span>, 8) &amp;&amp;
<a name="l01869"></a>01869         strcmp(buff, <span class="stringliteral">"IEEE_LITTLE"</span>, 11) &amp;&amp;
<a name="l01870"></a>01870         strcmp(buff, <span class="stringliteral">"CRAY"</span>)) {
<a name="l01871"></a>01871       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#1fa57a283569340d06327e5d293c385e">ADF_FILE_FORMAT_NOT_RECOGNIZED</a>, err);
<a name="l01872"></a>01872       <span class="keywordflow">return</span>;
<a name="l01873"></a>01873     }
<a name="l01874"></a>01874   }
<a name="l01875"></a>01875 <span class="preprocessor">#endif</span>
<a name="l01876"></a>01876 <span class="preprocessor"></span>
<a name="l01877"></a>01877   <span class="comment">/* get unused slot */</span>
<a name="l01878"></a>01878 
<a name="l01879"></a>01879   <span class="keywordflow">for</span> (pos = 0; pos &lt; ADFH_MAXIMUM_FILES; pos++) {
<a name="l01880"></a>01880     <span class="keywordflow">if</span> (mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#97c82d2ac1d1dce14bc8807e7bae7caf">g_files</a>[pos] == 0) <span class="keywordflow">break</span>;
<a name="l01881"></a>01881   }
<a name="l01882"></a>01882   <span class="keywordflow">if</span> (pos == ADFH_MAXIMUM_FILES) {
<a name="l01883"></a>01883     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#56cd83988473c32f1881d7ab75813ada">TOO_MANY_ADF_FILES_OPENED</a>, err);
<a name="l01884"></a>01884     <span class="keywordflow">return</span>;
<a name="l01885"></a>01885   }
<a name="l01886"></a>01886 
<a name="l01887"></a>01887   <span class="comment">/* set access property to close all open accesses when file closed */</span>
<a name="l01888"></a>01888   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">g_propfile</a> = H5Pcreate(H5P_FILE_ACCESS);
<a name="l01889"></a>01889   H5Pset_fclose_degree(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">g_propfile</a>, H5F_CLOSE_STRONG);
<a name="l01890"></a>01890   <span class="comment">/*  H5Pset_latest_format(fapl, 1); */</span>
<a name="l01891"></a>01891   <span class="comment">//Performance patch applied by KSH on 2009.05.18</span>
<a name="l01892"></a>01892   H5Pset_libver_bounds(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">g_propfile</a>, H5F_LIBVER_LATEST, H5F_LIBVER_LATEST);
<a name="l01893"></a>01893 
<a name="l01894"></a>01894   <span class="comment">/* H5Pclose performed at file close time */</span>
<a name="l01895"></a>01895   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#4048402797b72e65947c9f02d7623d50">g_proplink</a>=H5Pcreate(H5P_LINK_ACCESS);
<a name="l01896"></a>01896   H5Pset_nlinks(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#4048402797b72e65947c9f02d7623d50">g_proplink</a>, <a class="code" href="_a_d_f_8h.html#644e40ea4837ec1bd3a81d2dfa49f8d3">ADF_MAXIMUM_LINK_DEPTH</a>);
<a name="l01897"></a>01897   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#786f8ccc1f3acb574c971aab6091ecef">g_propdataset</a>=H5Pcreate(H5P_DATASET_CREATE);
<a name="l01898"></a>01898 
<a name="l01899"></a>01899   <span class="comment">/* open the file */</span>
<a name="l01900"></a>01900 
<a name="l01901"></a>01901   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l01902"></a>01902 
<a name="l01903"></a>01903   <span class="keywordflow">if</span> (mode == <a class="code" href="_a_d_f_h_8c.html#7ac8991eb3562ed4653b66f3da09acc0">ADFH_MODE_NEW</a>) {
<a name="l01904"></a>01904     fid = H5Fcreate(name, H5F_ACC_TRUNC, H5P_DEFAULT, mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">g_propfile</a>);
<a name="l01905"></a>01905     <span class="keywordflow">if</span> (fid &lt; 0) {
<a name="l01906"></a>01906       H5Pclose(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">g_propfile</a>);
<a name="l01907"></a>01907       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#bde48ee05fd7b864a4f44ed92afd066e">FILE_OPEN_ERROR</a>, err);
<a name="l01908"></a>01908       <span class="keywordflow">return</span>;
<a name="l01909"></a>01909     }
<a name="l01910"></a>01910     gid = H5Gopen2(fid, <span class="stringliteral">"/"</span>, H5P_DEFAULT);
<a name="l01911"></a>01911     memset(buff, 0, <a class="code" href="_a_d_f_8h.html#8f189c9385b81a9ba752840c0debdde1">ADF_VERSION_LENGTH</a>+1);
<a name="l01912"></a>01912     <a class="code" href="_a_d_f_h_8c.html#662d4a7d1a8888dbf78985d63a180b95">ADFH_Library_Version</a>(buff, err);
<a name="l01913"></a>01913     format = native_format();
<a name="l01914"></a>01914     <span class="keywordflow">if</span> (new_str_att(gid, <a class="code" href="_a_d_f_h_8c.html#b6fd79c7a87b856fa2bb7cbf8d5dc82d">A_NAME</a>, <span class="stringliteral">"HDF5 MotherNode"</span>, <a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>, err) ||
<a name="l01915"></a>01915         new_str_att(gid, <a class="code" href="_a_d_f_h_8c.html#e74c4630d003eebd54e1a7b660b0ca3a">A_LABEL</a>, <span class="stringliteral">"Root Node of HDF5 File"</span>, <a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>, err) ||
<a name="l01916"></a>01916         new_str_att(gid, <a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">A_TYPE</a>, <a class="code" href="_a_d_f_h_8c.html#1ca1db6f0d9c5d502d96298ca8a93639">ADFH_MT</a>, 2, err) ||
<a name="l01917"></a>01917         new_str_data(gid, <a class="code" href="_a_d_f_h_8c.html#86bb56a7be5beae5fc02ce5dd5c6f4d4">D_FORMAT</a>, format, strlen(format), err) ||
<a name="l01918"></a>01918         new_str_data(gid, <a class="code" href="_a_d_f_h_8c.html#7145efec1802c97ae54f3fb15f3e390f">D_VERSION</a>, buff, <a class="code" href="_a_d_f_8h.html#8f189c9385b81a9ba752840c0debdde1">ADF_VERSION_LENGTH</a>, err)) {
<a name="l01919"></a>01919       H5Gclose(gid);
<a name="l01920"></a>01920       <span class="keywordflow">return</span>;
<a name="l01921"></a>01921     }
<a name="l01922"></a>01922   }
<a name="l01923"></a>01923   <span class="keywordflow">else</span> {
<a name="l01924"></a>01924     <span class="keywordflow">if</span> (H5Fis_hdf5(name) &lt;= 0) {
<a name="l01925"></a>01925       H5Pclose(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">g_propfile</a>);
<a name="l01926"></a>01926       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#9f4e5c3e35e0eda8d160badc9d9181a8">ADFH_ERR_NOT_HDF5_FILE</a>, err);
<a name="l01927"></a>01927       <span class="keywordflow">return</span>;
<a name="l01928"></a>01928     }
<a name="l01929"></a>01929     <span class="keywordflow">if</span> (mode == <a class="code" href="_a_d_f_h_8c.html#2f3ecaeae191bb75c6f5476805775304">ADFH_MODE_RDO</a>)
<a name="l01930"></a>01930       {
<a name="l01931"></a>01931       fid = H5Fopen(name, H5F_ACC_RDONLY, mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">g_propfile</a>);
<a name="l01932"></a>01932       }
<a name="l01933"></a>01933     <span class="keywordflow">else</span>
<a name="l01934"></a>01934       {
<a name="l01935"></a>01935       fid = H5Fopen(name, H5F_ACC_RDWR, mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">g_propfile</a>);
<a name="l01936"></a>01936       }
<a name="l01937"></a>01937     H5Pclose(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#0e7b6af0f864c19c48ffe0dee9cecb8b">g_propfile</a>);
<a name="l01938"></a>01938     <span class="keywordflow">if</span> (fid &lt; 0) {
<a name="l01939"></a>01939       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#bde48ee05fd7b864a4f44ed92afd066e">FILE_OPEN_ERROR</a>, err);
<a name="l01940"></a>01940       <span class="keywordflow">return</span>;
<a name="l01941"></a>01941     }
<a name="l01942"></a>01942     gid = H5Gopen2(fid, <span class="stringliteral">"/"</span>, H5P_DEFAULT);
<a name="l01943"></a>01943 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l01944"></a>01944 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (mode != <a class="code" href="_a_d_f_h_8c.html#2f3ecaeae191bb75c6f5476805775304">ADFH_MODE_RDO</a> &amp;&amp; <a class="code" href="_a_d_f_h_8c.html#69333d10b425a9ca3871a4ca6d453025">has_child</a>(gid, <a class="code" href="_a_d_f_h_8c.html#57dfd3d0f62d275caca74daa635cfda9">D_OLDVERS</a>)) {
<a name="l01945"></a>01945       H5Giterate(gid, <span class="stringliteral">"."</span>, NULL, fix_dimensions, NULL);
<a name="l01946"></a>01946       H5Gmove(gid, <a class="code" href="_a_d_f_h_8c.html#57dfd3d0f62d275caca74daa635cfda9">D_OLDVERS</a>, <a class="code" href="_a_d_f_h_8c.html#7145efec1802c97ae54f3fb15f3e390f">D_VERSION</a>);
<a name="l01947"></a>01947     }
<a name="l01948"></a>01948 <span class="preprocessor">#endif</span>
<a name="l01949"></a>01949 <span class="preprocessor"></span>  }
<a name="l01950"></a>01950 
<a name="l01951"></a>01951   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#97c82d2ac1d1dce14bc8807e7bae7caf">g_files</a>[pos] = fid;
<a name="l01952"></a>01952   <span class="comment">/*  mta_root-&gt;g_files[pos].mode = mode; */</span>
<a name="l01953"></a>01953   <span class="comment">/*  mta_root-&gt;g_files[pos].mounted = NULL; */</span>
<a name="l01954"></a>01954   *root = <a class="code" href="_a_d_f_h_8c.html#c075abfe5b07d68a3eeb5fb874982dc4">to_ADF_ID</a>(gid);
<a name="l01955"></a>01955 }
<a name="l01956"></a>01956 
<a name="l01957"></a>01957 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01958"></a>01958 
<a name="l01959"></a><a class="code" href="_a_d_f_h_8h.html#692df16d17258ae129d8c582073f6523">01959</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#4d317277811b6f8ae6bc5960976bfc91">ADFH_Database_Valid</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>   *name,
<a name="l01960"></a>01960                         <span class="keywordtype">int</span>          *err)
<a name="l01961"></a>01961 {
<a name="l01962"></a>01962     <span class="keywordflow">if</span> (NULL == name || 0 == *name)
<a name="l01963"></a>01963         *err = <a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>;
<a name="l01964"></a>01964     <span class="keywordflow">else</span>
<a name="l01965"></a>01965         *err = H5Fis_hdf5(name);
<a name="l01966"></a>01966 }
<a name="l01967"></a>01967 
<a name="l01968"></a>01968 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l01969"></a>01969 
<a name="l01970"></a><a class="code" href="_a_d_f_h_8h.html#3dced7860909b3704b77ddee031c930a">01970</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#ba9d01d6b9ee7759a5cf2606f9362e30">ADFH_Database_Get_Format</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  rootid,
<a name="l01971"></a>01971                               <span class="keywordtype">char</span>         *format,
<a name="l01972"></a>01972                               <span class="keywordtype">int</span>          *err)
<a name="l01973"></a>01973 {
<a name="l01974"></a>01974   <span class="keywordtype">char</span> node[<a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>+1];
<a name="l01975"></a>01975   hid_t did;
<a name="l01976"></a>01976   herr_t status;
<a name="l01977"></a>01977 
<a name="l01978"></a>01978   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Get_Format"</span>));
<a name="l01979"></a>01979 
<a name="l01980"></a>01980   <span class="keywordflow">if</span> (format == NULL) {
<a name="l01981"></a>01981     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>, err);
<a name="l01982"></a>01982     <span class="keywordflow">return</span>;
<a name="l01983"></a>01983   }
<a name="l01984"></a>01984   *format = 0;
<a name="l01985"></a>01985   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l01986"></a>01986 
<a name="l01987"></a>01987   sprintf(node, <span class="stringliteral">"/%s"</span>, <a class="code" href="_a_d_f_h_8c.html#86bb56a7be5beae5fc02ce5dd5c6f4d4">D_FORMAT</a>);
<a name="l01988"></a>01988   <span class="keywordflow">if</span> ((did = H5Dopen2(<a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(rootid), node, H5P_DEFAULT)) &lt; 0) {
<a name="l01989"></a>01989     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d5353af9a9320cb5b2e6847575d57242">ADFH_ERR_DOPEN</a>, err);
<a name="l01990"></a>01990     <span class="keywordflow">return</span>;
<a name="l01991"></a>01991   }
<a name="l01992"></a>01992   status = H5Dread(did, H5T_NATIVE_CHAR, H5S_ALL, H5S_ALL, H5P_DEFAULT, format);
<a name="l01993"></a>01993   H5Dclose(did);
<a name="l01994"></a>01994 
<a name="l01995"></a>01995   <span class="keywordflow">if</span> (status &lt; 0)
<a name="l01996"></a>01996     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#2fecb63aadd6d46ba3395d86f04f9745">ADFH_ERR_DREAD</a>, err);
<a name="l01997"></a>01997 }
<a name="l01998"></a>01998 
<a name="l01999"></a>01999 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02000"></a>02000 
<a name="l02001"></a><a class="code" href="_a_d_f_h_8h.html#bfccd4619e20b1f9fce657d1ba7fe3ee">02001</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#9cc462db21f7a0479c191b6ef2a7f62e">ADFH_Database_Set_Format</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  rootid,
<a name="l02002"></a>02002                               <span class="keyword">const</span> <span class="keywordtype">char</span>   *format,
<a name="l02003"></a>02003                               <span class="keywordtype">int</span>          *err)
<a name="l02004"></a>02004 {
<a name="l02005"></a>02005   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Set_Format"</span>));
<a name="l02006"></a>02006   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#0157dcee1ccd586ff7641e635db4db1c">ADFH_ERR_NOT_IMPLEMENTED</a>, err);
<a name="l02007"></a>02007 }
<a name="l02008"></a>02008 
<a name="l02009"></a>02009 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02010"></a>02010 
<a name="l02011"></a><a class="code" href="_a_d_f_h_8h.html#4e16a0865a0a979ddf37b8c190e9922b">02011</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#b9c3d8443c39a23e39a624dbeec42898">ADFH_Database_Delete</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l02012"></a>02012                           <span class="keywordtype">int</span>        *err)
<a name="l02013"></a>02013 {
<a name="l02014"></a>02014   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Delete [%s]"</span>,name));
<a name="l02015"></a>02015 
<a name="l02016"></a>02016   <span class="keywordflow">if</span> (H5Fis_hdf5(name) &lt;= 0)
<a name="l02017"></a>02017     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#9f4e5c3e35e0eda8d160badc9d9181a8">ADFH_ERR_NOT_HDF5_FILE</a>, err);
<a name="l02018"></a>02018   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unlink(name))
<a name="l02019"></a>02019     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#5a3ffddfc72040bf656aa06d442e04d7">ADFH_ERR_FILE_DELETE</a>, err);
<a name="l02020"></a>02020   <span class="keywordflow">else</span>
<a name="l02021"></a>02021     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02022"></a>02022 }
<a name="l02023"></a>02023 
<a name="l02024"></a>02024 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02025"></a>02025 
<a name="l02026"></a><a class="code" href="_a_d_f_h_8h.html#aefddf0d4ffc378bd205ed28060da4d2">02026</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#f755ac79b8011c832d5c0652c04e8bb0">ADFH_Database_Close</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  root,
<a name="l02027"></a>02027                          <span class="keywordtype">int</span>          *status)
<a name="l02028"></a>02028 {
<a name="l02029"></a>02029   <span class="keywordtype">int</span> n,idx;
<a name="l02030"></a>02030   hid_t fid, mid;
<a name="l02031"></a>02031 <span class="preprocessor">#ifdef ADFH_FORCE_ID_CLOSE</span>
<a name="l02032"></a>02032 <span class="preprocessor"></span>  <span class="keywordtype">int</span> nobj;
<a name="l02033"></a>02033   hid_t *objs;
<a name="l02034"></a>02034 <span class="preprocessor">#endif</span>
<a name="l02035"></a>02035 <span class="preprocessor"></span>
<a name="l02036"></a>02036   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Close"</span>));
<a name="l02037"></a>02037   <span class="keywordflow">if</span> (mta_root == NULL)
<a name="l02038"></a>02038   {
<a name="l02039"></a>02039     <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Close [mta is null]"</span>));
<a name="l02040"></a>02040     <span class="keywordflow">return</span>;
<a name="l02041"></a>02041   }
<a name="l02042"></a>02042   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Close 4"</span>));
<a name="l02043"></a>02043   <span class="keywordflow">if</span> ((n = get_file_number(<a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(root), status)) &lt; 0) <span class="keywordflow">return</span>;
<a name="l02044"></a>02044   fid = mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#97c82d2ac1d1dce14bc8807e7bae7caf">g_files</a>[n];
<a name="l02045"></a>02045   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#97c82d2ac1d1dce14bc8807e7bae7caf">g_files</a>[n] = 0;
<a name="l02046"></a>02046 
<a name="l02047"></a>02047   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Close 3"</span>));
<a name="l02048"></a>02048   <span class="comment">/* free up all open accesses */</span>
<a name="l02049"></a>02049 
<a name="l02050"></a>02050 <span class="preprocessor">#ifdef ADFH_FORCE_ID_CLOSE</span>
<a name="l02051"></a>02051 <span class="preprocessor"></span>  nobj = H5Fget_obj_count(fid, H5F_OBJ_ALL);
<a name="l02052"></a>02052   objs = (hid_t *) <a class="code" href="cg__malloc_8h.html#535b58ab5aa48e2e86073e334d43fd32">malloc</a> (nobj * <span class="keyword">sizeof</span>(hid_t));
<a name="l02053"></a>02053 
<a name="l02054"></a>02054   <span class="comment">/* close datatypes */</span>
<a name="l02055"></a>02055 
<a name="l02056"></a>02056   nobj = H5Fget_obj_count(fid, H5F_OBJ_DATATYPE);
<a name="l02057"></a>02057 <span class="preprocessor">#ifdef ADFH_DEBUG_ON</span>
<a name="l02058"></a>02058 <span class="preprocessor"></span>  printf(<span class="stringliteral">"%s close DataType [%d] HIDs\n"</span>,<a class="code" href="_a_d_f_h_8c.html#0bf541adebd748952ba64cb33bd017a2">ADFH_PREFIX</a>,nobj);
<a name="l02059"></a>02059 <span class="preprocessor">#endif</span>
<a name="l02060"></a>02060 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (nobj) {
<a name="l02061"></a>02061     H5Fget_obj_ids(fid, H5F_OBJ_DATATYPE, -1, objs);
<a name="l02062"></a>02062     <span class="keywordflow">for</span> (n = 0; n &lt; nobj; n++)
<a name="l02063"></a>02063       H5Tclose(objs[n]);
<a name="l02064"></a>02064   }
<a name="l02065"></a>02065 
<a name="l02066"></a>02066   <span class="comment">/* close datasets */</span>
<a name="l02067"></a>02067 
<a name="l02068"></a>02068   nobj = H5Fget_obj_count(fid, H5F_OBJ_DATASET);
<a name="l02069"></a>02069 <span class="preprocessor">#ifdef ADFH_DEBUG_ON</span>
<a name="l02070"></a>02070 <span class="preprocessor"></span>  printf(<span class="stringliteral">"%s close DataSet [%d] HIDs\n"</span>,<a class="code" href="_a_d_f_h_8c.html#0bf541adebd748952ba64cb33bd017a2">ADFH_PREFIX</a>,nobj);
<a name="l02071"></a>02071 <span class="preprocessor">#endif</span>
<a name="l02072"></a>02072 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (nobj) {
<a name="l02073"></a>02073     H5Fget_obj_ids(fid, H5F_OBJ_DATASET, -1, objs);
<a name="l02074"></a>02074     <span class="keywordflow">for</span> (n = 0; n &lt; nobj; n++)
<a name="l02075"></a>02075       H5Dclose(objs[n]);
<a name="l02076"></a>02076   }
<a name="l02077"></a>02077 
<a name="l02078"></a>02078   <span class="comment">/* close attributes */</span>
<a name="l02079"></a>02079 
<a name="l02080"></a>02080   nobj = H5Fget_obj_count(fid, H5F_OBJ_ATTR);
<a name="l02081"></a>02081 <span class="preprocessor">#ifdef ADFH_DEBUG_ON</span>
<a name="l02082"></a>02082 <span class="preprocessor"></span>  printf(<span class="stringliteral">"%s close Attr [%d] HIDs\n"</span>,<a class="code" href="_a_d_f_h_8c.html#0bf541adebd748952ba64cb33bd017a2">ADFH_PREFIX</a>,nobj);
<a name="l02083"></a>02083 <span class="preprocessor">#endif</span>
<a name="l02084"></a>02084 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (nobj) {
<a name="l02085"></a>02085     H5Fget_obj_ids(fid, H5F_OBJ_ATTR, -1, objs);
<a name="l02086"></a>02086     <span class="keywordflow">for</span> (n = 0; n &lt; nobj; n++)
<a name="l02087"></a>02087       H5Aclose(objs[n]);
<a name="l02088"></a>02088   }
<a name="l02089"></a>02089 
<a name="l02090"></a>02090   <span class="comment">/* close groups */</span>
<a name="l02091"></a>02091 
<a name="l02092"></a>02092   nobj = H5Fget_obj_count(fid, H5F_OBJ_GROUP);
<a name="l02093"></a>02093 <span class="preprocessor">#ifdef ADFH_DEBUG_ON</span>
<a name="l02094"></a>02094 <span class="preprocessor"></span>  printf(<span class="stringliteral">"%s close Group [%d] HIDs\n"</span>,<a class="code" href="_a_d_f_h_8c.html#0bf541adebd748952ba64cb33bd017a2">ADFH_PREFIX</a>,nobj);
<a name="l02095"></a>02095 <span class="preprocessor">#endif</span>
<a name="l02096"></a>02096 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (nobj) {
<a name="l02097"></a>02097     H5Fget_obj_ids(fid, H5F_OBJ_GROUP, -1, objs);
<a name="l02098"></a>02098     <span class="keywordflow">for</span> (n = 0; n &lt; nobj; n++)
<a name="l02099"></a>02099     {
<a name="l02100"></a>02100       H5Gclose(objs[n]);
<a name="l02101"></a>02101     }
<a name="l02102"></a>02102   }
<a name="l02103"></a>02103 
<a name="l02104"></a>02104 <span class="preprocessor">#if 0</span>
<a name="l02105"></a>02105 <span class="preprocessor"></span>  <span class="comment">/* close file accesses except for current */</span>
<a name="l02106"></a>02106 
<a name="l02107"></a>02107   nobj = H5Fget_obj_count(fid, H5F_OBJ_FILE);
<a name="l02108"></a>02108   <span class="keywordflow">if</span> (nobj) {
<a name="l02109"></a>02109     H5Fget_obj_ids(fid, H5F_OBJ_FILE, -1, objs);
<a name="l02110"></a>02110     <span class="keywordflow">for</span> (n = 0; n &lt; nobj; n++) {
<a name="l02111"></a>02111         <span class="keywordflow">if</span> (objs[n] != fid)
<a name="l02112"></a>02112             H5Fclose(objs[n]);
<a name="l02113"></a>02113     }
<a name="l02114"></a>02114   }
<a name="l02115"></a>02115 <span class="preprocessor">#endif</span>
<a name="l02116"></a>02116 <span class="preprocessor"></span>
<a name="l02117"></a>02117   <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a> (objs);
<a name="l02118"></a>02118 <span class="preprocessor">#endif</span>
<a name="l02119"></a>02119 <span class="preprocessor"></span>
<a name="l02120"></a>02120   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Close 2"</span>));
<a name="l02121"></a>02121   H5Pclose(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#4048402797b72e65947c9f02d7623d50">g_proplink</a>);
<a name="l02122"></a>02122   H5Pclose(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#786f8ccc1f3acb574c971aab6091ecef">g_propdataset</a>);
<a name="l02123"></a>02123 
<a name="l02124"></a>02124   <span class="comment">/* close file */</span>
<a name="l02125"></a>02125   <span class="keywordflow">if</span> (H5Fclose(fid) &lt; 0)
<a name="l02126"></a>02126     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#90a58f3ebb49feb9c649685a2bda29d9">FILE_CLOSE_ERROR</a>, status);
<a name="l02127"></a>02127   <span class="keywordflow">else</span>
<a name="l02128"></a>02128     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, status);
<a name="l02129"></a>02129 
<a name="l02130"></a>02130   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Close 1"</span>));
<a name="l02131"></a>02131   <span class="keywordflow">if</span> (mta_root != NULL)
<a name="l02132"></a>02132   {
<a name="l02133"></a>02133     idx=0;
<a name="l02134"></a>02134     <span class="keywordflow">for</span> (n = 0; n &lt; ADFH_MAXIMUM_FILES; n++)  idx+=mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#97c82d2ac1d1dce14bc8807e7bae7caf">g_files</a>[n];
<a name="l02135"></a>02135     if (! idx) 
<a name="l02136"></a>02136     {
<a name="l02137"></a>02137       <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a>(mta_root);
<a name="l02138"></a>02138       mta_root=NULL;
<a name="l02139"></a>02139     }
<a name="l02140"></a>02140   }
<a name="l02141"></a>02141   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Close 0"</span>));
<a name="l02142"></a>02142 }
<a name="l02143"></a>02143 
<a name="l02144"></a>02144 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02145"></a>02145 
<a name="l02146"></a><a class="code" href="_a_d_f_h_8h.html#0457bc362b2c1a840d3f2ba86a7ed071">02146</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#25c70f361bfbde360aea456fb4c0ccd8">ADFH_Is_Link</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02147"></a>02147                   <span class="keywordtype">int</span>          *<a class="code" href="_a_d_f__internals_8h.html#4415712da03a4d48a7c3d530baf92bdb">link_path_length</a>,
<a name="l02148"></a>02148                   <span class="keywordtype">int</span>          *err)
<a name="l02149"></a>02149 {
<a name="l02150"></a>02150   hid_t hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l02151"></a>02151 
<a name="l02152"></a>02152   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Is_Link"</span>));
<a name="l02153"></a>02153 
<a name="l02154"></a>02154   <span class="keywordflow">if</span> (is_link(hid)) {
<a name="l02155"></a>02155     hid_t did, sid;
<a name="l02156"></a>02156     hsize_t size;
<a name="l02157"></a>02157 
<a name="l02158"></a>02158     did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#e61cf009a2da32cd6a5d3c9f59ab5c0f">D_PATH</a>, H5P_DEFAULT);
<a name="l02159"></a>02159     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(did);
<a name="l02160"></a>02160     sid = H5Dget_space(did);
<a name="l02161"></a>02161     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(sid);
<a name="l02162"></a>02162     size = H5Sget_simple_extent_npoints(sid);
<a name="l02163"></a>02163     H5Sclose(sid);
<a name="l02164"></a>02164     H5Dclose(did);
<a name="l02165"></a>02165     *link_path_length = (int)size;
<a name="l02166"></a>02166 
<a name="l02167"></a>02167     <span class="keywordflow">if</span> (<a class="code" href="_a_d_f_h_8c.html#69333d10b425a9ca3871a4ca6d453025">has_child</a>(hid, <a class="code" href="_a_d_f_h_8c.html#1a964dfeefcc39a644d47ee877ef62c4">D_FILE</a>)) {
<a name="l02168"></a>02168       did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#1a964dfeefcc39a644d47ee877ef62c4">D_FILE</a>, H5P_DEFAULT);
<a name="l02169"></a>02169       <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(did);
<a name="l02170"></a>02170       sid = H5Dget_space(did);
<a name="l02171"></a>02171       <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(sid);
<a name="l02172"></a>02172       size = H5Sget_simple_extent_npoints(sid);
<a name="l02173"></a>02173       H5Sclose(sid);
<a name="l02174"></a>02174       H5Dclose(did);
<a name="l02175"></a>02175       *link_path_length += (int)size;
<a name="l02176"></a>02176     }
<a name="l02177"></a>02177   }
<a name="l02178"></a>02178   <span class="keywordflow">else</span>
<a name="l02179"></a>02179     *link_path_length = 0;
<a name="l02180"></a>02180   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02181"></a>02181 }
<a name="l02182"></a>02182 
<a name="l02183"></a>02183 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02184"></a>02184 
<a name="l02185"></a><a class="code" href="_a_d_f_h_8h.html#56ddf5705fe95a47ffa0ee5d1b2a50f8">02185</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#7893ecbf1c0d504ee91ad910d8305fb3">ADFH_Link_Size</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02186"></a>02186                   <span class="keywordtype">int</span>          *file_len,
<a name="l02187"></a>02187                   <span class="keywordtype">int</span>          *name_len,
<a name="l02188"></a>02188                   <span class="keywordtype">int</span>          *err)
<a name="l02189"></a>02189 {
<a name="l02190"></a>02190   hid_t hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l02191"></a>02191 
<a name="l02192"></a>02192   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Link_Size"</span>));
<a name="l02193"></a>02193 
<a name="l02194"></a>02194   *name_len = *file_len = 0;
<a name="l02195"></a>02195   <span class="keywordflow">if</span> (is_link(hid)) {
<a name="l02196"></a>02196     hid_t did, sid;
<a name="l02197"></a>02197     hsize_t size;
<a name="l02198"></a>02198 
<a name="l02199"></a>02199     did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#e61cf009a2da32cd6a5d3c9f59ab5c0f">D_PATH</a>, H5P_DEFAULT);
<a name="l02200"></a>02200     sid = H5Dget_space(did);
<a name="l02201"></a>02201     size = H5Sget_simple_extent_npoints(sid);
<a name="l02202"></a>02202     H5Sclose(sid);
<a name="l02203"></a>02203     H5Dclose(did);
<a name="l02204"></a>02204     *name_len = (int)size;
<a name="l02205"></a>02205 
<a name="l02206"></a>02206     <span class="keywordflow">if</span> (<a class="code" href="_a_d_f_h_8c.html#69333d10b425a9ca3871a4ca6d453025">has_child</a>(hid, <a class="code" href="_a_d_f_h_8c.html#1a964dfeefcc39a644d47ee877ef62c4">D_FILE</a>)) {
<a name="l02207"></a>02207       did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#1a964dfeefcc39a644d47ee877ef62c4">D_FILE</a>, H5P_DEFAULT);
<a name="l02208"></a>02208       sid = H5Dget_space(did);
<a name="l02209"></a>02209       size = H5Sget_simple_extent_npoints(sid);
<a name="l02210"></a>02210       H5Sclose(sid);
<a name="l02211"></a>02211       H5Dclose(did);
<a name="l02212"></a>02212       *file_len = (int)size;
<a name="l02213"></a>02213     }
<a name="l02214"></a>02214   }
<a name="l02215"></a>02215   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02216"></a>02216 }
<a name="l02217"></a>02217 
<a name="l02218"></a>02218 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02219"></a>02219 
<a name="l02220"></a><a class="code" href="_a_d_f_h_8h.html#fd5b0c882697f9c82ede2f68f4a97c95">02220</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#40f4a8da4d0e8b270d9a84635890afe3">ADFH_Get_Root_ID</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02221"></a>02221                       <span class="keywordtype">double</span>       *root_id,
<a name="l02222"></a>02222                       <span class="keywordtype">int</span>          *err)
<a name="l02223"></a>02223 {
<a name="l02224"></a>02224   hid_t rid;
<a name="l02225"></a>02225 
<a name="l02226"></a>02226   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Get_Root_ID"</span>));
<a name="l02227"></a>02227 
<a name="l02228"></a>02228   rid = H5Gopen2(<a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>), <span class="stringliteral">"/"</span>, H5P_DEFAULT);
<a name="l02229"></a>02229   <span class="keywordflow">if</span> (rid &lt; 0)
<a name="l02230"></a>02230     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d3f9f448401f1521079197a63268ad12">ADFH_ERR_GOPEN</a>, err);
<a name="l02231"></a>02231   <span class="keywordflow">else</span> {
<a name="l02232"></a>02232     *root_id = <a class="code" href="_a_d_f_h_8c.html#c075abfe5b07d68a3eeb5fb874982dc4">to_ADF_ID</a>(rid);
<a name="l02233"></a>02233     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02234"></a>02234   }
<a name="l02235"></a>02235 }
<a name="l02236"></a>02236 
<a name="l02237"></a>02237 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02238"></a>02238 
<a name="l02239"></a><a class="code" href="_a_d_f_h_8h.html#91ab943d477f216bc774480184138545">02239</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#c5c835a7cb8245cc7acf33031df26286">ADFH_Get_Data_Type</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02240"></a>02240                         <span class="keywordtype">char</span>         *<a class="code" href="_a_d_f__internals_8h.html#e14d2e5ae7b32258ea2117fe241c78a3">data_type</a>,
<a name="l02241"></a>02241                         <span class="keywordtype">int</span>          *err)
<a name="l02242"></a>02242 {
<a name="l02243"></a>02243   hid_t hid;
<a name="l02244"></a>02244   <span class="keywordtype">char</span> buffdata_type[3];
<a name="l02245"></a>02245 
<a name="l02246"></a>02246   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Get_Data_Type"</span>));
<a name="l02247"></a>02247 
<a name="l02248"></a>02248   <span class="keywordflow">if</span> ((hid = open_node(<span class="keywordtype">id</span>, err)) &gt;= 0) {
<a name="l02249"></a>02249     get_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">A_TYPE</a>, buffdata_type, err);
<a name="l02250"></a>02250     H5Gclose(hid);
<a name="l02251"></a>02251     strcpy(data_type,buffdata_type);
<a name="l02252"></a>02252   }
<a name="l02253"></a>02253 }
<a name="l02254"></a>02254 
<a name="l02255"></a>02255 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02256"></a>02256 
<a name="l02257"></a><a class="code" href="_a_d_f_h_8h.html#538733c726733b45fbacccba42a86e53">02257</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#60dc98922bd7ef9693a1dd60355b204f">ADFH_Get_Number_of_Dimensions</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02258"></a>02258                                    <span class="keywordtype">int</span>          *<a class="code" href="_a_d_f__internals_8h.html#b94cfba37a60ea5226933a991c43b53a">num_dims</a>,
<a name="l02259"></a>02259                                    <span class="keywordtype">int</span>          *err)
<a name="l02260"></a>02260 {
<a name="l02261"></a>02261   hid_t hid, did, sid;
<a name="l02262"></a>02262   <span class="keywordtype">char</span> type[3];
<a name="l02263"></a>02263 
<a name="l02264"></a>02264   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Get_Number_of_Dimensions"</span>));
<a name="l02265"></a>02265 
<a name="l02266"></a>02266   *num_dims = 0;
<a name="l02267"></a>02267   <span class="keywordflow">if</span> ((hid = open_node(<span class="keywordtype">id</span>, err)) &lt; 0) <span class="keywordflow">return</span>;
<a name="l02268"></a>02268   <span class="keywordflow">if</span> (get_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">A_TYPE</a>, type, err) ||
<a name="l02269"></a>02269     0 == strcmp(type, <a class="code" href="_a_d_f_h_8c.html#1ca1db6f0d9c5d502d96298ca8a93639">ADFH_MT</a>) || 0 == strcmp(type, <a class="code" href="_a_d_f_h_8c.html#45a51dad81a251c623f7cbab0f978ec0">ADFH_LK</a>)) {
<a name="l02270"></a>02270     H5Gclose(hid);
<a name="l02271"></a>02271     <span class="keywordflow">return</span>;
<a name="l02272"></a>02272   }
<a name="l02273"></a>02273 
<a name="l02274"></a>02274   <span class="keywordflow">if</span> ((did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, H5P_DEFAULT)) &lt; 0)
<a name="l02275"></a>02275     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#68de9030c39965958f08402f7d452ad9">NO_DATA</a>, err);
<a name="l02276"></a>02276   <span class="keywordflow">else</span> {
<a name="l02277"></a>02277     <span class="keywordflow">if</span> ((sid = H5Dget_space(did)) &lt; 0)
<a name="l02278"></a>02278       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#dc14226dccce3a22d6bd6d1b259ff095">ADFH_ERR_DGET_SPACE</a>, err);
<a name="l02279"></a>02279     <span class="keywordflow">else</span> {
<a name="l02280"></a>02280       *num_dims = H5Sget_simple_extent_ndims(sid);
<a name="l02281"></a>02281       H5Sclose(sid);
<a name="l02282"></a>02282     }
<a name="l02283"></a>02283     H5Dclose(did);
<a name="l02284"></a>02284   }
<a name="l02285"></a>02285   H5Gclose(hid);
<a name="l02286"></a>02286 }
<a name="l02287"></a>02287 
<a name="l02288"></a>02288 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02289"></a>02289 
<a name="l02290"></a><a class="code" href="_a_d_f_h_8h.html#31965b6bff49fb40e79d1861972b1e4c">02290</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#ba6114d32960b4fef53b30ef1546965c">ADFH_Get_Dimension_Values</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02291"></a>02291                                <span class="keywordtype">int</span>           <a class="code" href="_a_d_f__internals_8h.html#830f6050ecf88958651b63cc1abfba2d">dim_vals</a>[],
<a name="l02292"></a>02292                                <span class="keywordtype">int</span>           *err)
<a name="l02293"></a>02293 {
<a name="l02294"></a>02294   <span class="keywordtype">int</span> i, ndims, swap = 0;
<a name="l02295"></a>02295   hid_t hid, did, sid;
<a name="l02296"></a>02296   hsize_t temp_vals[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l02297"></a>02297   herr_t status;
<a name="l02298"></a>02298 
<a name="l02299"></a>02299   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Get_Dimension_Values"</span>));
<a name="l02300"></a>02300 
<a name="l02301"></a>02301   ndims=0;
<a name="l02302"></a>02302   dim_vals[0]=0;
<a name="l02303"></a>02303   <span class="keywordflow">if</span> ((hid = open_node(<span class="keywordtype">id</span>, err)) &lt; 0) <span class="keywordflow">return</span>;
<a name="l02304"></a>02304   <span class="keywordflow">if</span> ((did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, H5P_DEFAULT)) &lt; 0)
<a name="l02305"></a>02305     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#68de9030c39965958f08402f7d452ad9">NO_DATA</a>, err);
<a name="l02306"></a>02306   <span class="keywordflow">else</span> {
<a name="l02307"></a>02307     <span class="keywordflow">if</span> ((sid = H5Dget_space(did)) &lt; 0)
<a name="l02308"></a>02308       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#dc14226dccce3a22d6bd6d1b259ff095">ADFH_ERR_DGET_SPACE</a>, err);
<a name="l02309"></a>02309     <span class="keywordflow">else</span> {
<a name="l02310"></a>02310       ndims = H5Sget_simple_extent_ndims(sid);
<a name="l02311"></a>02311       <span class="keywordflow">if</span> (ndims &gt; 0) {
<a name="l02312"></a>02312         H5Sget_simple_extent_dims(sid, temp_vals, NULL);
<a name="l02313"></a>02313 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l02314"></a>02314 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (ndims &gt; 1) swap = swap_dimensions(hid);
<a name="l02315"></a>02315 <span class="preprocessor">#endif</span>
<a name="l02316"></a>02316 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (swap) {
<a name="l02317"></a>02317           <span class="keywordflow">for</span> (i = 0; i &lt; ndims; i++)
<a name="l02318"></a>02318             dim_vals[i] = (<span class="keywordtype">int</span>)temp_vals[ndims-1-i];
<a name="l02319"></a>02319         }
<a name="l02320"></a>02320         <span class="keywordflow">else</span> {
<a name="l02321"></a>02321           <span class="keywordflow">for</span> (i = 0; i &lt; ndims; i++)
<a name="l02322"></a>02322             dim_vals[i] = (<span class="keywordtype">int</span>)temp_vals[i];
<a name="l02323"></a>02323         }
<a name="l02324"></a>02324       }
<a name="l02325"></a>02325       H5Sclose(sid);
<a name="l02326"></a>02326     }
<a name="l02327"></a>02327     H5Dclose(did);
<a name="l02328"></a>02328   }
<a name="l02329"></a>02329   H5Gclose(hid);
<a name="l02330"></a>02330 }
<a name="l02331"></a>02331 
<a name="l02332"></a>02332 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02333"></a>02333 
<a name="l02334"></a><a class="code" href="_a_d_f_h_8h.html#9857a060a99fccce0db5aab4f6a7f590">02334</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#8de08e77f19d7f1b28a6489de0c2cb9a">ADFH_Put_Dimension_Information</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02335"></a>02335                                     <span class="keyword">const</span> <span class="keywordtype">char</span>   *<a class="code" href="_a_d_f__internals_8h.html#e14d2e5ae7b32258ea2117fe241c78a3">data_type</a>,
<a name="l02336"></a>02336                                     <span class="keyword">const</span> <span class="keywordtype">int</span>     dims,
<a name="l02337"></a>02337                                     <span class="keyword">const</span> <span class="keywordtype">int</span>     <a class="code" href="_a_d_f__internals_8h.html#830f6050ecf88958651b63cc1abfba2d">dim_vals</a>[],
<a name="l02338"></a>02338                                     <span class="keywordtype">int</span>          *err)
<a name="l02339"></a>02339 {
<a name="l02340"></a>02340   hid_t hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l02341"></a>02341   hid_t did, tid, sid, mid;
<a name="l02342"></a>02342   <span class="keywordtype">int</span> i, swap = 0;
<a name="l02343"></a>02343   hsize_t old_size;
<a name="l02344"></a>02344   hsize_t old_dims[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l02345"></a>02345   hsize_t new_dims[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l02346"></a>02346   <span class="keywordtype">void</span> *data = NULL;
<a name="l02347"></a>02347   <span class="keywordtype">char</span> old_type[3];
<a name="l02348"></a>02348   <span class="keywordtype">char</span> new_type[3];
<a name="l02349"></a>02349 
<a name="l02350"></a>02350   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Put_Dimension_Information"</span>));
<a name="l02351"></a>02351 
<a name="l02352"></a>02352   <span class="keywordflow">if</span> (is_link(hid)) {
<a name="l02353"></a>02353     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#0e83ca5faed8218096517883dfbe6f78">ADFH_ERR_LINK_DATA</a>, err);
<a name="l02354"></a>02354     <span class="keywordflow">return</span>;
<a name="l02355"></a>02355   }
<a name="l02356"></a>02356   <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++)
<a name="l02357"></a>02357     new_type[i] = <a class="code" href="adf__cond_8c.html#50e957a64182f3bb8c15c3fc36eac0dc">TO_UPPER</a>(data_type[i]);
<a name="l02358"></a>02358   new_type[2] = 0;
<a name="l02359"></a>02359 
<a name="l02360"></a>02360   <span class="keywordflow">if</span> (0 == strcmp(new_type, <a class="code" href="_a_d_f_h_8c.html#1ca1db6f0d9c5d502d96298ca8a93639">ADFH_MT</a>)) {
<a name="l02361"></a>02361     <span class="keywordflow">if</span> (<a class="code" href="_a_d_f_h_8c.html#d05c7d5eb688634c398c562af1fb8680">has_data</a>(hid))
<a name="l02362"></a>02362       H5Gunlink(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>);
<a name="l02363"></a>02363     set_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">A_TYPE</a>, new_type, err);
<a name="l02364"></a>02364     <span class="keywordflow">return</span>;
<a name="l02365"></a>02365   }
<a name="l02366"></a>02366 
<a name="l02367"></a>02367   <span class="keywordflow">if</span> (check_data_type(new_type, err)) <span class="keywordflow">return</span>;
<a name="l02368"></a>02368   <span class="keywordflow">if</span> (dims &lt; 1 || dims &gt; <a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>) {
<a name="l02369"></a>02369     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#443f811c30081b9688b9dea516bb1ae6">BAD_NUMBER_OF_DIMENSIONS</a>, err);
<a name="l02370"></a>02370     <span class="keywordflow">return</span>;
<a name="l02371"></a>02371   }
<a name="l02372"></a>02372   <span class="keywordflow">for</span> (i = 0; i &lt; dims; i++) {
<a name="l02373"></a>02373     <span class="keywordflow">if</span> (dim_vals[i] &lt; 1) {
<a name="l02374"></a>02374       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#27886fcf786592753add8f9b858fbc83">BAD_DIMENSION_VALUE</a>, err);
<a name="l02375"></a>02375       <span class="keywordflow">return</span>;
<a name="l02376"></a>02376     }
<a name="l02377"></a>02377   }
<a name="l02378"></a>02378 
<a name="l02379"></a>02379   <span class="comment">/*</span>
<a name="l02380"></a>02380 <span class="comment">   * The ADF documentation allows the dimension values to be changed</span>
<a name="l02381"></a>02381 <span class="comment">   * without affecting the data, so long as the data type and number</span>
<a name="l02382"></a>02382 <span class="comment">   * of dimensions are the same. With HDF5, we could emulate that by</span>
<a name="l02383"></a>02383 <span class="comment">   * using extendable data spaces (with chunking). However this only</span>
<a name="l02384"></a>02384 <span class="comment">   * allows the data size to increase, not decrease, and coming up</span>
<a name="l02385"></a>02385 <span class="comment">   * with a good value for chunking is difficult. Since changing the</span>
<a name="l02386"></a>02386 <span class="comment">   * dimension values without rewriting the data is not a common</span>
<a name="l02387"></a>02387 <span class="comment">   * operation, I decided to use fixed sizes, then buffer the data</span>
<a name="l02388"></a>02388 <span class="comment">   * in these rare cases.</span>
<a name="l02389"></a>02389 <span class="comment">   */</span>
<a name="l02390"></a>02390 
<a name="l02391"></a>02391   old_size = 0;
<a name="l02392"></a>02392   <span class="keywordflow">if</span>(<a class="code" href="_a_d_f_h_8c.html#d05c7d5eb688634c398c562af1fb8680">has_data</a>(hid)) {
<a name="l02393"></a>02393     H5Gunlink(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>);
<a name="l02394"></a>02394   }
<a name="l02395"></a>02395 
<a name="l02396"></a>02396   <span class="keywordflow">if</span> (set_str_att(hid, <a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">A_TYPE</a>, new_type, err)) {
<a name="l02397"></a>02397     <span class="keywordflow">if</span> (data != NULL) <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a>(data);
<a name="l02398"></a>02398     <span class="keywordflow">return</span>;
<a name="l02399"></a>02399   }
<a name="l02400"></a>02400 
<a name="l02401"></a>02401   <span class="comment">/* recreate the data space with the new values */</span>
<a name="l02402"></a>02402 
<a name="l02403"></a>02403 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l02404"></a>02404 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (dims &gt; 1) swap = swap_dimensions(hid);
<a name="l02405"></a>02405 <span class="preprocessor">#endif</span>
<a name="l02406"></a>02406 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (swap) {
<a name="l02407"></a>02407     <span class="keywordflow">for</span> (i = 0; i &lt; dims; i++)
<a name="l02408"></a>02408       new_dims[i] = (hsize_t)dim_vals[dims-1-i];
<a name="l02409"></a>02409   }
<a name="l02410"></a>02410   <span class="keywordflow">else</span> {
<a name="l02411"></a>02411     <span class="keywordflow">for</span> (i = 0; i &lt; dims; i++)
<a name="l02412"></a>02412       new_dims[i] = (hsize_t)dim_vals[i];
<a name="l02413"></a>02413   }
<a name="l02414"></a>02414 
<a name="l02415"></a>02415   tid = to_HDF_data_type(new_type);
<a name="l02416"></a>02416   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(tid);
<a name="l02417"></a>02417   sid = H5Screate_simple(dims, new_dims, NULL);
<a name="l02418"></a>02418   <span class="comment">/* better idea? how to guess the right size? */</span>
<a name="l02419"></a>02419 <span class="preprocessor">#ifdef ADFH_COMPRESS_DATA</span>
<a name="l02420"></a>02420 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="_a_d_f_h_8c.html#8130874cb175b93f3c080aa7eab00a94">cgns_compress</a> != -1)
<a name="l02421"></a>02421   {
<a name="l02422"></a>02422     H5Pset_deflate(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#786f8ccc1f3acb574c971aab6091ecef">g_propdataset</a>, <a class="code" href="_a_d_f_h_8c.html#8130874cb175b93f3c080aa7eab00a94">cgns_compress</a>);
<a name="l02423"></a>02423   }
<a name="l02424"></a>02424   H5Pset_chunk(mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#786f8ccc1f3acb574c971aab6091ecef">g_propdataset</a>, dims, new_dims);
<a name="l02425"></a>02425 <span class="preprocessor">#endif</span>
<a name="l02426"></a>02426 <span class="preprocessor"></span>  <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(sid);
<a name="l02427"></a>02427   did = H5Dcreate2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, tid, sid, 
<a name="l02428"></a>02428                    H5P_DEFAULT, mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#786f8ccc1f3acb574c971aab6091ecef">g_propdataset</a>, H5P_DEFAULT);
<a name="l02429"></a>02429   H5Eprint1(stdout);
<a name="l02430"></a>02430   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(did);
<a name="l02431"></a>02431 
<a name="l02432"></a>02432   <span class="keywordflow">if</span> (did &lt; 0 &amp;&amp; data != NULL) {
<a name="l02433"></a>02433     <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a>(data);
<a name="l02434"></a>02434     data = NULL;
<a name="l02435"></a>02435   }
<a name="l02436"></a>02436 
<a name="l02437"></a>02437   <span class="comment">/* write the saved data back to the data space */</span>
<a name="l02438"></a>02438 
<a name="l02439"></a>02439   <span class="keywordflow">if</span> (data != NULL) {
<a name="l02440"></a>02440     mid = H5Tget_native_type(tid, H5T_DIR_ASCEND);
<a name="l02441"></a>02441     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(mid);
<a name="l02442"></a>02442     <span class="keywordflow">if</span> (old_size &lt; H5Dget_storage_size(did))
<a name="l02443"></a>02443       H5Sset_extent_simple(sid, dims, old_dims, NULL);
<a name="l02444"></a>02444     H5Dwrite(did, mid, H5S_ALL, sid, H5P_DEFAULT, data);
<a name="l02445"></a>02445     H5Tclose(mid);
<a name="l02446"></a>02446     <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a>(data);
<a name="l02447"></a>02447   }
<a name="l02448"></a>02448 
<a name="l02449"></a>02449   H5Sclose(sid);
<a name="l02450"></a>02450   H5Tclose(tid);
<a name="l02451"></a>02451 
<a name="l02452"></a>02452   <span class="keywordflow">if</span> (did &lt; 0)
<a name="l02453"></a>02453     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#3461ee8f8e0e314347cfe9af2126aff8">ADFH_ERR_DCREATE</a>, err);
<a name="l02454"></a>02454   <span class="keywordflow">else</span> {
<a name="l02455"></a>02455     H5Dclose(did);
<a name="l02456"></a>02456     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02457"></a>02457   }
<a name="l02458"></a>02458 }
<a name="l02459"></a>02459 
<a name="l02460"></a>02460 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02461"></a>02461 
<a name="l02462"></a><a class="code" href="_a_d_f_h_8h.html#bdc5d5c6b86d5c9f89b541e179863116">02462</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#2c1ebf6efaeb8ee8bf7d9dff84b47889">ADFH_Get_Link_Path</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02463"></a>02463                         <span class="keywordtype">char</span>   *<a class="code" href="_a_d_f__internals_8h.html#1bc14b345d09a9f773dfde50d7f2d830">filename</a>,
<a name="l02464"></a>02464                         <span class="keywordtype">char</span>   *<a class="code" href="_a_d_f__internals_8h.html#7794d6a0138876e836cb50540bdc80dd">link_path</a>,
<a name="l02465"></a>02465                         <span class="keywordtype">int</span>    *err)
<a name="l02466"></a>02466 {
<a name="l02467"></a>02467   hid_t hid, did;
<a name="l02468"></a>02468   <span class="keywordtype">char</span> *mntpath;
<a name="l02469"></a>02469 
<a name="l02470"></a>02470   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Get_Link_Path"</span>));
<a name="l02471"></a>02471 
<a name="l02472"></a>02472   hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l02473"></a>02473   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(hid);
<a name="l02474"></a>02474   <span class="keywordflow">if</span> (!is_link(hid)) {
<a name="l02475"></a>02475     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#4fd71edd5d748313b7ea302b02f75751">NODE_IS_NOT_A_LINK</a>, err);
<a name="l02476"></a>02476     <span class="keywordflow">return</span>;
<a name="l02477"></a>02477   }
<a name="l02478"></a>02478   did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#e61cf009a2da32cd6a5d3c9f59ab5c0f">D_PATH</a>, H5P_DEFAULT);
<a name="l02479"></a>02479   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(did);
<a name="l02480"></a>02480   H5Dread(did, H5T_NATIVE_CHAR, H5S_ALL, H5S_ALL, H5P_DEFAULT, link_path);
<a name="l02481"></a>02481   H5Dclose(did);
<a name="l02482"></a>02482 
<a name="l02483"></a>02483   <span class="keywordflow">if</span> (<a class="code" href="_a_d_f_h_8c.html#69333d10b425a9ca3871a4ca6d453025">has_child</a>(hid, <a class="code" href="_a_d_f_h_8c.html#1a964dfeefcc39a644d47ee877ef62c4">D_FILE</a>)) {
<a name="l02484"></a>02484     did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#1a964dfeefcc39a644d47ee877ef62c4">D_FILE</a>, H5P_DEFAULT);
<a name="l02485"></a>02485     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(did);
<a name="l02486"></a>02486     H5Dread(did, H5T_NATIVE_CHAR, H5S_ALL, H5S_ALL, H5P_DEFAULT, filename);
<a name="l02487"></a>02487     H5Dclose(did);
<a name="l02488"></a>02488   }
<a name="l02489"></a>02489   <span class="keywordflow">else</span>
<a name="l02490"></a>02490   {
<a name="l02491"></a>02491     *filename = 0;
<a name="l02492"></a>02492   }
<a name="l02493"></a>02493   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02494"></a>02494 }
<a name="l02495"></a>02495 
<a name="l02496"></a>02496 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02497"></a>02497 
<a name="l02498"></a><a class="code" href="_a_d_f_h_8h.html#def7f7979edbcc5c6757b9baecbc29d5">02498</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#5a743cbcc153fac1bdc5fa23818f086e">ADFH_Link</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  pid,
<a name="l02499"></a>02499                <span class="keyword">const</span> <span class="keywordtype">char</span>   *name,
<a name="l02500"></a>02500                <span class="keyword">const</span> <span class="keywordtype">char</span>   *file,
<a name="l02501"></a>02501                <span class="keyword">const</span> <span class="keywordtype">char</span>   *<a class="code" href="_a_d_f__internals_8h.html#38268b4a37cf5922b6027a50b298b7a5">name_in_file</a>,
<a name="l02502"></a>02502                <span class="keywordtype">double</span>       *<span class="keywordtype">id</span>,
<a name="l02503"></a>02503                <span class="keywordtype">int</span>          *err)
<a name="l02504"></a>02504 {
<a name="l02505"></a>02505   <span class="keywordtype">int</span> refcnt, mntnum;
<a name="l02506"></a>02506   <span class="keywordtype">char</span> mntname[32], *target;
<a name="l02507"></a>02507   herr_t status;
<a name="l02508"></a>02508   hid_t rid, gid, mid, lid;
<a name="l02509"></a>02509 
<a name="l02510"></a>02510   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Link [%s][%s][%s]"</span>,name,file,name_in_file));
<a name="l02511"></a>02511 
<a name="l02512"></a>02512   <a class="code" href="_a_d_f_h_8c.html#8c14d72149efef586123816eb46243b0">ROOT_OR_DIE</a>(err);
<a name="l02513"></a>02513   <a class="code" href="_a_d_f_h_8c.html#c4d9eb97b885f0f098e3c0b5e801910e">ADFH_Create</a>(pid, name, <span class="keywordtype">id</span>, err);
<a name="l02514"></a>02514 
<a name="l02515"></a>02515   <span class="keywordflow">if</span> (*err != <a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>) <span class="keywordflow">return</span>;
<a name="l02516"></a>02516   lid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(*<span class="keywordtype">id</span>);
<a name="l02517"></a>02517   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(lid);
<a name="l02518"></a>02518   <span class="keywordflow">if</span> (set_str_att(lid, <a class="code" href="_a_d_f_h_8c.html#3d3da877a207b6aeb3c0d1e4386d1b9a">A_TYPE</a>, <a class="code" href="_a_d_f_h_8c.html#45a51dad81a251c623f7cbab0f978ec0">ADFH_LK</a>, err)) <span class="keywordflow">return</span>;
<a name="l02519"></a>02519 
<a name="l02520"></a>02520   <span class="comment">/*</span>
<a name="l02521"></a>02521 <span class="comment">   * If this is a link to a file, then need to create external link</span>
<a name="l02522"></a>02522 <span class="comment">   * Otherwise, create a soft link</span>
<a name="l02523"></a>02523 <span class="comment">   */</span>
<a name="l02524"></a>02524   <span class="keywordflow">if</span> (*file) {
<a name="l02525"></a>02525 
<a name="l02526"></a>02526   <span class="comment">/* actual link is in the D_LINK group to avoid collision with "real" node</span>
<a name="l02527"></a>02527 <span class="comment">     because we cannot have a node ID  and a link on this ID (can we?)</span>
<a name="l02528"></a>02528 <span class="comment">     set actual link to D_LINK name (not the current node) */</span>
<a name="l02529"></a>02529   H5Lcreate_external(file,
<a name="l02530"></a>02530                      name_in_file,
<a name="l02531"></a>02531                      lid,
<a name="l02532"></a>02532                      <a class="code" href="_a_d_f_h_8c.html#bbed85e98b4e4faf4e28bd714e2be01c">D_LINK</a>,
<a name="l02533"></a>02533                      H5P_DEFAULT,
<a name="l02534"></a>02534                      mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#4048402797b72e65947c9f02d7623d50">g_proplink</a>);
<a name="l02535"></a>02535   }
<a name="l02536"></a>02536   <span class="keywordflow">else</span>
<a name="l02537"></a>02537   {
<a name="l02538"></a>02538     target = (<span class="keywordtype">char</span> *) <a class="code" href="cg__malloc_8h.html#535b58ab5aa48e2e86073e334d43fd32">malloc</a> (strlen(name_in_file)+2);
<a name="l02539"></a>02539     <span class="keywordflow">if</span> (target == NULL) {
<a name="l02540"></a>02540       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#996254e4d79ab38ec4eb8d81b44804b8">MEMORY_ALLOCATION_FAILED</a>, err);
<a name="l02541"></a>02541       <span class="keywordflow">return</span>;
<a name="l02542"></a>02542     }
<a name="l02543"></a>02543     <span class="keywordflow">if</span> (*name_in_file == <span class="charliteral">'/'</span>)
<a name="l02544"></a>02544       strcpy(target, name_in_file);
<a name="l02545"></a>02545     <span class="keywordflow">else</span>
<a name="l02546"></a>02546       sprintf(target, <span class="stringliteral">"/%s"</span>, name_in_file);
<a name="l02547"></a>02547 
<a name="l02548"></a>02548     <span class="comment">/* create a soft link */</span>
<a name="l02549"></a>02549     
<a name="l02550"></a>02550     status = H5Glink(lid, H5G_LINK_SOFT, target, <a class="code" href="_a_d_f_h_8c.html#bbed85e98b4e4faf4e28bd714e2be01c">D_LINK</a>);
<a name="l02551"></a>02551     <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a>(target);
<a name="l02552"></a>02552     <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l02553"></a>02553       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#86aa0bd6d6b753b66379001bed91c4f7">ADFH_ERR_GLINK</a>, err);
<a name="l02554"></a>02554       <span class="keywordflow">return</span>;
<a name="l02555"></a>02555     }
<a name="l02556"></a>02556   }
<a name="l02557"></a>02557 
<a name="l02558"></a>02558   <span class="comment">/* save link path and file */</span>
<a name="l02559"></a>02559   <span class="keywordflow">if</span> (new_str_data(lid,<a class="code" href="_a_d_f_h_8c.html#e61cf009a2da32cd6a5d3c9f59ab5c0f">D_PATH</a>,name_in_file,strlen(name_in_file),err)) <span class="keywordflow">return</span>;
<a name="l02560"></a>02560   <span class="keywordflow">if</span> (*file &amp;&amp; new_str_data(lid,<a class="code" href="_a_d_f_h_8c.html#1a964dfeefcc39a644d47ee877ef62c4">D_FILE</a>,file,strlen(file),err))        <span class="keywordflow">return</span>;
<a name="l02561"></a>02561 
<a name="l02562"></a>02562   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02563"></a>02563 }
<a name="l02564"></a>02564 
<a name="l02565"></a>02565 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02566"></a>02566 
<a name="l02567"></a><a class="code" href="_a_d_f_h_8h.html#d7f5116c856de049aebddcab877dc913">02567</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#59ee6ef186cf6f67be414af5fc5ab84b">ADFH_Flush_to_Disk</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02568"></a>02568                         <span class="keywordtype">int</span>          *err)
<a name="l02569"></a>02569 {
<a name="l02570"></a>02570   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Flush_to_Disk"</span>));
<a name="l02571"></a>02571 
<a name="l02572"></a>02572   <span class="keywordflow">if</span>(H5Fflush(<a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>), H5F_SCOPE_LOCAL) &gt;=0 )
<a name="l02573"></a>02573     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02574"></a>02574   <span class="keywordflow">else</span>
<a name="l02575"></a>02575     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#54445a38603f6cd016965674a8445d8f">FFLUSH_ERROR</a>, err);
<a name="l02576"></a>02576 }
<a name="l02577"></a>02577 
<a name="l02578"></a>02578 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02579"></a>02579 
<a name="l02580"></a><a class="code" href="_a_d_f_h_8h.html#ac56725351ac3ab835621d4f8cb4d666">02580</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#398c9d3ed53af3142603c975cd0acc37">ADFH_Database_Garbage_Collection</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02581"></a>02581                                       <span class="keywordtype">int</span>          *err)
<a name="l02582"></a>02582 {
<a name="l02583"></a>02583   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Garbage_Collection"</span>));
<a name="l02584"></a>02584 
<a name="l02585"></a>02585   <span class="keywordflow">if</span>(H5garbage_collect() &gt;= 0)
<a name="l02586"></a>02586     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02587"></a>02587   <span class="keywordflow">else</span>
<a name="l02588"></a>02588     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#68de9030c39965958f08402f7d452ad9">NO_DATA</a>, err);
<a name="l02589"></a>02589 }
<a name="l02590"></a>02590 
<a name="l02591"></a>02591 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02592"></a>02592 
<a name="l02593"></a><a class="code" href="_a_d_f_h_8h.html#6e1720e30b2875c72a82a40643c235a9">02593</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#95c8f464fc724e2ca4b343c8f8a819f6">ADFH_Database_Version</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  root_id,
<a name="l02594"></a>02594                            <span class="keywordtype">char</span>         *<a class="code" href="_a_d_f__internals_8h.html#db89ae0fa05e5926a3cdb67f1c28539c">version</a>,
<a name="l02595"></a>02595                            <span class="keywordtype">char</span>         *<a class="code" href="_a_d_f__internals_8h.html#c154821551187a5c4453f40f890711d4">creation_date</a>,
<a name="l02596"></a>02596                            <span class="keywordtype">char</span>         *<a class="code" href="_a_d_f__internals_8h.html#ceb16314751539371ec701aa90bbf4b4">modification_date</a>,
<a name="l02597"></a>02597                            <span class="keywordtype">int</span>          *err)
<a name="l02598"></a>02598 {
<a name="l02599"></a>02599   <span class="keywordtype">char</span> buff[<a class="code" href="_a_d_f_8h.html#8f189c9385b81a9ba752840c0debdde1">ADF_VERSION_LENGTH</a>+1];
<a name="l02600"></a>02600   <span class="keywordtype">char</span> node[<a class="code" href="_a_d_f_8h.html#f11d7221f1ac4a2989d680daffc3afd1">ADF_NAME_LENGTH</a>+1];
<a name="l02601"></a>02601   hid_t did;
<a name="l02602"></a>02602   herr_t status;
<a name="l02603"></a>02603 
<a name="l02604"></a>02604   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Database_Version"</span>));
<a name="l02605"></a>02605 
<a name="l02606"></a>02606   <span class="keywordflow">if</span> (version == NULL) {
<a name="l02607"></a>02607     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>, err);
<a name="l02608"></a>02608     <span class="keywordflow">return</span>;
<a name="l02609"></a>02609   }
<a name="l02610"></a>02610   *version = 0;
<a name="l02611"></a>02611   <span class="keywordflow">if</span> (creation_date != NULL) *creation_date = 0;
<a name="l02612"></a>02612   <span class="keywordflow">if</span> (modification_date != NULL) *modification_date = 0;
<a name="l02613"></a>02613   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02614"></a>02614 
<a name="l02615"></a>02615   sprintf(node, <span class="stringliteral">"/%s"</span>, <a class="code" href="_a_d_f_h_8c.html#7145efec1802c97ae54f3fb15f3e390f">D_VERSION</a>);
<a name="l02616"></a>02616   <span class="keywordflow">if</span> ((did = H5Dopen2(<a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(root_id), node, H5P_DEFAULT)) &lt; 0) {
<a name="l02617"></a>02617 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l02618"></a>02618 <span class="preprocessor"></span>    sprintf(node, <span class="stringliteral">"/%s"</span>, <a class="code" href="_a_d_f_h_8c.html#57dfd3d0f62d275caca74daa635cfda9">D_OLDVERS</a>);
<a name="l02619"></a>02619     <span class="keywordflow">if</span> ((did = H5Dopen2(<a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(root_id), node, H5P_DEFAULT)) &lt; 0) {
<a name="l02620"></a>02620       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d5353af9a9320cb5b2e6847575d57242">ADFH_ERR_DOPEN</a>, err);
<a name="l02621"></a>02621       <span class="keywordflow">return</span>;
<a name="l02622"></a>02622     }
<a name="l02623"></a>02623 <span class="preprocessor">#else</span>
<a name="l02624"></a>02624 <span class="preprocessor"></span>    <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d5353af9a9320cb5b2e6847575d57242">ADFH_ERR_DOPEN</a>, err);
<a name="l02625"></a>02625     <span class="keywordflow">return</span>;
<a name="l02626"></a>02626 <span class="preprocessor">#endif</span>
<a name="l02627"></a>02627 <span class="preprocessor"></span>  }
<a name="l02628"></a>02628   status = H5Dread(did, H5T_NATIVE_CHAR, H5S_ALL, H5S_ALL, H5P_DEFAULT, buff);
<a name="l02629"></a>02629   H5Dclose(did);
<a name="l02630"></a>02630 
<a name="l02631"></a>02631   <span class="keywordflow">if</span> (status &lt; 0)
<a name="l02632"></a>02632     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#2fecb63aadd6d46ba3395d86f04f9745">ADFH_ERR_DREAD</a>, err);
<a name="l02633"></a>02633   <span class="keywordflow">else</span>
<a name="l02634"></a>02634     strcpy(version, buff);
<a name="l02635"></a>02635 }
<a name="l02636"></a>02636 
<a name="l02637"></a>02637 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02638"></a>02638 
<a name="l02639"></a><a class="code" href="_a_d_f_h_8h.html#2937def10f024ea99afd4fe48daf4cbf">02639</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#662d4a7d1a8888dbf78985d63a180b95">ADFH_Library_Version</a>(<span class="keywordtype">char</span> *<a class="code" href="_a_d_f__internals_8h.html#db89ae0fa05e5926a3cdb67f1c28539c">version</a>,
<a name="l02640"></a>02640                           <span class="keywordtype">int</span>  *err)
<a name="l02641"></a>02641 {
<a name="l02642"></a>02642   <span class="keywordtype">unsigned</span> maj, min, rel;
<a name="l02643"></a>02643 
<a name="l02644"></a>02644   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Library_Version"</span>));
<a name="l02645"></a>02645 
<a name="l02646"></a>02646   <span class="keywordflow">if</span> (version == NULL) {
<a name="l02647"></a>02647     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#aff251ae5a16c5fcd532ce4801f248ed">NULL_STRING_POINTER</a>, err);
<a name="l02648"></a>02648     <span class="keywordflow">return</span>;
<a name="l02649"></a>02649   }
<a name="l02650"></a>02650   H5get_libversion(&amp;maj, &amp;min, &amp;rel);
<a name="l02651"></a>02651   sprintf(version, <span class="stringliteral">"HDF5 Version %d.%d.%d"</span>, maj, min, rel);
<a name="l02652"></a>02652   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02653"></a>02653 }
<a name="l02654"></a>02654 
<a name="l02655"></a>02655 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02656"></a>02656 
<a name="l02657"></a><a class="code" href="_a_d_f_h_8h.html#70b98c684b5e39598789a89692447693">02657</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#c229ed567ccdbbc2d7d3606e639b9ce0">ADFH_Set_Error_State</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>  error_state,
<a name="l02658"></a>02658                           <span class="keywordtype">int</span>       *<a class="code" href="_a_d_f__internals_8h.html#16f56645e179b46d8be2e5874b3f73a9">error_return</a>)
<a name="l02659"></a>02659 {
<a name="l02660"></a>02660   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Set_Error_State"</span>));
<a name="l02661"></a>02661 
<a name="l02662"></a>02662   <a class="code" href="_a_d_f_h_8c.html#8c14d72149efef586123816eb46243b0">ROOT_OR_DIE</a>(error_return);
<a name="l02663"></a>02663   mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#aef892c12b8d134d4574c34a74aa267a">g_error_state</a> = error_state;
<a name="l02664"></a>02664   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, error_return);
<a name="l02665"></a>02665 }
<a name="l02666"></a>02666 
<a name="l02667"></a>02667 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02668"></a>02668 
<a name="l02669"></a><a class="code" href="_a_d_f_h_8h.html#1a2b7e45c4526a2c0a3ff20b961995bc">02669</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#00a2e1b7e6d3a97787b4c0b9a1a24348">ADFH_Error_Message</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>  error_return_input,
<a name="l02670"></a>02670                         <span class="keywordtype">char</span>      *<a class="code" href="_a_d_f__internals_8h.html#09511fefa2f2a25c1c924124c4d48999">error_string</a> )
<a name="l02671"></a>02671 {
<a name="l02672"></a>02672   <span class="keywordtype">int</span> i;
<a name="l02673"></a>02673 
<a name="l02674"></a>02674   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Error_Message"</span>));
<a name="l02675"></a>02675 
<a name="l02676"></a>02676   <span class="keywordflow">if</span> (error_string == NULL) <span class="keywordflow">return</span>;
<a name="l02677"></a>02677 
<a name="l02678"></a>02678   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="_a_d_f_h_8c.html#8d76228545c2552584055a1e1d1787f3">NUM_ERRORS</a>; i++) {
<a name="l02679"></a>02679     <span class="keywordflow">if</span> (ErrorList[i].errcode == error_return_input) {
<a name="l02680"></a>02680       strcpy(error_string, ErrorList[i].<a class="code" href="write__test_8c.html#2141b8541565b9145c450f46c23fdd31">errmsg</a>);
<a name="l02681"></a>02681       <span class="keywordflow">return</span>;
<a name="l02682"></a>02682     }
<a name="l02683"></a>02683   }
<a name="l02684"></a>02684   sprintf(error_string, <span class="stringliteral">"error number %d"</span>, error_return_input);
<a name="l02685"></a>02685 }
<a name="l02686"></a>02686 
<a name="l02687"></a>02687 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02688"></a>02688 
<a name="l02689"></a><a class="code" href="_a_d_f_h_8h.html#b81059637824c28e15451d99e6392bed">02689</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#320f5303237bb1c258f53808e070494d">ADFH_Get_Error_State</a>(<span class="keywordtype">int</span> *error_state,
<a name="l02690"></a>02690                           <span class="keywordtype">int</span> *<a class="code" href="_a_d_f__internals_8h.html#16f56645e179b46d8be2e5874b3f73a9">error_return</a>)
<a name="l02691"></a>02691 {
<a name="l02692"></a>02692   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Get_Error_State"</span>));
<a name="l02693"></a>02693   <a class="code" href="_a_d_f_h_8c.html#8c14d72149efef586123816eb46243b0">ROOT_OR_DIE</a>(error_return);
<a name="l02694"></a>02694   *error_state = mta_root-&gt;<a class="code" href="struct___a_d_f_h___m_t_a.html#aef892c12b8d134d4574c34a74aa267a">g_error_state</a>;
<a name="l02695"></a>02695   <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, error_return);
<a name="l02696"></a>02696 }
<a name="l02697"></a>02697 
<a name="l02698"></a>02698 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02699"></a>02699 
<a name="l02700"></a><a class="code" href="_a_d_f_h_8h.html#d304c6f6eb5c0bc34ed65ac49b10f375">02700</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#72f89819b5e697d3cc604315dcd3fcb9">ADFH_Read_Block_Data</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_a_d_f__internals_8h.html#fed82a4a7802f4fe37c24e3092468b96">ID</a>,
<a name="l02701"></a>02701                       <span class="keyword">const</span> <span class="keywordtype">long</span> <a class="code" href="_a_d_f__internals_8h.html#e77992e828f6003ae14840c5fa76129a">b_start</a>,
<a name="l02702"></a>02702                       <span class="keyword">const</span> <span class="keywordtype">long</span> <a class="code" href="_a_d_f__internals_8h.html#5ead2e552e2ac547a55b457d5897ccc5">b_end</a>,
<a name="l02703"></a>02703                       <span class="keywordtype">char</span> *data,
<a name="l02704"></a>02704                       <span class="keywordtype">int</span> *err )
<a name="l02705"></a>02705 {
<a name="l02706"></a>02706   hid_t hid, did, mid, tid, dspace;
<a name="l02707"></a>02707   <span class="keywordtype">size_t</span> size, count, offset;
<a name="l02708"></a>02708   <span class="keywordtype">char</span> *buff;
<a name="l02709"></a>02709 
<a name="l02710"></a>02710   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Read_Block_Data"</span>));
<a name="l02711"></a>02711 
<a name="l02712"></a>02712   <span class="keywordflow">if</span> (data == NULL) {
<a name="l02713"></a>02713     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#b35fccb34c6d5687da3115b8de46cc8c">NULL_POINTER</a>, err);
<a name="l02714"></a>02714     <span class="keywordflow">return</span>;
<a name="l02715"></a>02715   }
<a name="l02716"></a>02716   <span class="keywordflow">if</span> (b_start &gt; b_end) {
<a name="l02717"></a>02717     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#94a0cdb0fd0e777a6be3487d0ad4ca88">MINIMUM_GT_MAXIMUM</a>, err);
<a name="l02718"></a>02718     <span class="keywordflow">return</span>;
<a name="l02719"></a>02719   }
<a name="l02720"></a>02720   <span class="keywordflow">if</span> (b_start &lt; 1) {
<a name="l02721"></a>02721     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#252d99de90a432d334fb5595317c600c">START_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l02722"></a>02722     <span class="keywordflow">return</span>;
<a name="l02723"></a>02723   }
<a name="l02724"></a>02724   <span class="keywordflow">if</span> ((hid = open_node(ID, err)) &lt; 0) <span class="keywordflow">return</span>;
<a name="l02725"></a>02725 
<a name="l02726"></a>02726   <span class="keywordflow">if</span> (!<a class="code" href="_a_d_f_h_8c.html#d05c7d5eb688634c398c562af1fb8680">has_data</a>(hid)) {
<a name="l02727"></a>02727     H5Gclose(hid);
<a name="l02728"></a>02728     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#68de9030c39965958f08402f7d452ad9">NO_DATA</a>, err);
<a name="l02729"></a>02729     <span class="keywordflow">return</span>;
<a name="l02730"></a>02730   }
<a name="l02731"></a>02731   <span class="keywordflow">if</span> ((did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, H5P_DEFAULT)) &lt; 0) {
<a name="l02732"></a>02732     H5Gclose(hid);
<a name="l02733"></a>02733     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d5353af9a9320cb5b2e6847575d57242">ADFH_ERR_DOPEN</a>, err);
<a name="l02734"></a>02734     <span class="keywordflow">return</span>;
<a name="l02735"></a>02735   }
<a name="l02736"></a>02736 
<a name="l02737"></a>02737   dspace = H5Dget_space(did);
<a name="l02738"></a>02738   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(dspace);
<a name="l02739"></a>02739   count = (size_t)H5Sget_simple_extent_npoints(dspace);
<a name="l02740"></a>02740   H5Sclose(dspace);
<a name="l02741"></a>02741 
<a name="l02742"></a>02742   <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)b_end &gt; count) {
<a name="l02743"></a>02743     H5Dclose(did);
<a name="l02744"></a>02744     H5Gclose(hid);
<a name="l02745"></a>02745     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#6b35a23a07baf407380c2180959891cf">END_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l02746"></a>02746     <span class="keywordflow">return</span>;
<a name="l02747"></a>02747   }
<a name="l02748"></a>02748 
<a name="l02749"></a>02749   <span class="comment">/* instead of trying to compute data space extents from</span>
<a name="l02750"></a>02750 <span class="comment">   * b_start and b_end, just read all the data into a</span>
<a name="l02751"></a>02751 <span class="comment">   * 1-d array and copy the range we want */</span>
<a name="l02752"></a>02752 
<a name="l02753"></a>02753   tid = H5Dget_type(did);
<a name="l02754"></a>02754   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(tid);
<a name="l02755"></a>02755   mid = H5Tget_native_type(tid, H5T_DIR_ASCEND);
<a name="l02756"></a>02756   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(mid);
<a name="l02757"></a>02757   size = H5Tget_size(mid);
<a name="l02758"></a>02758 
<a name="l02759"></a>02759   <span class="keywordflow">if</span> ((buff = (<span class="keywordtype">char</span> *) <a class="code" href="cg__malloc_8h.html#535b58ab5aa48e2e86073e334d43fd32">malloc</a> (size * count)) == NULL) {
<a name="l02760"></a>02760     H5Tclose(mid);
<a name="l02761"></a>02761     H5Tclose(tid);
<a name="l02762"></a>02762     H5Dclose(did);
<a name="l02763"></a>02763     H5Gclose(hid);
<a name="l02764"></a>02764     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#996254e4d79ab38ec4eb8d81b44804b8">MEMORY_ALLOCATION_FAILED</a>, err);
<a name="l02765"></a>02765     <span class="keywordflow">return</span>;
<a name="l02766"></a>02766   }
<a name="l02767"></a>02767 
<a name="l02768"></a>02768   <span class="keywordflow">if</span> (H5Dread(did, mid, H5S_ALL, H5S_ALL, H5P_DEFAULT, buff) &lt; 0)
<a name="l02769"></a>02769     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#2fecb63aadd6d46ba3395d86f04f9745">ADFH_ERR_DREAD</a>, err);
<a name="l02770"></a>02770   <span class="keywordflow">else</span> {
<a name="l02771"></a>02771     offset = size * (b_start - 1);
<a name="l02772"></a>02772     count = size * (b_end - b_start + 1);
<a name="l02773"></a>02773     memcpy(data, &amp;buff[offset], count);
<a name="l02774"></a>02774     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02775"></a>02775   }
<a name="l02776"></a>02776 
<a name="l02777"></a>02777   <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a> (buff);
<a name="l02778"></a>02778   H5Tclose(mid);
<a name="l02779"></a>02779   H5Tclose(tid);
<a name="l02780"></a>02780   H5Dclose(did);
<a name="l02781"></a>02781   H5Gclose(hid);
<a name="l02782"></a>02782 }
<a name="l02783"></a>02783 
<a name="l02784"></a>02784 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02785"></a>02785 
<a name="l02786"></a><a class="code" href="_a_d_f_h_8h.html#2abe2021eeaf492ae33382088cfc9ee6">02786</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#adebc5915a0f277e7c73f4b6a293eaa5">ADFH_Read_Data</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_a_d_f__internals_8h.html#fed82a4a7802f4fe37c24e3092468b96">ID</a>,
<a name="l02787"></a>02787                      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#dab8f2792c5ca0bc669eb64639868281">s_start</a>[],
<a name="l02788"></a>02788                      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#2013dee6d0971a916458a440d960656b">s_end</a>[],
<a name="l02789"></a>02789                      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#a77115d3d64e5d2a4cd9b74a0e803821">s_stride</a>[],
<a name="l02790"></a>02790                      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#96162db572708372c76b7d4fef2ad1ec">m_num_dims</a>,
<a name="l02791"></a>02791                      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#a584c72cd75120ff8bc40539b0486257">m_dims</a>[],
<a name="l02792"></a>02792                      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#999e0a81005b29035820e1fa954e3e20">m_start</a>[],
<a name="l02793"></a>02793                      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#d6d877f4601bbd9ff50ceea04171651f">m_end</a>[],
<a name="l02794"></a>02794                      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#9cf8e7efda0b44d105a709ad201d6cc4">m_stride</a>[],
<a name="l02795"></a>02795                      <span class="keywordtype">char</span> *data,
<a name="l02796"></a>02796                      <span class="keywordtype">int</span> *err )
<a name="l02797"></a>02797 {
<a name="l02798"></a>02798   <span class="keywordtype">int</span> n, ndim;
<a name="l02799"></a>02799   hid_t hid, did, mid, tid, dspace, mspace;
<a name="l02800"></a>02800   hsize_t dims[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l02801"></a>02801   hsize_t start[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l02802"></a>02802   hsize_t stride[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l02803"></a>02803   hsize_t count[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l02804"></a>02804   herr_t status;
<a name="l02805"></a>02805 
<a name="l02806"></a>02806   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Read_Data"</span>));
<a name="l02807"></a>02807 
<a name="l02808"></a>02808   <span class="keywordflow">if</span> ((hid = open_node(ID, err)) &lt; 0) <span class="keywordflow">return</span>;
<a name="l02809"></a>02809 
<a name="l02810"></a>02810   <span class="keywordflow">if</span> (!<a class="code" href="_a_d_f_h_8c.html#d05c7d5eb688634c398c562af1fb8680">has_data</a>(hid)) {
<a name="l02811"></a>02811     H5Gclose(hid);
<a name="l02812"></a>02812     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#68de9030c39965958f08402f7d452ad9">NO_DATA</a>, err);
<a name="l02813"></a>02813     <span class="keywordflow">return</span>;
<a name="l02814"></a>02814   }
<a name="l02815"></a>02815   <span class="keywordflow">if</span> ((did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, H5P_DEFAULT)) &lt; 0) {
<a name="l02816"></a>02816     H5Gclose(hid);
<a name="l02817"></a>02817     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d5353af9a9320cb5b2e6847575d57242">ADFH_ERR_DOPEN</a>, err);
<a name="l02818"></a>02818     <span class="keywordflow">return</span>;
<a name="l02819"></a>02819   }
<a name="l02820"></a>02820 
<a name="l02821"></a>02821   <span class="comment">/* get data space extents */</span>
<a name="l02822"></a>02822 
<a name="l02823"></a>02823   dspace = H5Dget_space(did);
<a name="l02824"></a>02824   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(dspace);
<a name="l02825"></a>02825   ndim = H5Sget_simple_extent_ndims(dspace);
<a name="l02826"></a>02826   H5Sget_simple_extent_dims(dspace, dims, NULL);
<a name="l02827"></a>02827 
<a name="l02828"></a>02828   <span class="comment">/* create data hyperslab */</span>
<a name="l02829"></a>02829 
<a name="l02830"></a>02830 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l02831"></a>02831 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (ndim &gt; 1 &amp;&amp; !swap_dimensions(hid)) {
<a name="l02832"></a>02832       H5Sclose(dspace);
<a name="l02833"></a>02833       H5Dclose(did);
<a name="l02834"></a>02834       H5Gclose(hid);
<a name="l02835"></a>02835       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#8a4c1a288f543991661f4d4b19fda550">ADFH_ERR_NEED_TRANSPOSE</a>, err);
<a name="l02836"></a>02836       <span class="keywordflow">return</span>;
<a name="l02837"></a>02837   }
<a name="l02838"></a>02838 <span class="preprocessor">#endif</span>
<a name="l02839"></a>02839 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (n = 0; n &lt; ndim; n++) {
<a name="l02840"></a>02840     <span class="keywordflow">if</span> (s_start[n] &lt; 1)
<a name="l02841"></a>02841       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#252d99de90a432d334fb5595317c600c">START_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l02842"></a>02842 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l02843"></a>02843 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((hsize_t)s_end[n] &gt; dims[ndim-1-n])
<a name="l02844"></a>02844 <span class="preprocessor">#else</span>
<a name="l02845"></a>02845 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((hsize_t)s_end[n] &gt; dims[n])
<a name="l02846"></a>02846 <span class="preprocessor">#endif</span>
<a name="l02847"></a>02847 <span class="preprocessor"></span>      <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#6b35a23a07baf407380c2180959891cf">END_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l02848"></a>02848     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s_start[n] &gt; s_end[n])
<a name="l02849"></a>02849       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#94a0cdb0fd0e777a6be3487d0ad4ca88">MINIMUM_GT_MAXIMUM</a>, err);
<a name="l02850"></a>02850     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s_stride[n] &lt; 1 ||
<a name="l02851"></a>02851       s_stride[n] &gt; (s_end[n] - s_start[n] + 1))
<a name="l02852"></a>02852       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#0cffd9ee2b45ae3b288f7cf67ce5152a">BAD_STRIDE_VALUE</a>, err);
<a name="l02853"></a>02853     <span class="keywordflow">else</span>
<a name="l02854"></a>02854       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02855"></a>02855     <span class="keywordflow">if</span> (*err != <a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>) {
<a name="l02856"></a>02856       H5Sclose(dspace);
<a name="l02857"></a>02857       H5Dclose(did);
<a name="l02858"></a>02858       H5Gclose(hid);
<a name="l02859"></a>02859       <span class="keywordflow">return</span>;
<a name="l02860"></a>02860     }
<a name="l02861"></a>02861 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l02862"></a>02862 <span class="preprocessor"></span>    start[ndim-1-n] = s_start[n] - 1;
<a name="l02863"></a>02863     stride[ndim-1-n] = s_stride[n];
<a name="l02864"></a>02864     count[ndim-1-n] = (s_end[n] - s_start[n] + 1) / s_stride[n];
<a name="l02865"></a>02865 <span class="preprocessor">#else</span>
<a name="l02866"></a>02866 <span class="preprocessor"></span>    start[n] = s_start[n] - 1;
<a name="l02867"></a>02867     stride[n] = s_stride[n];
<a name="l02868"></a>02868     count[n] = (s_end[n] - s_start[n] + 1) / s_stride[n];
<a name="l02869"></a>02869 <span class="preprocessor">#endif</span>
<a name="l02870"></a>02870 <span class="preprocessor"></span>  }
<a name="l02871"></a>02871 
<a name="l02872"></a>02872   H5Sselect_hyperslab(dspace, H5S_SELECT_SET, start, stride, count, NULL);
<a name="l02873"></a>02873 
<a name="l02874"></a>02874   <span class="comment">/* create memory hyperslab */</span>
<a name="l02875"></a>02875 
<a name="l02876"></a>02876   <span class="keywordflow">for</span> (n = 0; n &lt; m_num_dims; n++) {
<a name="l02877"></a>02877     <span class="keywordflow">if</span> (m_start[n] &lt; 1)
<a name="l02878"></a>02878       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#252d99de90a432d334fb5595317c600c">START_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l02879"></a>02879     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_end[n] &gt; m_dims[n])
<a name="l02880"></a>02880       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#6b35a23a07baf407380c2180959891cf">END_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l02881"></a>02881     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_start[n] &gt; m_end[n])
<a name="l02882"></a>02882       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#94a0cdb0fd0e777a6be3487d0ad4ca88">MINIMUM_GT_MAXIMUM</a>, err);
<a name="l02883"></a>02883     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_stride[n] &lt; 1 ||
<a name="l02884"></a>02884       m_stride[n] &gt; (m_end[n] - m_start[n] + 1))
<a name="l02885"></a>02885       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#0cffd9ee2b45ae3b288f7cf67ce5152a">BAD_STRIDE_VALUE</a>, err);
<a name="l02886"></a>02886     <span class="keywordflow">else</span>
<a name="l02887"></a>02887       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02888"></a>02888     <span class="keywordflow">if</span> (*err != <a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>) {
<a name="l02889"></a>02889       H5Sclose(dspace);
<a name="l02890"></a>02890       H5Dclose(did);
<a name="l02891"></a>02891       H5Gclose(hid);
<a name="l02892"></a>02892       <span class="keywordflow">return</span>;
<a name="l02893"></a>02893     }
<a name="l02894"></a>02894 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l02895"></a>02895 <span class="preprocessor"></span>    dims[m_num_dims-1-n] = m_dims[n];
<a name="l02896"></a>02896     start[m_num_dims-1-n] = m_start[n] - 1;
<a name="l02897"></a>02897     stride[m_num_dims-1-n] = m_stride[n];
<a name="l02898"></a>02898     count[m_num_dims-1-n] = (m_end[n] - m_start[n] + 1) / m_stride[n];
<a name="l02899"></a>02899 <span class="preprocessor">#else</span>
<a name="l02900"></a>02900 <span class="preprocessor"></span>    dims[n] = m_dims[n];
<a name="l02901"></a>02901     start[n] = m_start[n] - 1;
<a name="l02902"></a>02902     stride[n] = m_stride[n];
<a name="l02903"></a>02903     count[n] = (m_end[n] - m_start[n] + 1) / m_stride[n];
<a name="l02904"></a>02904 <span class="preprocessor">#endif</span>
<a name="l02905"></a>02905 <span class="preprocessor"></span>  }
<a name="l02906"></a>02906 
<a name="l02907"></a>02907   mspace = H5Screate_simple(m_num_dims, dims, NULL);
<a name="l02908"></a>02908   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(mspace);
<a name="l02909"></a>02909 
<a name="l02910"></a>02910   H5Sselect_hyperslab(mspace, H5S_SELECT_SET, start, stride, count, NULL);
<a name="l02911"></a>02911 
<a name="l02912"></a>02912   <span class="keywordflow">if</span> (H5Sget_select_npoints(mspace) != H5Sget_select_npoints(dspace)) {
<a name="l02913"></a>02913       H5Sclose(mspace);
<a name="l02914"></a>02914       H5Sclose(dspace);
<a name="l02915"></a>02915       H5Dclose(did);
<a name="l02916"></a>02916       H5Gclose(hid);
<a name="l02917"></a>02917       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#e97b258b9c94100d89b8885ec63715d0">UNEQUAL_MEMORY_AND_DISK_DIMS</a>, err);
<a name="l02918"></a>02918       <span class="keywordflow">return</span>;
<a name="l02919"></a>02919   }
<a name="l02920"></a>02920 
<a name="l02921"></a>02921   <span class="comment">/* read the data */</span>
<a name="l02922"></a>02922 
<a name="l02923"></a>02923   tid = H5Dget_type(did);
<a name="l02924"></a>02924   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(tid);
<a name="l02925"></a>02925   mid = H5Tget_native_type(tid, H5T_DIR_ASCEND);
<a name="l02926"></a>02926   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(mid);
<a name="l02927"></a>02927   status = H5Dread(did, mid, mspace, dspace, H5P_DEFAULT, data);
<a name="l02928"></a>02928 
<a name="l02929"></a>02929   H5Sclose(mspace);
<a name="l02930"></a>02930   H5Sclose(dspace);
<a name="l02931"></a>02931   H5Tclose(mid);
<a name="l02932"></a>02932   H5Tclose(tid);
<a name="l02933"></a>02933   H5Dclose(did);
<a name="l02934"></a>02934   H5Gclose(hid);
<a name="l02935"></a>02935 
<a name="l02936"></a>02936   <span class="keywordflow">if</span> (status &lt; 0)
<a name="l02937"></a>02937     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#2fecb63aadd6d46ba3395d86f04f9745">ADFH_ERR_DREAD</a>, err);
<a name="l02938"></a>02938   <span class="keywordflow">else</span>
<a name="l02939"></a>02939     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02940"></a>02940 }
<a name="l02941"></a>02941 
<a name="l02942"></a>02942 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02943"></a>02943 
<a name="l02944"></a><a class="code" href="_a_d_f_h_8h.html#184be7ef6a4e73f0d37c59fbcef2d4c9">02944</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#8f26085a976ffa9e9e8c6f54c0bb8119">ADFH_Read_All_Data</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l02945"></a>02945                         <span class="keywordtype">char</span>         *data,
<a name="l02946"></a>02946                         <span class="keywordtype">int</span>          *err)
<a name="l02947"></a>02947 {
<a name="l02948"></a>02948   hid_t hid, did, tid, mid;
<a name="l02949"></a>02949   herr_t status;
<a name="l02950"></a>02950 
<a name="l02951"></a>02951   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Read_All_Data"</span>));
<a name="l02952"></a>02952 
<a name="l02953"></a>02953   <span class="keywordflow">if</span> ((hid = open_node(<span class="keywordtype">id</span>, err)) &lt; 0) <span class="keywordflow">return</span>;
<a name="l02954"></a>02954 
<a name="l02955"></a>02955   <span class="keywordflow">if</span> (<a class="code" href="_a_d_f_h_8c.html#d05c7d5eb688634c398c562af1fb8680">has_data</a>(hid)) {
<a name="l02956"></a>02956     did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, H5P_DEFAULT);
<a name="l02957"></a>02957     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(did);
<a name="l02958"></a>02958     tid = H5Dget_type(did);
<a name="l02959"></a>02959     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(tid);
<a name="l02960"></a>02960     mid = H5Tget_native_type(tid, H5T_DIR_ASCEND);
<a name="l02961"></a>02961     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(mid);
<a name="l02962"></a>02962 
<a name="l02963"></a>02963     <span class="keywordflow">if</span> (H5Dread(did, mid, H5S_ALL, H5S_ALL, H5P_DEFAULT, data) &lt; 0)
<a name="l02964"></a>02964       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#2fecb63aadd6d46ba3395d86f04f9745">ADFH_ERR_DREAD</a>, err);
<a name="l02965"></a>02965     <span class="keywordflow">else</span>
<a name="l02966"></a>02966       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l02967"></a>02967 
<a name="l02968"></a>02968     H5Tclose(mid);
<a name="l02969"></a>02969     H5Tclose(tid);
<a name="l02970"></a>02970     H5Dclose(did);
<a name="l02971"></a>02971   }
<a name="l02972"></a>02972   <span class="keywordflow">else</span>
<a name="l02973"></a>02973     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#68de9030c39965958f08402f7d452ad9">NO_DATA</a>, err);
<a name="l02974"></a>02974   H5Gclose(hid);
<a name="l02975"></a>02975 }
<a name="l02976"></a>02976 
<a name="l02977"></a>02977 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l02978"></a>02978 
<a name="l02979"></a><a class="code" href="_a_d_f_h_8h.html#099e710939ff0dcce8648645455cb793">02979</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#50a70703caffcc08d872276f79b52345">ADFH_Write_Block_Data</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_a_d_f__internals_8h.html#fed82a4a7802f4fe37c24e3092468b96">ID</a>,
<a name="l02980"></a>02980                             <span class="keyword">const</span> <span class="keywordtype">long</span> <a class="code" href="_a_d_f__internals_8h.html#e77992e828f6003ae14840c5fa76129a">b_start</a>,
<a name="l02981"></a>02981                             <span class="keyword">const</span> <span class="keywordtype">long</span> <a class="code" href="_a_d_f__internals_8h.html#5ead2e552e2ac547a55b457d5897ccc5">b_end</a>,
<a name="l02982"></a>02982                             <span class="keywordtype">char</span> *data,
<a name="l02983"></a>02983                             <span class="keywordtype">int</span> *err )
<a name="l02984"></a>02984 {
<a name="l02985"></a>02985   hid_t hid, did, mid, tid, dspace;
<a name="l02986"></a>02986   <span class="keywordtype">size_t</span> size, count, offset;
<a name="l02987"></a>02987   <span class="keywordtype">char</span> *buff;
<a name="l02988"></a>02988 
<a name="l02989"></a>02989   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Write_Block_Data"</span>));
<a name="l02990"></a>02990 
<a name="l02991"></a>02991   <span class="keywordflow">if</span> (data == NULL) {
<a name="l02992"></a>02992     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#b35fccb34c6d5687da3115b8de46cc8c">NULL_POINTER</a>, err);
<a name="l02993"></a>02993     <span class="keywordflow">return</span>;
<a name="l02994"></a>02994   }
<a name="l02995"></a>02995   <span class="keywordflow">if</span> (b_start &gt; b_end) {
<a name="l02996"></a>02996     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#94a0cdb0fd0e777a6be3487d0ad4ca88">MINIMUM_GT_MAXIMUM</a>, err);
<a name="l02997"></a>02997     <span class="keywordflow">return</span>;
<a name="l02998"></a>02998   }
<a name="l02999"></a>02999   <span class="keywordflow">if</span> (b_start &lt; 1) {
<a name="l03000"></a>03000     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#252d99de90a432d334fb5595317c600c">START_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l03001"></a>03001     <span class="keywordflow">return</span>;
<a name="l03002"></a>03002   }
<a name="l03003"></a>03003   hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(ID);
<a name="l03004"></a>03004   <span class="keywordflow">if</span> (is_link(hid)) {
<a name="l03005"></a>03005     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#0e83ca5faed8218096517883dfbe6f78">ADFH_ERR_LINK_DATA</a>, err);
<a name="l03006"></a>03006     <span class="keywordflow">return</span>;
<a name="l03007"></a>03007   }
<a name="l03008"></a>03008   <span class="keywordflow">if</span> (!<a class="code" href="_a_d_f_h_8c.html#d05c7d5eb688634c398c562af1fb8680">has_data</a>(hid)) {
<a name="l03009"></a>03009     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#68de9030c39965958f08402f7d452ad9">NO_DATA</a>, err);
<a name="l03010"></a>03010     <span class="keywordflow">return</span>;
<a name="l03011"></a>03011   }
<a name="l03012"></a>03012   <span class="keywordflow">if</span> ((did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, H5P_DEFAULT)) &lt; 0) {
<a name="l03013"></a>03013     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d5353af9a9320cb5b2e6847575d57242">ADFH_ERR_DOPEN</a>, err);
<a name="l03014"></a>03014     <span class="keywordflow">return</span>;
<a name="l03015"></a>03015   }
<a name="l03016"></a>03016 
<a name="l03017"></a>03017   dspace = H5Dget_space(did);
<a name="l03018"></a>03018   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(dspace);
<a name="l03019"></a>03019   count = (size_t)H5Sget_simple_extent_npoints(dspace);
<a name="l03020"></a>03020   H5Sclose(dspace);
<a name="l03021"></a>03021 
<a name="l03022"></a>03022   <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)b_end &gt; count) {
<a name="l03023"></a>03023     H5Dclose(did);
<a name="l03024"></a>03024     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#6b35a23a07baf407380c2180959891cf">END_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l03025"></a>03025     <span class="keywordflow">return</span>;
<a name="l03026"></a>03026   }
<a name="l03027"></a>03027 
<a name="l03028"></a>03028   <span class="comment">/* instead of trying to compute data space extents from</span>
<a name="l03029"></a>03029 <span class="comment">   * b_start and b_end, just read all the data into a</span>
<a name="l03030"></a>03030 <span class="comment">   * 1-d array, copy the range we want and rewrite the data */</span>
<a name="l03031"></a>03031 
<a name="l03032"></a>03032   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(did);
<a name="l03033"></a>03033   tid = H5Dget_type(did);
<a name="l03034"></a>03034   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(tid);
<a name="l03035"></a>03035   mid = H5Tget_native_type(tid, H5T_DIR_ASCEND);
<a name="l03036"></a>03036   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(mid);
<a name="l03037"></a>03037   size = H5Tget_size(mid);
<a name="l03038"></a>03038 
<a name="l03039"></a>03039   <span class="keywordflow">if</span> ((buff = (<span class="keywordtype">char</span> *) <a class="code" href="cg__malloc_8h.html#535b58ab5aa48e2e86073e334d43fd32">malloc</a> (size * count)) == NULL) {
<a name="l03040"></a>03040     H5Tclose(mid);
<a name="l03041"></a>03041     H5Tclose(tid);
<a name="l03042"></a>03042     H5Dclose(did);
<a name="l03043"></a>03043     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#996254e4d79ab38ec4eb8d81b44804b8">MEMORY_ALLOCATION_FAILED</a>, err);
<a name="l03044"></a>03044     <span class="keywordflow">return</span>;
<a name="l03045"></a>03045   }
<a name="l03046"></a>03046 
<a name="l03047"></a>03047   <span class="keywordflow">if</span> (H5Dread(did, mid, H5S_ALL, H5S_ALL, H5P_DEFAULT, buff) &lt; 0)
<a name="l03048"></a>03048     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#2fecb63aadd6d46ba3395d86f04f9745">ADFH_ERR_DREAD</a>, err);
<a name="l03049"></a>03049   <span class="keywordflow">else</span> {
<a name="l03050"></a>03050     offset = size * (b_start - 1);
<a name="l03051"></a>03051     count = size * (b_end - b_start + 1);
<a name="l03052"></a>03052     memcpy(&amp;buff[offset], data, count);
<a name="l03053"></a>03053     <span class="keywordflow">if</span> (H5Dwrite(did, mid, H5S_ALL, H5S_ALL, H5P_DEFAULT, buff) &lt; 0)
<a name="l03054"></a>03054       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#5e8ecab15f74022e5350cf299562648b">ADFH_ERR_DWRITE</a>, err);
<a name="l03055"></a>03055     <span class="keywordflow">else</span>
<a name="l03056"></a>03056       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l03057"></a>03057   }
<a name="l03058"></a>03058 
<a name="l03059"></a>03059   <a class="code" href="cg__malloc_8h.html#a7943e5d135734f6801bebcc37401fc0">free</a> (buff);
<a name="l03060"></a>03060   H5Tclose(mid);
<a name="l03061"></a>03061   H5Tclose(tid);
<a name="l03062"></a>03062   H5Dclose(did);
<a name="l03063"></a>03063 }
<a name="l03064"></a>03064 
<a name="l03065"></a>03065 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l03066"></a>03066 
<a name="l03067"></a><a class="code" href="_a_d_f_h_8h.html#09d085b9bf80b7002aabae037338ed5d">03067</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#0f09f7b9bac8f532add125aaa962e55b">ADFH_Write_Data</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_a_d_f__internals_8h.html#fed82a4a7802f4fe37c24e3092468b96">ID</a>,
<a name="l03068"></a>03068                       <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#dab8f2792c5ca0bc669eb64639868281">s_start</a>[],
<a name="l03069"></a>03069                       <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#2013dee6d0971a916458a440d960656b">s_end</a>[],
<a name="l03070"></a>03070                       <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#a77115d3d64e5d2a4cd9b74a0e803821">s_stride</a>[],
<a name="l03071"></a>03071                       <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#96162db572708372c76b7d4fef2ad1ec">m_num_dims</a>,
<a name="l03072"></a>03072                       <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#a584c72cd75120ff8bc40539b0486257">m_dims</a>[],
<a name="l03073"></a>03073                       <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#999e0a81005b29035820e1fa954e3e20">m_start</a>[],
<a name="l03074"></a>03074                       <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#d6d877f4601bbd9ff50ceea04171651f">m_end</a>[],
<a name="l03075"></a>03075                       <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="_a_d_f__internals_8h.html#9cf8e7efda0b44d105a709ad201d6cc4">m_stride</a>[],
<a name="l03076"></a>03076                       <span class="keyword">const</span> <span class="keywordtype">char</span> *data,
<a name="l03077"></a>03077                       <span class="keywordtype">int</span> *err )
<a name="l03078"></a>03078 {
<a name="l03079"></a>03079   <span class="keywordtype">int</span> n, ndim;
<a name="l03080"></a>03080   hid_t hid, did, mid, tid, dspace, mspace;
<a name="l03081"></a>03081   hsize_t dims[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l03082"></a>03082   hsize_t start[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l03083"></a>03083   hsize_t stride[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l03084"></a>03084   hsize_t count[<a class="code" href="_a_d_f_8h.html#7d285259dbe7548741074512409187a3">ADF_MAX_DIMENSIONS</a>];
<a name="l03085"></a>03085   herr_t status;
<a name="l03086"></a>03086 
<a name="l03087"></a>03087   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Write_Data"</span>));
<a name="l03088"></a>03088 
<a name="l03089"></a>03089   <span class="keywordflow">if</span> (data == NULL) {
<a name="l03090"></a>03090     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#b35fccb34c6d5687da3115b8de46cc8c">NULL_POINTER</a>, err);
<a name="l03091"></a>03091     <span class="keywordflow">return</span>;
<a name="l03092"></a>03092   }
<a name="l03093"></a>03093   hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(ID);
<a name="l03094"></a>03094   <span class="keywordflow">if</span> (is_link(hid)) {
<a name="l03095"></a>03095     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#0e83ca5faed8218096517883dfbe6f78">ADFH_ERR_LINK_DATA</a>, err);
<a name="l03096"></a>03096     <span class="keywordflow">return</span>;
<a name="l03097"></a>03097   }
<a name="l03098"></a>03098   <span class="keywordflow">if</span> (!<a class="code" href="_a_d_f_h_8c.html#d05c7d5eb688634c398c562af1fb8680">has_data</a>(hid)) {
<a name="l03099"></a>03099     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#68de9030c39965958f08402f7d452ad9">NO_DATA</a>, err);
<a name="l03100"></a>03100     <span class="keywordflow">return</span>;
<a name="l03101"></a>03101   }
<a name="l03102"></a>03102   <span class="keywordflow">if</span> ((did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, H5P_DEFAULT)) &lt; 0) {
<a name="l03103"></a>03103     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#d5353af9a9320cb5b2e6847575d57242">ADFH_ERR_DOPEN</a>, err);
<a name="l03104"></a>03104     <span class="keywordflow">return</span>;
<a name="l03105"></a>03105   }
<a name="l03106"></a>03106 
<a name="l03107"></a>03107   <span class="comment">/* get data space extents */</span>
<a name="l03108"></a>03108 
<a name="l03109"></a>03109   dspace = H5Dget_space(did);
<a name="l03110"></a>03110   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(dspace);
<a name="l03111"></a>03111   ndim = H5Sget_simple_extent_ndims(dspace);
<a name="l03112"></a>03112   H5Sget_simple_extent_dims(dspace, dims, NULL);
<a name="l03113"></a>03113 
<a name="l03114"></a>03114   <span class="comment">/* create data hyperslab */</span>
<a name="l03115"></a>03115 
<a name="l03116"></a>03116 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l03117"></a>03117 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (ndim &gt; 1 &amp;&amp; !swap_dimensions(hid)) {
<a name="l03118"></a>03118       H5Sclose(dspace);
<a name="l03119"></a>03119       H5Dclose(did);
<a name="l03120"></a>03120       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#8a4c1a288f543991661f4d4b19fda550">ADFH_ERR_NEED_TRANSPOSE</a>, err);
<a name="l03121"></a>03121       <span class="keywordflow">return</span>;
<a name="l03122"></a>03122   }
<a name="l03123"></a>03123 <span class="preprocessor">#endif</span>
<a name="l03124"></a>03124 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (n = 0; n &lt; ndim; n++) {
<a name="l03125"></a>03125     <span class="keywordflow">if</span> (s_start[n] &lt; 1)
<a name="l03126"></a>03126       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#252d99de90a432d334fb5595317c600c">START_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l03127"></a>03127 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l03128"></a>03128 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((hsize_t)s_end[n] &gt; dims[ndim-1-n])
<a name="l03129"></a>03129 <span class="preprocessor">#else</span>
<a name="l03130"></a>03130 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((hsize_t)s_end[n] &gt; dims[n])
<a name="l03131"></a>03131 <span class="preprocessor">#endif</span>
<a name="l03132"></a>03132 <span class="preprocessor"></span>      <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#6b35a23a07baf407380c2180959891cf">END_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l03133"></a>03133     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s_start[n] &gt; s_end[n])
<a name="l03134"></a>03134       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#94a0cdb0fd0e777a6be3487d0ad4ca88">MINIMUM_GT_MAXIMUM</a>, err);
<a name="l03135"></a>03135     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s_stride[n] &lt; 1 ||
<a name="l03136"></a>03136       s_stride[n] &gt; (s_end[n] - s_start[n] + 1))
<a name="l03137"></a>03137       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#0cffd9ee2b45ae3b288f7cf67ce5152a">BAD_STRIDE_VALUE</a>, err);
<a name="l03138"></a>03138     <span class="keywordflow">else</span>
<a name="l03139"></a>03139       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l03140"></a>03140     <span class="keywordflow">if</span> (*err != <a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>) {
<a name="l03141"></a>03141       H5Sclose(dspace);
<a name="l03142"></a>03142       H5Dclose(did);
<a name="l03143"></a>03143       <span class="keywordflow">return</span>;
<a name="l03144"></a>03144     }
<a name="l03145"></a>03145 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l03146"></a>03146 <span class="preprocessor"></span>    start[ndim-1-n] = s_start[n] - 1;
<a name="l03147"></a>03147     stride[ndim-1-n] = s_stride[n];
<a name="l03148"></a>03148     count[ndim-1-n] = (s_end[n] - s_start[n] + 1) / s_stride[n];
<a name="l03149"></a>03149 <span class="preprocessor">#else</span>
<a name="l03150"></a>03150 <span class="preprocessor"></span>    start[n] = s_start[n] - 1;
<a name="l03151"></a>03151     stride[n] = s_stride[n];
<a name="l03152"></a>03152     count[n] = (s_end[n] - s_start[n] + 1) / s_stride[n];
<a name="l03153"></a>03153 <span class="preprocessor">#endif</span>
<a name="l03154"></a>03154 <span class="preprocessor"></span>  }
<a name="l03155"></a>03155 
<a name="l03156"></a>03156   H5Sselect_hyperslab(dspace, H5S_SELECT_SET, start, stride, count, NULL);
<a name="l03157"></a>03157 
<a name="l03158"></a>03158   <span class="comment">/* create memory hyperslab */</span>
<a name="l03159"></a>03159 
<a name="l03160"></a>03160   <span class="keywordflow">for</span> (n = 0; n &lt; m_num_dims; n++) {
<a name="l03161"></a>03161     <span class="keywordflow">if</span> (m_start[n] &lt; 1)
<a name="l03162"></a>03162       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#252d99de90a432d334fb5595317c600c">START_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l03163"></a>03163     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_end[n] &gt; m_dims[n])
<a name="l03164"></a>03164       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#6b35a23a07baf407380c2180959891cf">END_OUT_OF_DEFINED_RANGE</a>, err);
<a name="l03165"></a>03165     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_start[n] &gt; m_end[n])
<a name="l03166"></a>03166       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#94a0cdb0fd0e777a6be3487d0ad4ca88">MINIMUM_GT_MAXIMUM</a>, err);
<a name="l03167"></a>03167     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_stride[n] &lt; 1 ||
<a name="l03168"></a>03168       m_stride[n] &gt; (m_end[n] - m_start[n] + 1))
<a name="l03169"></a>03169       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#0cffd9ee2b45ae3b288f7cf67ce5152a">BAD_STRIDE_VALUE</a>, err);
<a name="l03170"></a>03170     <span class="keywordflow">else</span>
<a name="l03171"></a>03171       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l03172"></a>03172     <span class="keywordflow">if</span> (*err != <a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>) {
<a name="l03173"></a>03173       H5Sclose(dspace);
<a name="l03174"></a>03174       H5Dclose(did);
<a name="l03175"></a>03175       <span class="keywordflow">return</span>;
<a name="l03176"></a>03176     }
<a name="l03177"></a>03177 <span class="preprocessor">#ifdef ADFH_FORTRAN_INDEXING</span>
<a name="l03178"></a>03178 <span class="preprocessor"></span>    dims[m_num_dims-1-n] = m_dims[n];
<a name="l03179"></a>03179     start[m_num_dims-1-n] = m_start[n] - 1;
<a name="l03180"></a>03180     stride[m_num_dims-1-n] = m_stride[n];
<a name="l03181"></a>03181     count[m_num_dims-1-n] = (m_end[n] - m_start[n] + 1) / m_stride[n];
<a name="l03182"></a>03182 <span class="preprocessor">#else</span>
<a name="l03183"></a>03183 <span class="preprocessor"></span>    dims[n] = m_dims[n];
<a name="l03184"></a>03184     start[n] = m_start[n] - 1;
<a name="l03185"></a>03185     stride[n] = m_stride[n];
<a name="l03186"></a>03186     count[n] = (m_end[n] - m_start[n] + 1) / m_stride[n];
<a name="l03187"></a>03187 <span class="preprocessor">#endif</span>
<a name="l03188"></a>03188 <span class="preprocessor"></span>  }
<a name="l03189"></a>03189 
<a name="l03190"></a>03190   mspace = H5Screate_simple(m_num_dims, dims, NULL);
<a name="l03191"></a>03191   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(mspace);
<a name="l03192"></a>03192 
<a name="l03193"></a>03193   H5Sselect_hyperslab(mspace, H5S_SELECT_SET, start, stride, count, NULL);
<a name="l03194"></a>03194 
<a name="l03195"></a>03195   <span class="keywordflow">if</span> (H5Sget_select_npoints(mspace) != H5Sget_select_npoints(dspace)) {
<a name="l03196"></a>03196       H5Sclose(mspace);
<a name="l03197"></a>03197       H5Sclose(dspace);
<a name="l03198"></a>03198       H5Dclose(did);
<a name="l03199"></a>03199       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#e97b258b9c94100d89b8885ec63715d0">UNEQUAL_MEMORY_AND_DISK_DIMS</a>, err);
<a name="l03200"></a>03200       <span class="keywordflow">return</span>;
<a name="l03201"></a>03201   }
<a name="l03202"></a>03202 
<a name="l03203"></a>03203   <span class="comment">/* write the data */</span>
<a name="l03204"></a>03204 
<a name="l03205"></a>03205   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(did);
<a name="l03206"></a>03206   tid = H5Dget_type(did);
<a name="l03207"></a>03207   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(tid);
<a name="l03208"></a>03208   mid = H5Tget_native_type(tid, H5T_DIR_ASCEND);
<a name="l03209"></a>03209   <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(mid);
<a name="l03210"></a>03210   status = H5Dwrite(did, mid, mspace, dspace, H5P_DEFAULT, data);
<a name="l03211"></a>03211 
<a name="l03212"></a>03212   H5Sclose(mspace);
<a name="l03213"></a>03213   H5Sclose(dspace);
<a name="l03214"></a>03214   H5Tclose(mid);
<a name="l03215"></a>03215   H5Tclose(tid);
<a name="l03216"></a>03216   H5Dclose(did);
<a name="l03217"></a>03217 
<a name="l03218"></a>03218   <span class="keywordflow">if</span> (status &lt; 0)
<a name="l03219"></a>03219     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#5e8ecab15f74022e5350cf299562648b">ADFH_ERR_DWRITE</a>, err);
<a name="l03220"></a>03220   <span class="keywordflow">else</span>
<a name="l03221"></a>03221     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l03222"></a>03222 }
<a name="l03223"></a>03223 
<a name="l03224"></a>03224 <span class="comment">/* ----------------------------------------------------------------- */</span>
<a name="l03225"></a>03225 
<a name="l03226"></a><a class="code" href="_a_d_f_h_8h.html#5134e471cec1fb17db3bc5014c134999">03226</a> <span class="keywordtype">void</span> <a class="code" href="_a_d_f_h_8c.html#90a0cdcf63e1df631cef0dd909875934">ADFH_Write_All_Data</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>  <span class="keywordtype">id</span>,
<a name="l03227"></a>03227                          <span class="keyword">const</span> <span class="keywordtype">char</span>   *data,
<a name="l03228"></a>03228                          <span class="keywordtype">int</span>          *err)
<a name="l03229"></a>03229 {
<a name="l03230"></a>03230   hid_t hid = <a class="code" href="_a_d_f_h_8c.html#184ca6b6e864380e8b1c8e89ff9fe16b">to_HDF_ID</a>(<span class="keywordtype">id</span>);
<a name="l03231"></a>03231   hid_t did, tid, mid;
<a name="l03232"></a>03232 
<a name="l03233"></a>03233   <a class="code" href="_a_d_f_h_8c.html#7bd949196fcae1bccd2d6c39173a0664">ADFH_DEBUG</a>((<span class="stringliteral">"ADFH_Write_All_Data"</span>));
<a name="l03234"></a>03234 
<a name="l03235"></a>03235   <span class="keywordflow">if</span> (data == NULL) {
<a name="l03236"></a>03236     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#b35fccb34c6d5687da3115b8de46cc8c">NULL_POINTER</a>, err);
<a name="l03237"></a>03237     <span class="keywordflow">return</span>;
<a name="l03238"></a>03238   }
<a name="l03239"></a>03239   <span class="keywordflow">if</span> (is_link(hid)) {
<a name="l03240"></a>03240     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#0e83ca5faed8218096517883dfbe6f78">ADFH_ERR_LINK_DATA</a>, err);
<a name="l03241"></a>03241     <span class="keywordflow">return</span>;
<a name="l03242"></a>03242   }
<a name="l03243"></a>03243   <span class="keywordflow">if</span> (<a class="code" href="_a_d_f_h_8c.html#d05c7d5eb688634c398c562af1fb8680">has_data</a>(hid)) {
<a name="l03244"></a>03244     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(hid);
<a name="l03245"></a>03245     did = H5Dopen2(hid, <a class="code" href="_a_d_f_h_8c.html#5ee2bc8ac53f43c3d563c4bdc4b14ea9">D_DATA</a>, H5P_DEFAULT);
<a name="l03246"></a>03246     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(did);
<a name="l03247"></a>03247     tid = H5Dget_type(did);
<a name="l03248"></a>03248     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(tid);
<a name="l03249"></a>03249     mid = H5Tget_native_type(tid, H5T_DIR_ASCEND);
<a name="l03250"></a>03250     <a class="code" href="_a_d_f_h_8c.html#6ea14ba9f62eba9c19bdfbe19839652f">ADFH_CHECK_HID</a>(mid);
<a name="l03251"></a>03251 
<a name="l03252"></a>03252     <span class="keywordflow">if</span> (H5Dwrite(did, mid, H5S_ALL, H5S_ALL, H5P_DEFAULT, data) &lt; 0)
<a name="l03253"></a>03253       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_h_8h.html#5e8ecab15f74022e5350cf299562648b">ADFH_ERR_DWRITE</a>, err);
<a name="l03254"></a>03254     <span class="keywordflow">else</span>
<a name="l03255"></a>03255       <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#258bb72419ef143530a2f8f55e7d57af">NO_ERROR</a>, err);
<a name="l03256"></a>03256 
<a name="l03257"></a>03257     H5Tclose(mid);
<a name="l03258"></a>03258     H5Tclose(tid);
<a name="l03259"></a>03259     H5Dclose(did);
<a name="l03260"></a>03260   }
<a name="l03261"></a>03261   <span class="keywordflow">else</span>
<a name="l03262"></a>03262     <a class="code" href="cgns__io_8c.html#6bf1f864e17d11e50072b4a8bbaa8874">set_error</a>(<a class="code" href="_a_d_f_8h.html#68de9030c39965958f08402f7d452ad9">NO_DATA</a>, err);
<a name="l03263"></a>03263 }
<a name="l03264"></a>03264 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Jun 25 10:29:44 2009 for CGNS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
